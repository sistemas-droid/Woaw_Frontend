<ion-card *ngIf="isLoggedIn" class="formulario-lote form-lote-ios">
  <ion-card-header class="lote-header-ios">
    <ion-card-title>Registra tu lote de coches</ion-card-title>
    <ion-card-subtitle>Completa la información del lote</ion-card-subtitle>
  </ion-card-header>

  <ion-card-content>

    <!-- Nav pasos (solo tel) -->
    <div *ngIf="tipoDispocitivo === 'telefono'" class="top-actions-ios">
      <ion-button
        *ngIf="pocicion"
        fill="outline"
        size="small"
        class="btn-outline-ios"
        type="button"
        (click)="sigiente()">
        Continuar
        <ion-icon name="arrow-forward-outline" slot="end"></ion-icon>
      </ion-button>

      <ion-button
        *ngIf="!pocicion"
        fill="outline"
        size="small"
        class="btn-outline-ios"
        type="button"
        (click)="sigiente()">
        <ion-icon name="arrow-back-outline" slot="start"></ion-icon>
        Regresar
      </ion-button>
    </div>

    <form [formGroup]="formLote" (ngSubmit)="registrarLote()">

      <ion-grid>
        <!-- PRIMER PASO: datos generales -->
        <ion-row *ngIf="pocicion">
          <ion-col size="12" size-md="6">
            <div class="field-ios">
              <ion-label position="stacked">
                Nombre del Lote <strong>*</strong>
              </ion-label>

              <ion-input
                formControlName="nombre"
                placeholder="Ej. AUTOS EL RÁPIDO"
                maxlength="25"
                autocapitalize="characters"
                inputmode="text"
                (ionInput)="onNombreInput($event)"
                style="text-transform: uppercase;">
              </ion-input>

              <ion-note
                *ngIf="formLote.get('nombre')?.hasError('maxlength') && formLote.get('nombre')?.touched"
                color="danger">
                Máximo 25 caracteres.
              </ion-note>
            </div>
          </ion-col>

          <ion-col size="12" size-md="6">
            <div class="field-ios">
              <ion-label position="stacked">
                Teléfono <strong>*</strong>
              </ion-label>
              <ion-input
                type="tel"
                formControlName="telefono"
                placeholder="Ej. 4421234567">
              </ion-input>
            </div>
          </ion-col>

          <ion-col size="12" size-md="6">
            <div class="field-ios">
              <ion-label position="stacked">
                Correo electrónico <strong>(opcional)</strong>
              </ion-label>
              <ion-input
                type="email"
                formControlName="email"
                placeholder="Ej. contacto@autosrapido.com">
              </ion-input>
            </div>
          </ion-col>

          <!-- Imagen principal -->
          <ion-col size="12" size-md="6">
            <div class="field-ios">
              <ion-label position="stacked">
                Imagen principal del lote <strong>*</strong>
              </ion-label>

              <div class="area-subida-ios" (click)="seleccionarImagenPrincipal()">
                <ion-icon
                  name="camera-outline"
                  [class.oculto]="previewImagenPrincipal">
                </ion-icon>

                <div *ngIf="previewImagenPrincipal" class="preview-container-ios">
                  <img [src]="previewImagenPrincipal" alt="Imagen principal" />
                  <button
                    type="button"
                    class="btn-eliminar-img-ios"
                    (click)="eliminarImagenPrincipal(); $event.stopPropagation()">
                    ✕
                  </button>
                </div>
              </div>
            </div>
          </ion-col>
        </ion-row>

        <!-- SEGUNDO PASO: ubicación -->
        <ion-row *ngIf="!pocicion">
          <ion-col size="12" size-md="6">
            <div class="field-ios">
              <ion-label position="stacked">
                Ubicación del lote <strong>*</strong>
              </ion-label>
              <ion-button
                expand="block"
                fill="solid"
                class="btn-ubicacion-ios"
                (click)="seleccionarUbicacion()">
                <ion-icon name="location-outline" slot="start"></ion-icon>
                Seleccionar ubicación
              </ion-button>
            </div>
          </ion-col>

          <ion-col size="12" *ngIf="ubicacionesSeleccionadas.length > 0">
            <ion-list class="lista-ubicaciones-ios">
              <ion-item *ngFor="let u of ubicacionesSeleccionadas; let i = index">
                <ion-label>
                  <p><strong>{{ direccionesTraducidas[i] }}</strong></p>
                </ion-label>
                <ion-button
                  fill="clear"
                  size="small"
                  class="btn-remove-ios"
                  slot="end"
                  (click)="eliminarUbicacion(i)">
                  <ion-icon name="close-outline" slot="icon-only"></ion-icon>
                </ion-button>
              </ion-item>
            </ion-list>
          </ion-col>
        </ion-row>
      </ion-grid>

      <!-- CTA inferior -->
      <div class="boton-publicar-container-ios" *ngIf="pocicion">
        <ion-button
          expand="block"
          type="button"
          class="btn-primary-ios"
          (click)="sigiente()">
          Continuar
          <ion-icon name="arrow-forward-outline" slot="end"></ion-icon>
        </ion-button>
      </div>

      <div class="boton-publicar-container-ios" *ngIf="!pocicion">
        <ion-button
          expand="block"
          type="submit"
          class="btn-primary-ios"
          [disabled]="ubicacionesSeleccionadas.length === 0">
          Crear Lote
          <ion-icon name="save-outline" slot="end"></ion-icon>
        </ion-button>
      </div>

    </form>
  </ion-card-content>
</ion-card>

<!-- Mensaje cuando NO está logueado -->
<div *ngIf="!isLoggedIn" class="mensaje-autenticacion-ios">
  <p>
    Para publicar un <strong>Lote</strong>, primero debes iniciar sesión o crear una cuenta.
  </p>
  <button class="btn-acceso-ios" (click)="irAInicio()">Acceder</button>
</div>

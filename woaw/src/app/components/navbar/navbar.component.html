<app-spinner *ngIf="mostrar_spinnet"></app-spinner>
<ion-header [translucent]="true">

  <ion-toolbar class="custom-toolbar" color="dark">

    <ion-buttons slot="start">
      <div class="logo_content">
        <ion-button fill="clear" (click)="regresar()">
          <ion-icon name="chevron-back-outline" *ngIf="!estaEnHome && esDispositivoMovil"></ion-icon>
          <img src="/assets/icon/logo4.png" loading="lazy" alt="WOAW" class="logo" />
        </ion-button>


        <!-- <span class="titulo-movil" *ngIf="!mostrarBuscador && esDispositivoMovil">
          {{ getTituloSeccion() }}
        </span> -->

        <!-- Botón lupa para mostrar buscador -->
        <ion-button fill="clear" class="btn-buscar" *ngIf="!mostrarBuscador   && esDispositivoMovil"
          (click)="mostrarBuscador = true">
          <ion-icon name="search-outline"></ion-icon>
        </ion-button>

        <!-- Botón cerrar buscador -->
        <ion-button fill="clear" class="btn-buscar" *ngIf="mostrarBuscador  && esDispositivoMovil"
          (click)="cerrarBuscador()">
          <ion-icon name="close-outline"></ion-icon>
        </ion-button>
      </div>

      <!-- Searchbar solo visible si mostrarBuscador está activo -->
      <div class="buscador-container" *ngIf=" !esDispositivoMovil">
        <ion-searchbar [(ngModel)]="terminoBusqueda" (ionInput)="onInputChange($event)"
          (keyup.enter)="irABusqueda(terminoBusqueda)" placeholder="Busca por marca, modelo o año" animated="true">
        </ion-searchbar>
      </div>

      <div class="buscador-container" *ngIf="mostrarBuscador &&  esDispositivoMovil">
        <ion-searchbar [(ngModel)]="terminoBusqueda" (ionInput)="onInputChange($event)"
          (keyup.enter)="irABusqueda(terminoBusqueda)" placeholder="Busca por marca, modelo o año" animated="true">
        </ion-searchbar>
      </div>
    </ion-buttons>

    <ion-buttons slot="end">

      <ng-container *ngIf="!esDispositivoMovil">
        <ion-button fill="clear" [ngClass]="{ 'activo': isActive('home') }" (click)="redirecion('home')">
          inicio
        </ion-button>

        <ion-button fill="clear" (click)="abrirPopover('Autos')"
          [ngClass]="{ 'activo': isActive('menu-vehiculos/autos') }">
          Vehiculos
        </ion-button>

        <ion-button fill="clear" [ngClass]="{ 'activo': isActive('m-nuevos') }" (click)="redirecion('m-nuevos')">
          Motos
        </ion-button>

        <ion-button fill="clear" [ngClass]="{ 'activo': isActive('camiones/todos') }"
          (click)="redirecion('camiones/todos')">
          Camiones
        </ion-button>

        <ion-button fill="clear" [ngClass]="{ 'activo': isActive('arrendamiento') }"
          (click)="redirecion('arrendamiento')">
          Arrendamiento
        </ion-button>

        <!-- <ion-button fill="clear" [ngClass]="{ 'activo': isActive('renta') }"
          (click)="redirecion('renta')">
          Renta de coches
        </ion-button> -->

        <ion-button fill="clear" [ngClass]="{ 'activo': isActive('seguros/disponibles') }"
          (click)="redirecion('seguros/disponibles')">
          Seguros de autos
        </ion-button>

        <ion-button fill="clear" [ngClass]="{ 'activo': isActive('conocenos') }" (click)="redirecion('conocenos')">
          Nosotros
        </ion-button>

        <ion-button fill="clear" [ngClass]="{ 'activo': isActive('inicio') }" (click)="redirecion('inicio')"
          *ngIf="!isLoggedIn">
          Iniciar sesión
        </ion-button>

        <button class="btn-vender" [ngClass]="{ 'activo-btn-new': isActive('new-car') }" (click)="redirecion('new-car')"
          *ngIf="!esDispositivoMovil">
          <ion-icon name="add-outline"></ion-icon>
          Publicar
        </button>

        <!-- USUARIO (con foto de Google si existe) -->
        <div class="usuario-info" (click)="abrirModalPerfil()" >
          <img *ngIf="!esDispositivoMovil && isLoggedIn" src="assets/icon/mexico.png" alt="MX" class="icono-bandera" />
          <div class="contenedor-nombre">
            <ng-container *ngIf="fotoPerfil; else iconoDefault">
              <img [src]="fotoPerfil" alt="Foto de perfil" width="20" height="20"
                style="border-radius: 50%; object-fit: cover;" referrerpolicy="no-referrer"
                (error)="fotoPerfil = null" />
            </ng-container>
            <ng-template #iconoDefault>
              <ion-icon name="person-outline" class="icono-user"></ion-icon>
            </ng-template>
            <span *ngIf="isLoggedIn" class="nombre-usuario">{{ usuario }}</span>
          </div>
        </div>
        <!-- /USUARIO -->
      </ng-container>

      <ion-button fill="clear" class="stack" [ngClass]="{ 'activo': isActive('favoritos') }"
        (click)="redirecion('favoritos')" *ngIf="isLoggedIn && !mostrarBuscador">
        <span class="vcol">
          <ion-icon name="heart-outline"></ion-icon>
          <span *ngIf="esDispositivoMovil" class="label">Favoritos</span>
        </span>
      </ion-button>

      <ion-button fill="clear" class="stack" [ngClass]="{ 'activo': isActive('m-nuevos') }"
        (click)="redirecion('m-nuevos')" *ngIf="!mostrarBuscador && esDispositivoMovil">
        <span class="vcol">
          <ion-icon name="bicycle-outline"></ion-icon>
          <span class="label">Motos</span>
        </span>
      </ion-button>

      <ion-button fill="clear" class="stack" [ngClass]="{ 'activo': isActive('camiones/todos') }"
        (click)="redirecion('camiones/todos')" *ngIf="!mostrarBuscador && esDispositivoMovil">
        <span class="vcol">
          <ion-icon name="bus-outline"></ion-icon>
          <span class="label">Camiones</span>
        </span>
      </ion-button>

      <!-- <ion-button fill="clear" class="stack" [ngClass]="{ 'activo': isActive('renta') }"
        (click)="redirecion('renta')" *ngIf="!mostrarBuscador && esDispositivoMovil">
        <span class="vcol">
          <ion-icon name="key-outline"></ion-icon>
          <span class="label">Renta</span>
        </span>
      </ion-button> -->

      <ion-button fill="clear" class="stack" (click)="openMenu()">
        <span class="vcol">
          <ion-icon name="menu-outline"></ion-icon>
          <span class="label">Menú</span>
        </span>
      </ion-button>
    </ion-buttons>



  </ion-toolbar>
</ion-header>
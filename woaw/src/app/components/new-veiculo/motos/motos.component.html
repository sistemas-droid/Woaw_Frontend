<section>
  <!-- Resumen + bot√≥n Publicar (solo cuando est√°s en el form principal) -->
  <div class="resumen-estado" *ngIf="seccionFormulario == 2 && Pregunta == 'no'">
    
    <button type="button" class="btn-guardar" (click)="EnviarVeiculo()">
      <ion-icon name="save-outline" class="icono-guardar"></ion-icon>
      Publicar
    </button>

    <div class="fila-info">
      <p>A√±o: <strong>{{ anio }}</strong></p>
      <p>Marca: <strong>{{ marca }}</strong></p>
      <p>Modelo: <strong>{{ modelo }}</strong></p>
            <p *ngIf="MyRole !== 'admin'" class="estilo_unico">{{ estadoVehiculo }}</p>

      <div *ngIf="MyRole === 'admin'" class="field">
        <div class="control control--select">
          <ion-select #lista class="sync-pop" interface="popover"
            [interfaceOptions]="{ cssClass: 'select-popover pop-tipo', side: 'bottom', alignment: 'start' }"
            (ionChange)="onTipoChange($event)" [value]="estadoVehiculo" placeholder="Tipo">
            <ion-select-option value="Nuevo">Nuevo</ion-select-option>
            <ion-select-option value="Seminuevo">Seminuevo</ion-select-option>
            <ion-select-option value="Usado">Usado</ion-select-option>
          </ion-select>
        </div>
      </div>
    </div>
  </div>

  <!-- # ------ PREGUNTA COMO SUBIR: LOTE O PARTICULAR -----  -->
  <div class="tipo-vehiculo-container" *ngIf="Pregunta == 'si'">
    <h2 class="titulo-tipo">¬øQu√© tipo de veh√≠culo quieres subir?</h2>

    <div class="opciones-vehiculo">
      <!-- Particular -->
      <div class="casilla" [class.activa]="tipoSeleccionado === 'particular'" (click)="seleccionarTipo('particular')">
        <img src="assets/img/particular.png" alt="Particular" />
        <p>Particular</p>
        <ion-icon *ngIf="tipoSeleccionado === 'particular'" name="checkmark-circle-outline" class="icono-check"></ion-icon>
      </div>

      <!-- Lote -->
      <div class="casilla" [class.activa]="tipoSeleccionado === 'lote'" (click)="seleccionarTipo('lote')">
        <img src="assets/img/lote.png" alt="Lote" />
        <p>Lote</p>
        <ion-icon *ngIf="tipoSeleccionado === 'lote'" name="checkmark-circle-outline" class="icono-check"></ion-icon>
      </div>
    </div>

    <div class="contenedor-boton">
      <button class="btn-continuar" [disabled]="!tipoSeleccionado" (click)="continuar()">
        Continuar
        <ion-icon name="arrow-forward-outline"></ion-icon>
      </button>
    </div>
  </div>

  <!-- # ------ PREGUNTA SI QUIERE VENDERLA EL MISMO  -----  -->
  <div *ngIf="tipoSeleccionado == 'particular' && MyRole !== 'admin' && seccionFormulario == 1" class="pregunta-vendedor">
    <p class="texto-pregunta">¬øC√≥mo quieres vender tu moto?</p>

    <div class="botones-vendedor">
      <button class="btn-vender-yo" (click)="quienLovende(0)">La vendo yo</button>
      <button class="btn-vende-go" (click)="quienLovende(1)">
        Que la venda
        <img src="assets/icon/logo4.png" alt="Go Autos" class="logo-boton" />
      </button>
    </div>
  </div>

  <!-- Publicaci√≥n asistida para particular -->
  <div
    *ngIf="tipoSeleccionado === 'particular' && seccionFormulario === 3 && (MyRole === 'cliente' || MyRole === 'vendedor')"
    class="formulario-publicacion">


    <p class="info-texto">
      <strong>¬°Nosotros nos encargamos!</strong> Publicamos tu moto y agendamos citas con interesados.
      <br />
      <strong>Cont√°ctanos por WhatsApp y te ayudamos.</strong>
    </p>

    <div class="info-grid">
      <p>A√±o: <strong>{{ anio }}</strong></p>
      <p>Marca: <strong>{{ marca }}</strong></p>
      <p>Modelo: <strong>{{ modelo }}</strong></p>
      <p class="estilo_unico">{{ estadoVehiculo }}</p>
    </div>

    <ion-item>
      <ion-label position="stacked">Precio estimado (opcional)</ion-label>
      <ion-input type="number" placeholder="Solo n√∫meros" [(ngModel)]="precioEstimado"></ion-input>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">Tipo de factura (opcional)</ion-label>
      <ion-select [(ngModel)]="tipoFactura" placeholder="Selecciona una opci√≥n">
        <ion-select-option value="original">Original</ion-select-option>
        <ion-select-option value="refacturada">Refacturada</ion-select-option>
        <ion-select-option value="sin factura">Sin factura</ion-select-option>
      </ion-select>
    </ion-item>

    <div class="btn-wsp-container">
      <button class="btn-wsp" (click)="ContactosService.contactarPorPublicacionParticular(
        anio,
        marca,
        modelo,
        precioEstimado!,
        tipoFactura
      )">
        <ion-icon name="logo-whatsapp" slot="start"></ion-icon>
        Cont√°ctanos por WhatsApp
      </button>
    </div>
    
  </div>

  <!-- # ------ FORMULARIO PRINCIPAL -----  -->
  <div class="formulario" *ngIf="Pregunta == 'no' && seccionFormulario == 2">

    <!-- Ubicaci√≥n / Lote / Im√°genes -->
    <div class="contenedor-botones">
      <!-- Particular -->
      <div class="bloque-imagenes" *ngIf="tipoSeleccionado == 'particular'">
        <button type="button" (click)="seleccionarUbicacion()">
          <ion-icon name="location-outline" class="icono"></ion-icon>
          Seleccionar ubicaci√≥n
        </button>

        <div *ngIf="ubicacionSeleccionada" class="ubicacion-mostrada">
          <ion-icon name="location-outline"></ion-icon>
          {{ direccionCompleta }}
        </div>
      </div>

      <!-- Lote -->
      <div class="bloque-imagenes" *ngIf="tipoSeleccionado === 'lote'">
        <label for="loteSelect">Selecciona tu lote:</label>
        <select id="loteSelect" [(ngModel)]="loteSeleccionado" class="select-lote" (change)="onLoteSeleccionado()">
          <option [ngValue]="null" disabled selected>Selecciona un lote</option>
          <option *ngFor="let lote of lotes" [ngValue]="lote._id">
            {{ lote.nombre }}
          </option>
        </select>

        <div *ngIf="ubicacionesLoteSeleccionado!.length > 1" class="bloque-direcciones">
          <label for="direccionSelect">Selecciona una ubicaci√≥n:</label>
          <select id="direccionSelect" [(ngModel)]="direccionSeleccionada" class="select-lote">
            <option style="font-size: 12px;" [ngValue]="null" disabled selected>Selecciona una ubicaci√≥n</option>
            <option style="font-size: 12px;" *ngFor="let dir of ubicacionesLoteSeleccionado; let i = index" [ngValue]="dir">
              {{ ubicacionesLoteLegibles[i] || 'Obteniendo direcci√≥n...' }}
            </option>
          </select>
        </div>

        <div *ngIf="direccionSeleccionada && ubicacionesLoteSeleccionado.length === 1" class="ubicacion-mostrada">
          <ion-icon name="location-outline"></ion-icon>
          <span style="font-size: 12px;">
            {{ direccionCompleta }}
          </span>
        </div>
      </div>

      <!-- Im√°genes -->
      <div class="bloque-imagenes">
        <button class="btn-imagenes" type="button" (click)="seleccionarImagenes()">
          <ion-icon name="image-outline"></ion-icon>
          Seleccionar Im√°genes
          <label class="radio-validacion" [class.activo]="imagenesValidas" [class.inactivo]="!imagenesValidas">
            <span class="radio-custom"></span>
            <ion-icon name="checkmark-outline"></ion-icon>
          </label>
        </button>

        <button *ngIf="imagenesIntentadas" class="btn-limpiar" type="button" (click)="limpiarImagenes()">
          <ion-icon name="trash-outline"></ion-icon>
          Imagenes
        </button>
      </div>
    </div>

    <!-- Formulario de datos -->
    <div class="grid-form">
      <!-- Precio -->
      <div class="campo">
        <label>Precio: <span class="requerido">*</span></label>
        <input type="number" min="0" placeholder="Precio del veh√≠culo" [(ngModel)]="precio" />
      </div>

      <!-- Placas (opcional) ‚Äî oculto si es NUEVO -->
      <div class="campo" *ngIf="estadoVehiculo_logico !== 'nuevo'">
        <label>Placas: <span class="opcional_css">(opcional)</span></label>
        <input type="text" placeholder="Ej. UVY-123-A" [(ngModel)]="placas" />
      </div>

      <!-- Kilometraje ‚Äî oculto si es NUEVO -->
      <div class="campo" *ngIf="estadoVehiculo_logico !== 'nuevo'">
        <label>Kilometraje: <span class="requerido">*</span></label>
        <input type="number" min="0" placeholder="Ej. 45000" required [(ngModel)]="kilometraje" />
      </div>

      <!-- Color (MISMO MEN√ö PARA TODOS) -->
      <div class="campo">
        <label>Color: <span class="requerido">*</span></label>
        <select [(ngModel)]="colorSeleccionadoUnico" name="color" required>
          <option value="" disabled selected>Selecciona un color</option>
          <option *ngFor="let opcion of opciones" [value]="opcion.label">
            {{ opcion.label }}
          </option>
        </select>
      </div>

      <!-- Moneda -->
      <div class="campo">
        <label>Moneda:</label>
        <select [(ngModel)]="moneda" name="moneda">
          <option value="MXN">MXN - Pesos mexicanos</option>
          <option value="USD">USD - D√≥lares estadounidenses</option>
        </select>
      </div>

      <!-- Descripci√≥n -->
      <div class="campo" style="grid-column: span 2;">
        <label>Descripci√≥n de la motocicleta: <span class="requerido">*</span></label>
        <textarea rows="4" placeholder="Ej. Moto en excelente estado, √∫nico due√±o..." required [(ngModel)]="descripcion"></textarea>
      </div>

      <!-- Espec√≠ficos de moto -->
      <div class="campo">
        <label>Tipo de Motor: <span class="opcional_css">(opcional)</span></label>
        <input type="text" [(ngModel)]="tipoMotor" name="tipoMotor" placeholder="Ej. 4 tiempos, el√©ctrico..." />
      </div>

      <div class="campo">
        <label>Cilindrada: <span class="requerido">*</span></label>
        <input type="text" placeholder="Ej. 150cc" required [(ngModel)]="cilindrada" />
      </div>

      <div class="campo">
        <label>Transmisi√≥n: <span class="requerido">*</span></label>
        <input type="text" required [(ngModel)]="transmision" name="transmision" placeholder="Ej. manual, CVT, etc." />
      </div>

      <div class="campo">
        <label>Combustible: <span class="opcional_css">(opcional)</span></label>
        <input type="text" [(ngModel)]="combustible" name="combustible" placeholder="Ej. gasolina, el√©ctrico..." />
      </div>

      <div class="campo">
        <label>Frenos: <span class="opcional_css">(opcional)</span></label>
        <input type="text" [(ngModel)]="frenos" name="frenos" placeholder="Ej. disco, tambor, ABS..." />
      </div>

      <div class="campo">
        <label>Suspensi√≥n: <span class="opcional_css">(opcional)</span></label>
        <input type="text" [(ngModel)]="suspension" placeholder="Ej. telesc√≥pica, mono-shock" />
      </div>
    </div>

    <!-- üîª FICHA T√âCNICA ELIMINADA: no cat√°logo ni editable -->
  </div>
</section>

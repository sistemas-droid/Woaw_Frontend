<!-- =========================
     MENU WEB (MAIN) - SOLO NO NATIVO
========================= -->
<ion-menu
  side="end"
  menuId="menuLateral"
  contentId="main-content"
  class="menu-web"
  mode="ios"
  type="overlay"
  *ngIf="!isNative"
>
  <ion-header>
    <ion-toolbar mode="ios" class="menu-toolbar-ios">
      <ion-title>Menú</ion-title>

      <ion-buttons slot="end">
        <ion-button
          (click)="cerrarMenu()"
          aria-label="Cerrar menú"
          fill="clear"
          mode="ios"
        >
          <ion-icon name="close-outline"></ion-icon>
        </ion-button>
      </ion-buttons>
    </ion-toolbar>
  </ion-header>

  <ion-content class="menu-content-ios" mode="ios">
    <app-spinner *ngIf="mostrar_spinnet"></app-spinner>

    <ion-list class="menu-list-ios">
      <!-- =========================
           ADMIN (solo Admin)
      ========================= -->
      <div
        *ngIf="isAdmin"
        class="menu-section"
        [class.expanded]="expandedSections.admin"
        (click)="toggleSection('admin')"
        [attr.aria-expanded]="expandedSections.admin"
      >
        <span>Administración</span>
        <ion-icon
          [name]="expandedSections.admin ? 'chevron-up-outline' : 'chevron-down-outline'"
        ></ion-icon>
      </div>

      <div
        *ngIf="isAdmin"
        class="menu-items"
        [class.expanded]="expandedSections.admin"
      >
        <ion-item
          (click)="redirecion('lote/lote-verificacion')"
          button
          lines="none"
        >
          <ion-icon name="document-text-outline" color="danger"></ion-icon>
          <ion-label>Verificación de Lotes</ion-label>
        </ion-item>

        <!-- ✅ NUEVA PAGE: Asesores -->
        <ion-item (click)="redirecion('asesores')" button lines="none">
          <ion-icon name="people-outline" color="danger"></ion-icon>
          <ion-label>Asesores</ion-label>
        </ion-item>
      </div>

      <!-- =========================
           SERVICIOS (para todos)
      ========================= -->
      <div
        class="menu-section"
        [class.expanded]="expandedSections.servicios"
        (click)="toggleSection('servicios')"
        [attr.aria-expanded]="expandedSections.servicios"
      >
        <span>Servicios</span>
        <ion-icon
          [name]="expandedSections.servicios ? 'chevron-up-outline' : 'chevron-down-outline'"
        ></ion-icon>
      </div>

      <div class="menu-items" [class.expanded]="expandedSections.servicios">
        <ion-item (click)="redirecion('lotes')" button lines="none">
          <ion-icon name="business-outline"></ion-icon>
          <ion-label>Lotes</ion-label>
        </ion-item>

        <ion-item (click)="redirecion('menu-vehiculos/autos')" button lines="none">
          <ion-icon name="car-sport-outline"></ion-icon>
          <ion-label>Vehículos</ion-label>
        </ion-item>

        <ion-item (click)="redirecion('m-nuevos')" button lines="none">
          <ion-icon name="speedometer-outline"></ion-icon>
          <ion-label>Motos</ion-label>
        </ion-item>

        <ion-item (click)="redirecion('camiones/todos')" button lines="none">
          <ion-icon name="bus-outline"></ion-icon>
          <ion-label>Camiones</ion-label>
        </ion-item>

        <ion-item (click)="redirecion('arrendamiento')" button lines="none">
          <ion-icon name="receipt-outline"></ion-icon>
          <ion-label>Arrendamiento</ion-label>
        </ion-item>

        <ion-item (click)="redirecion('renta-ciudades')" button lines="none">
          <ion-icon name="calendar-outline"></ion-icon>
          <ion-label>Renta de coches</ion-label>
        </ion-item>

        <ion-item (click)="redirecion('seguros/disponibles')" button lines="none">
          <ion-icon name="shield-checkmark-outline"></ion-icon>
          <ion-label>Seguros de autos</ion-label>
        </ion-item>

        <ion-item
          *ngIf="isLoggedIn"
          (click)="redirecion('seguros/ver-polizas')"
          button
          lines="none"
        >
          <ion-icon name="newspaper-outline"></ion-icon>
          <ion-label>Ver pólizas</ion-label>
        </ion-item>

        <ion-item (click)="redirecion('conocenos')" button lines="none">
          <ion-icon name="people-circle-outline"></ion-icon>
          <ion-label>Nosotros</ion-label>
        </ion-item>
      </div>

      <!-- =========================
           MIS PUBLICACIONES (roles permitidos)
      ========================= -->
      <div
        *ngIf="isPublisher"
        class="menu-section"
        [class.expanded]="expandedSections.publicaciones"
        (click)="toggleSection('publicaciones')"
        [attr.aria-expanded]="expandedSections.publicaciones"
      >
        <span>Mis publicaciones</span>
        <ion-icon
          [name]="expandedSections.publicaciones ? 'chevron-up-outline' : 'chevron-down-outline'"
        ></ion-icon>
      </div>

      <div
        *ngIf="isPublisher"
        class="menu-items"
        [class.expanded]="expandedSections.publicaciones"
      >
        <ion-item (click)="redirecion('mis-autos')" button lines="none">
          <ion-icon name="car-sport-outline"></ion-icon>
          <ion-label>Mis autos</ion-label>
        </ion-item>

        <ion-item (click)="redirecion('mis-motos')" button lines="none">
          <ion-icon name="speedometer-outline"></ion-icon>
          <ion-label>Mis motos</ion-label>
        </ion-item>

        <ion-item (click)="redirecion('mis-camiones')" button lines="none">
          <ion-icon name="bus-outline"></ion-icon>
          <ion-label>Mis camiones</ion-label>
        </ion-item>
      </div>

      <!-- =========================
           RESERVAS (solo si hay sesión)
      ========================= -->
      <div
        *ngIf="isLoggedIn"
        class="menu-section"
        [class.expanded]="expandedSections.reservas"
        (click)="toggleSection('reservas')"
        [attr.aria-expanded]="expandedSections.reservas"
      >
        <span>Reservas</span>
        <ion-icon
          [name]="expandedSections.reservas ? 'chevron-up-outline' : 'chevron-down-outline'"
        ></ion-icon>
      </div>

      <div
        *ngIf="isLoggedIn"
        class="menu-items"
        [class.expanded]="expandedSections.reservas"
      >
        <ion-item (click)="redirecion('mis-reservas')" button lines="none">
          <ion-icon name="today-outline"></ion-icon>
          <ion-label>Mis reservas</ion-label>
        </ion-item>
      </div>

      <!-- =========================
           ✅ ASESOR (solo rol asesor)
      ========================= -->
      <div
        *ngIf="isAsesor"
        class="menu-section"
        [class.expanded]="expandedSections.asesor"
        (click)="toggleSection('asesor')"
        [attr.aria-expanded]="expandedSections.asesor"
      >
        <span>Asesor</span>
        <ion-icon
          [name]="expandedSections.asesor ? 'chevron-up-outline' : 'chevron-down-outline'"
        ></ion-icon>
      </div>

      <div
        *ngIf="isAsesor"
        class="menu-items"
        [class.expanded]="expandedSections.asesor"
      >
        <ion-item (click)="redirecion('perfil')" button lines="none">
          <ion-icon name="person-circle-outline" color="danger"></ion-icon>
          <ion-label>Mi perfil</ion-label>
        </ion-item>
      </div>

      <!-- =========================
           CUENTA (solo si hay sesión)
      ========================= -->
      <div
        *ngIf="isLoggedIn"
        class="menu-section"
        [class.expanded]="expandedSections.configuracion"
        (click)="toggleSection('configuracion')"
        [attr.aria-expanded]="expandedSections.configuracion"
      >
        <span>Cuenta</span>
        <ion-icon
          [name]="expandedSections.configuracion ? 'chevron-up-outline' : 'chevron-down-outline'"
        ></ion-icon>
      </div>

      <div
        *ngIf="isLoggedIn"
        class="menu-items"
        [class.expanded]="expandedSections.configuracion"
      >
        <!-- Para asesor: mejor ir a la page -->
        <ion-item *ngIf="isAsesor" (click)="redirecion('perfil')" button lines="none">
          <ion-icon name="person-circle-outline" color="danger"></ion-icon>
          <ion-label>Perfil</ion-label>
        </ion-item>

        <!-- Para otros roles: modal -->
        <ion-item *ngIf="!isAsesor" (click)="abrirModalPerfil()" button lines="none">
          <ion-icon name="person-circle-outline" color="danger"></ion-icon>
          <ion-label>Perfil</ion-label>
        </ion-item>

        <ion-item (click)="redirecion('eliminacion-cuenta')" button lines="none">
          <ion-icon name="trash-bin-outline"></ion-icon>
          <ion-label>Eliminar cuenta</ion-label>
        </ion-item>

        <ion-item (click)="logout()" button lines="none">
          <ion-icon name="log-out-outline" color="danger"></ion-icon>
          <ion-label>Cerrar sesión</ion-label>
        </ion-item>
      </div>
    </ion-list>
  </ion-content>

  <!-- Footer: CTA solo para invitado -->
  <ion-footer class="menu-footer-ios" *ngIf="!isLoggedIn">
    <ion-button
      expand="block"
      color="danger"
      (click)="redirecion('inicio')"
      class="btn-login-cta"
      mode="ios"
    >
      <ion-icon slot="start" name="log-in-outline"></ion-icon>
      Iniciar sesión
    </ion-button>
  </ion-footer>
</ion-menu>

<!-- =========================
     MENU NATIVO (iOS/Android)
========================= -->
<ion-menu
  side="end"
  menuId="menuLateral"
  contentId="main-content"
  class="menu-native"
  mode="ios"
  type="overlay"
  *ngIf="isNative"
>
  <ion-header>
    <ion-toolbar mode="ios">
      <ion-title>Menú</ion-title>
      <ion-buttons slot="end">
        <ion-button fill="clear" (click)="cerrarMenu()" aria-label="Cerrar menú" mode="ios">
          <ion-icon name="close-outline"></ion-icon>
        </ion-button>
      </ion-buttons>
    </ion-toolbar>
  </ion-header>

  <ion-content mode="ios">
    <app-spinner *ngIf="mostrar_spinnet"></app-spinner>

    <ion-list inset="true">
      <ion-accordion-group
        [multiple]="true"
        [value]="accordionValue"
        (ionChange)="onAccordionChange($event)"
      >
        <!-- ADMIN (solo admin) -->
        <ion-accordion *ngIf="isAdmin" value="admin">
          <ion-item slot="header" lines="none" detail="false" class="accordion-header-danger">
            <ion-icon slot="start" color="danger" name="settings-outline"></ion-icon>
            <ion-label color="danger">Administración</ion-label>
          </ion-item>

          <div slot="content">
            <ion-item button lines="none" (click)="redirecion('lote/lote-verificacion')">
              <ion-icon slot="start" name="document-text-outline"></ion-icon>
              <ion-label>Verificación de Lotes</ion-label>
            </ion-item>

            <!-- ✅ NUEVA PAGE: Asesores -->
            <ion-item button lines="none" (click)="redirecion('asesores')">
              <ion-icon slot="start" name="people-outline"></ion-icon>
              <ion-label>Asesores</ion-label>
            </ion-item>
          </div>
        </ion-accordion>

        <!-- SERVICIOS (para todos) -->
        <ion-accordion value="servicios">
          <ion-item slot="header" lines="none" detail="false" class="accordion-header-danger">
            <ion-icon slot="start" name="grid-outline"></ion-icon>
            <ion-label>Servicios</ion-label>
          </ion-item>

          <div slot="content">
            <ion-item button lines="none" (click)="redirecion('lotes')">
              <ion-icon slot="start" name="business-outline"></ion-icon>
              <ion-label>Lotes</ion-label>
            </ion-item>

            <ion-item button lines="none" (click)="redirecion('menu-vehiculos/autos')">
              <ion-icon slot="start" name="car-sport-outline"></ion-icon>
              <ion-label>Vehículos</ion-label>
            </ion-item>

            <ion-item button lines="none" (click)="redirecion('m-nuevos')">
              <ion-icon slot="start" name="speedometer-outline"></ion-icon>
              <ion-label>Motos</ion-label>
            </ion-item>

            <ion-item button lines="none" (click)="redirecion('camiones/todos')">
              <ion-icon slot="start" name="bus-outline"></ion-icon>
              <ion-label>Camiones</ion-label>
            </ion-item>

            <ion-item button lines="none" (click)="redirecion('arrendamiento')">
              <ion-icon slot="start" name="receipt-outline"></ion-icon>
              <ion-label>Arrendamiento</ion-label>
            </ion-item>

            <ion-item button lines="none" (click)="redirecion('renta-ciudades')">
              <ion-icon slot="start" name="calendar-outline"></ion-icon>
              <ion-label>Renta de coches</ion-label>
            </ion-item>

            <ion-item button lines="none" (click)="redirecion('seguros/disponibles')">
              <ion-icon slot="start" name="shield-checkmark-outline"></ion-icon>
              <ion-label>Seguros de autos</ion-label>
            </ion-item>

            <ion-item *ngIf="isLoggedIn" button lines="none" (click)="redirecion('seguros/ver-polizas')">
              <ion-icon slot="start" name="newspaper-outline"></ion-icon>
              <ion-label>Ver pólizas</ion-label>
            </ion-item>

            <ion-item button lines="none" (click)="redirecion('conocenos')">
              <ion-icon slot="start" name="people-circle-outline"></ion-icon>
              <ion-label>Nosotros</ion-label>
            </ion-item>
          </div>
        </ion-accordion>

        <!-- MIS PUBLICACIONES -->
        <ion-accordion *ngIf="isPublisher" value="publicaciones">
          <ion-item slot="header" lines="none" detail="false" class="accordion-header-danger">
            <ion-icon slot="start" name="albums-outline"></ion-icon>
            <ion-label>Mis publicaciones</ion-label>
          </ion-item>

          <div slot="content">
            <ion-item button lines="none" (click)="redirecion('mis-autos')">
              <ion-icon slot="start" name="car-sport-outline"></ion-icon>
              <ion-label>Mis autos</ion-label>
            </ion-item>

            <ion-item button lines="none" (click)="redirecion('mis-motos')">
              <ion-icon slot="start" name="speedometer-outline"></ion-icon>
              <ion-label>Mis motos</ion-label>
            </ion-item>

            <ion-item button lines="none" (click)="redirecion('mis-camiones')">
              <ion-icon slot="start" name="bus-outline"></ion-icon>
              <ion-label>Mis camiones</ion-label>
            </ion-item>
          </div>
        </ion-accordion>

        <!-- RESERVAS -->
        <ion-accordion *ngIf="isLoggedIn" value="reservas">
          <ion-item slot="header" lines="none" detail="false" class="accordion-header-danger">
            <ion-icon slot="start" name="today-outline"></ion-icon>
            <ion-label>Reservas</ion-label>
          </ion-item>

          <div slot="content">
            <ion-item button lines="none" (click)="redirecion('mis-reservas')">
              <ion-icon slot="start" name="ticket-outline"></ion-icon>
              <ion-label>Mis reservas</ion-label>
            </ion-item>
          </div>
        </ion-accordion>

        <!-- ✅ ASESOR (solo asesor) -->
        <ion-accordion *ngIf="isAsesor" value="asesor">
          <ion-item slot="header" lines="none" detail="false" class="accordion-header-danger">
            <ion-icon slot="start" name="person-circle-outline"></ion-icon>
            <ion-label>Asesor</ion-label>
          </ion-item>

          <div slot="content">
            <ion-item button lines="none" (click)="redirecion('perfil')">
              <ion-icon slot="start" name="id-card-outline"></ion-icon>
              <ion-label>Mi perfil</ion-label>
            </ion-item>
          </div>
        </ion-accordion>

        <!-- CUENTA -->
        <ion-accordion *ngIf="isLoggedIn" value="cuenta">
          <ion-item slot="header" lines="none" detail="false" class="accordion-header-danger">
            <ion-icon slot="start" name="person-circle-outline"></ion-icon>
            <ion-label>Cuenta</ion-label>
          </ion-item>

          <div slot="content">
            <!-- Asesor: page -->
            <ion-item *ngIf="isAsesor" button lines="none" (click)="redirecion('perfil')">
              <ion-icon slot="start" name="id-card-outline"></ion-icon>
              <ion-label>Perfil</ion-label>
            </ion-item>

            <!-- Otros: modal -->
            <ion-item *ngIf="!isAsesor" button lines="none" (click)="abrirModalPerfil()">
              <ion-icon slot="start" name="id-card-outline"></ion-icon>
              <ion-label>Perfil</ion-label>
            </ion-item>

            <ion-item button lines="none" (click)="redirecion('eliminacion-cuenta')">
              <ion-icon slot="start" name="trash-bin-outline"></ion-icon>
              <ion-label>Eliminar cuenta</ion-label>
            </ion-item>

            <ion-item button lines="none" (click)="logout()">
              <ion-icon slot="start" name="log-out-outline"></ion-icon>
              <ion-label>Cerrar sesión</ion-label>
            </ion-item>
          </div>
        </ion-accordion>
      </ion-accordion-group>
    </ion-list>
  </ion-content>

  <!-- CTA invitado -->
  <ion-footer *ngIf="!isLoggedIn">
    <ion-toolbar mode="ios">
      <ion-button color="danger" expand="block" (click)="redirecion('inicio')">
        <ion-icon slot="start" name="log-in-outline"></ion-icon>
        Iniciar sesión
      </ion-button>
    </ion-toolbar>
  </ion-footer>
</ion-menu>
<ion-menu
  side="end"
  menuId="menuLateral"
  contentId="main-content"
  type="overlay"
  mode="ios"
>
  <ion-header>
    <ion-toolbar mode="ios" class="menu-toolbar-ios">
      <ion-title>Menú</ion-title>
      <ion-buttons slot="end">
        <ion-button
          (click)="cerrarMenu()"
          aria-label="Cerrar menú"
          fill="clear"
          mode="ios"
        >
          <ion-icon name="close-outline"></ion-icon>
        </ion-button>
      </ion-buttons>
    </ion-toolbar>
  </ion-header>

  <ion-content class="menu-content-ios" mode="ios">
    <app-spinner *ngIf="mostrar_spinnet"></app-spinner>

    <ion-list class="menu-list-ios">
      <!-- Servicios (para todos) -->
      <div
        class="menu-section"
        [class.expanded]="expandedSections.servicios"
        (click)="toggleSection('servicios')"
        [attr.aria-expanded]="expandedSections.servicios"
      >
        <span>Servicios</span>
        <ion-icon
          [name]="expandedSections.servicios ? 'chevron-up-outline' : 'chevron-down-outline'"
        ></ion-icon>
      </div>

      <div class="menu-items" [class.expanded]="expandedSections.servicios">
        <ion-item (click)="redirecion('lotes')" button lines="none">
          <ion-icon name="business-outline"></ion-icon>
          <ion-label>Lotes</ion-label>
        </ion-item>

        <ion-item
          (click)="redirecion('menu-vehiculos/autos')"
          button
          lines="none"
        >
          <ion-icon name="car-sport-outline"></ion-icon>
          <ion-label>Vehículos</ion-label>
        </ion-item>

        <ion-item (click)="redirecion('m-nuevos')" button lines="none">
          <ion-icon name="speedometer-outline"></ion-icon>
          <ion-label>Motos</ion-label>
        </ion-item>

        <ion-item (click)="redirecion('camiones/todos')" button lines="none">
          <ion-icon name="bus-outline"></ion-icon>
          <ion-label>Camiones</ion-label>
        </ion-item>

        <ion-item (click)="redirecion('arrendamiento')" button lines="none">
          <ion-icon name="receipt-outline"></ion-icon>
          <ion-label>Arrendamiento</ion-label>
        </ion-item>

        <ion-item (click)="redirecion('renta-ciudades')" button lines="none">
          <ion-icon name="calendar-outline"></ion-icon>
          <ion-label>Renta de coches</ion-label>
        </ion-item>

        <ion-item
          (click)="redirecion('seguros/disponibles')"
          button
          lines="none"
        >
          <ion-icon name="shield-checkmark-outline"></ion-icon>
          <ion-label>Seguros de autos</ion-label>
        </ion-item>

        <ion-item
          *ngIf="isLoggedIn"
          (click)="redirecion('seguros/ver-polizas')"
          button
          lines="none"
        >
          <ion-icon name="newspaper-outline"></ion-icon>
          <ion-label>Ver pólizas</ion-label>
        </ion-item>

        <ion-item (click)="redirecion('conocenos')" button lines="none">
          <ion-icon name="people-circle-outline"></ion-icon>
          <ion-label>Nosotros</ion-label>
        </ion-item>
      </div>

      <!-- Mis publicaciones (solo roles permitidos) -->
      <div
        *ngIf="isPublisher"
        class="menu-section"
        [class.expanded]="expandedSections.publicaciones"
        (click)="toggleSection('publicaciones')"
        [attr.aria-expanded]="expandedSections.publicaciones"
      >
        <span>Mis publicaciones</span>
        <ion-icon
          [name]="expandedSections.publicaciones ? 'chevron-up-outline' : 'chevron-down-outline'"
        ></ion-icon>
      </div>

      <div
        *ngIf="isPublisher"
        class="menu-items"
        [class.expanded]="expandedSections.publicaciones"
      >
        <ion-item (click)="redirecion('mis-autos')" button lines="none">
          <ion-icon name="car-sport-outline"></ion-icon>
          <ion-label>Mis autos</ion-label>
        </ion-item>

        <ion-item (click)="redirecion('mis-motos')" button lines="none">
          <ion-icon name="speedometer-outline"></ion-icon>
          <ion-label>Mis motos</ion-label>
        </ion-item>

        <ion-item (click)="redirecion('mis-camiones')" button lines="none">
          <ion-icon name="bus-outline"></ion-icon>
          <ion-label>Mis camiones</ion-label>
        </ion-item>
      </div>

      <!-- Reservas (solo si hay sesión) -->
      <div
        *ngIf="isLoggedIn"
        class="menu-section"
        [class.expanded]="expandedSections.reservas"
        (click)="toggleSection('reservas')"
        [attr.aria-expanded]="expandedSections.reservas"
      >
        <span>Reservas</span>
        <ion-icon
          [name]="expandedSections.reservas ? 'chevron-up-outline' : 'chevron-down-outline'"
        ></ion-icon>
      </div>

      <div
        *ngIf="isLoggedIn"
        class="menu-items"
        [class.expanded]="expandedSections.reservas"
      >
        <ion-item (click)="redirecion('mis-reservas')" button lines="none">
          <ion-icon name="today-outline"></ion-icon>
          <ion-label>Mis reservas</ion-label>
        </ion-item>
      </div>

      <!-- Cuenta (solo si hay sesión) -->
      <div
        *ngIf="isLoggedIn"
        class="menu-section"
        [class.expanded]="expandedSections.configuracion"
        (click)="toggleSection('configuracion')"
        [attr.aria-expanded]="expandedSections.configuracion"
      >
        <span>Cuenta</span>
        <ion-icon
          [name]="expandedSections.configuracion ? 'chevron-up-outline' : 'chevron-down-outline'"
        ></ion-icon>
      </div>

      <div
        *ngIf="isLoggedIn"
        class="menu-items"
        [class.expanded]="expandedSections.configuracion"
      >
        <ion-item (click)="abrirModalPerfil()" button lines="none">
          <ion-icon name="person-circle-outline"></ion-icon>
          <ion-label>Perfil</ion-label>
        </ion-item>

        <ion-item
          (click)="redirecion('eliminacion-cuenta')"
          button
          lines="none"
        >
          <ion-icon name="trash-bin-outline"></ion-icon>
          <ion-label>Eliminar cuenta</ion-label>
        </ion-item>

        <ion-item (click)="logout()" button lines="none">
          <ion-icon name="log-out-outline" color="danger"></ion-icon>
          <ion-label>Cerrar sesión</ion-label>
        </ion-item>
      </div>
    </ion-list>
  </ion-content>

  <!-- Footer: CTA solo para invitado -->
  <ion-footer class="menu-footer-ios" *ngIf="!isLoggedIn">
    <ion-button
      expand="block"
      color="danger"
      (click)="redirecion('inicio')"
      class="btn-login-cta"
      mode="ios"
    >
      <ion-icon slot="start" name="log-in-outline"></ion-icon>
      Iniciar sesión
    </ion-button>
  </ion-footer>
</ion-menu>

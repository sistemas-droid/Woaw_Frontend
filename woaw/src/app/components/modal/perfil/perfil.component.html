<ion-header [translucent]="true" class="perfil-header-ios">
  <!-- Grabber tipo hoja iOS -->
  <div class="grabber-ios"></div>

  <ion-toolbar color="light" class="toolbar-ios">
    <ion-buttons slot="start">
      <div class="perfil-header">
        <img src="/assets/icon/logo2.png" alt="Go Autos" class="logo" />
        <span class="titulo-perfil">Mi perfil</span>
      </div>
    </ion-buttons>

    <ion-buttons slot="end">
      <ion-button fill="clear" color="medium" (click)="cerrarModal()" aria-label="Cerrar">
        <ion-icon name="close-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="perfil-content-ios ion-padding">
  <!-- CARD PERFIL -->
  <ion-card *ngIf="!mostrarCambio" class="perfil-card-ios">
    <ion-list class="perfil-grid" lines="none">
      <ion-item>
        <ion-avatar slot="start">
          <img
            [src]="fotoPerfil"
            alt="Foto de perfil"
            referrerpolicy="no-referrer"
            (error)="fotoPerfil = 'assets/icon/woalf.png'"
          />
        </ion-avatar>
        <ion-label>
          <h2>{{ usuario?.nombre }} {{ usuario?.apellidos }}</h2>
          <p>Nombre completo</p>
        </ion-label>
      </ion-item>

      <ion-item>
        <ion-icon slot="start" name="mail-outline"></ion-icon>
        <ion-label>
          <h2>{{ usuario?.email }}</h2>
          <p>Correo electrónico</p>
        </ion-label>
      </ion-item>

      <ion-item>
        <ion-icon slot="start" name="call-outline"></ion-icon>
        <ion-label>
          <h2>{{ usuario?.telefono }}</h2>
          <p>Teléfono</p>
        </ion-label>
      </ion-item>

      <ion-item>
        <ion-icon slot="start" name="accessibility-outline"></ion-icon>
        <ion-label>
          <h2>{{ usuario?.rol | titlecase }}</h2>
          <p>Rol</p>
        </ion-label>
      </ion-item>
    </ion-list>
  </ion-card>

  <!-- CAMBIAR CONTRASEÑA (ACORDEÓN iOS) -->
  <ion-card class="card-cambio-ios" [class.is-open]="mostrarCambio">
    <ion-card-header class="cabecera-acordeon-ios" (click)="mostrarCambio = !mostrarCambio">
      <ion-card-title>
        <div class="titulo-acordeon-ios">
          <ion-icon name="lock-closed-outline"></ion-icon>
          <span>Cambiar contraseña</span>
        </div>
        <ion-icon
          class="chevron"
          [name]="mostrarCambio ? 'chevron-up-outline' : 'chevron-down-outline'"
        ></ion-icon>
      </ion-card-title>
    </ion-card-header>

    <ion-card-content *ngIf="mostrarCambio">
      <form [formGroup]="formCambio" (ngSubmit)="cambiarPassword()">
        <p class="hint-text">Contraseña mínimo de 8 caracteres.</p>

        <ion-item class="item-input-ios">
          <ion-label position="stacked">Contraseña actual</ion-label>
          <ion-input
            [type]="verActual ? 'password' : 'text'"
            formControlName="password"
            required
          ></ion-input>
          <ion-icon
            slot="end"
            [name]="verActual ? 'eye-off-outline' : 'eye-outline'"
            (click)="verActual = !verActual"
            class="icono-ojito-ios"
          ></ion-icon>
        </ion-item>

        <ion-item class="item-input-ios">
          <ion-label position="stacked">Nueva contraseña</ion-label>
          <ion-input
            [type]="verNuevas ? 'password' : 'text'"
            formControlName="newPassword"
            required
          ></ion-input>
          <ion-icon
            slot="end"
            [name]="verNuevas ? 'eye-off-outline' : 'eye-outline'"
            (click)="verNuevas = !verNuevas"
            class="icono-ojito-ios"
          ></ion-icon>
        </ion-item>

        <ion-text
          color="danger"
          *ngIf="
            formCambio.get('newPassword')?.hasError('passwordInvalida') &&
            formCambio.get('newPassword')?.touched
          "
        >
          <small>
            La contraseña debe tener mínimo 8 caracteres, una mayúscula, un número y un carácter especial.
          </small>
        </ion-text>

        <ion-item class="item-input-ios">
          <ion-label position="stacked">Confirmar nueva contraseña</ion-label>
          <ion-input
            [type]="verNuevas ? 'password' : 'text'"
            formControlName="newPasswordconf"
            required
          ></ion-input>
        </ion-item>

        <ion-button
          expand="block"
          color="danger"
          type="submit"
          [disabled]="formCambio.invalid"
          class="btn-actualizar-ios"
        >
          Actualizar contraseña
        </ion-button>
      </form>
    </ion-card-content>
  </ion-card>

  <!-- ELIMINAR CUENTA (ROW iOS) -->
  <ion-card class="card-eliminar-ios" (click)="goEliminarCuenta()">
    <ion-card-header class="cabecera-acordeon-ios danger">
      <ion-card-title>
        <div class="titulo-acordeon-ios">
          <ion-icon name="trash-outline"></ion-icon>
          <span>Eliminar cuenta</span>
        </div>
        <ion-icon name="chevron-forward-outline" class="chevron"></ion-icon>
      </ion-card-title>
    </ion-card-header>
  </ion-card>
</ion-content>

<ion-header translucent="true">
  <ion-toolbar color="light" class="header-ios">
    <ion-title class="title-ios">Im√°genes</ion-title>

    <ion-buttons slot="end">
      <ion-button class="btn-close-ios" (click)="cancelar()" fill="clear">
        <ion-icon name="close-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="imagenes-content-ios">

  <!-- ‚úÖ MODO RECORTE -->
  <section *ngIf="imagenParaRecortar" class="cropper-mode-ios">
    <div class="cropper-card-ios">

      <div class="cropper-head-ios">
        <div class="cropper-head__text-ios">
          <p class="cropper-title-ios">Ajusta la imagen</p>

          <div class="cropper-steps-ios">
            <span class="step-ios">
              <ion-icon name="move-outline"></ion-icon>
              Arrastra para encuadrar
            </span>

            <span class="dot-ios">‚Ä¢</span>

            <span class="step-ios">
              <ion-icon name="search-outline"></ion-icon>
              Ajusta con zoom
            </span>

            <span class="dot-ios">‚Ä¢</span>

            <span class="step-ios strong-ios">
              Guarda el recorte
            </span>
          </div>
        </div>

        <!-- Si quieres reactivar el badge, ya est√° listo:
        <div class="cropper-badge-ios" [class.ready]="cropperReady">
          <ion-icon [name]="cropperReady ? 'checkmark-circle' : 'time-outline'"></ion-icon>
          <span>{{ cropperReady ? 'Listo' : 'Cargando‚Ä¶' }}</span>
        </div>
        -->
      </div>

      <div class="cropper-wrap-ios">
        <image-cropper
          [imageFile]="imagenParaRecortar"
          [maintainAspectRatio]="true"
          [aspectRatio]="aspectRatio"
          [containWithinAspectRatio]="true"
          [cropperStaticWidth]="CROPPER_UI_WIDTH"
          [cropperStaticHeight]="CROPPER_UI_HEIGHT"
          [autoCrop]="true"
          [format]="cropFormat"
          [outputType]="'blob'"
          [resizeToWidth]="FINAL_WIDTH"
          [allowMoveImage]="true"
          [allowMoveCropper]="false"
          [transform]="transform"
          (imageCropped)="onImageCropped($event)"
          (cropperReady)="onCropperReady()"
          (loadImageFailed)="onLoadImageFailed()"
        ></image-cropper>

        <div class="cropper-tip-ios">
          <ion-icon name="hand-left-outline"></ion-icon>
          <span>Arrastra para acomodar</span>
        </div>
      </div>

    </div>
  </section>

  <!-- ‚úÖ UI NORMAL -->
  <ng-container *ngIf="!imagenParaRecortar">

    <div class="sheet-inner-ios">

      <!-- Imagen principal -->
      <div class="campo campo-principal-ios">
        <label class="etiqueta-ios">
          Imagen principal <span class="req">*</span>
        </label>

        <input
          type="file"
          id="fileInputPrincipal"
          accept="image/*"
          (change)="seleccionarImagenPrincipal($event)"
          hidden
        />

        <label
          class="preview-placeholder-ios"
          for="fileInputPrincipal"
          *ngIf="!imagenPrincipalMostrada"
        >
          <ion-icon name="image-outline"></ion-icon>
          <span>Agregar imagen</span>
        </label>

        <div class="preview-container-ios" *ngIf="imagenPrincipalMostrada">
          <img [src]="imagenPrincipalMostrada" class="preview-img-ios" />
          <ion-icon
            name="close-circle"
            class="icono-borrar-principal-ios"
            (click)="eliminarImagenPrincipal()"
          ></ion-icon>
        </div>
      </div>

      <!-- Im√°genes secundarias -->
      <div class="campo campo-secundario-ios">
        <label class="etiqueta-ios">
          Im√°genes secundarias <span class="opc">(m√°x. 10)</span>
        </label>

        <input
          type="file"
          id="fileInputSecundario"
          accept="image/*"
          multiple
          (change)="seleccionarImagenesSecundarias($event)"
          hidden
        />

        <div class="imagenes-secundarias-ios">

          <div
            class="preview-wrapper-ios"
            *ngFor="let img of imagenesSecundariasMostradas; let i = index"
          >
            <img [src]="img" class="preview-img-ios" />
            <ion-icon
              name="close-circle"
              class="icono-borrar-ios"
              (click)="eliminarImagenSecundaria(i)"
            ></ion-icon>
          </div>

          <label
            class="add-more-placeholder-ios"
            *ngIf="imagenesSecundariasMostradas.length < 10"
            for="fileInputSecundario"
          >
            <ion-icon name="add-outline"></ion-icon>
            <span>Agregar</span>
          </label>

        </div>
      </div>

    </div>
  </ng-container>

</ion-content>

<ion-footer>
  <ion-toolbar class="footer-ios">

    <div class="footer-wrap-ios">

      <!-- üîµ ZONA ZOOM (solo en recorte) -->
      <div class="footer-zoom-ios" *ngIf="imagenParaRecortar">
        <div class="zoom-row-ios">

          <div class="zoom-label-ios">
            <div class="zoom-left-ios">
              <ion-icon name="search-outline"></ion-icon>
              <span>Zoom</span>
              <span class="zoom-mini-ios">{{ zoom | number:'1.0-2' }}x</span>
            </div>

            <span class="zoom-hint-ios">M√°s detalle / m√°s espacio</span>
          </div>

          <ion-range
            class="zoom-range-ios"
            color="danger"
            [min]="ZOOM_MIN"
            [max]="ZOOM_MAX"
            step="0.02"
            [value]="zoom"
            (ionChange)="onZoomChange($event)"
          ></ion-range>

          <p class="zoom-help-ios">
            * Ajusta el encuadre sin perder la proporci√≥n.
          </p>

        </div>
      </div>

      <!-- üî¥ BOTONES -->
      <div class="footer-actions-ios">
        <ion-button
          expand="block"
          fill="solid"
          class="btn-footer-ios btn-cancel-ios"
          (click)="imagenParaRecortar ? cancelarRecorte() : cancelar()"
        >
          <ion-icon name="close-outline" slot="start"></ion-icon>
          Cancelar
        </ion-button>

        <ion-button
          expand="block"
          fill="solid"
          class="btn-footer-ios btn-save-ios"
          [disabled]="imagenParaRecortar ? !cropperReady : false"
          (click)="imagenParaRecortar ? aplicarRecorte() : confirmar()"
        >
          <ion-icon name="save-outline" slot="start"></ion-icon>
          {{ imagenParaRecortar ? 'Guardar recorte' : 'Guardar im√°genes' }}
        </ion-button>
      </div>

    </div>

  </ion-toolbar>
</ion-footer>
<div class="overlay">
  <img
    src="assets/icon/logo2.png"
    loading="lazy"
    alt="Go Autos"
    class="logo-registro"
  />

  <h1 class="titulo">Recuperar contraseña</h1>
  <p class="subtitulo">
    Te ayudamos a restablecer el acceso a tu cuenta.
  </p>

  <form
    [formGroup]="registroForm"
    class="login-form"
    (ngSubmit)="EnvioRegistro()"
  >
    <!-- ============= SECCIÓN 1: CORREO ============= -->
    <p class="instrucciones" *ngIf="EstatusSeccion === 1">
      Ingresa tu correo electrónico para enviarte un código de verificación.
    </p>

    <ion-item
      lines="none"
      class="input-wrapper"
      *ngIf="EstatusSeccion === 1"
    >
      <ion-input
        formControlName="email"
        type="email"
        placeholder="Correo electrónico"
        required
      ></ion-input>
    </ion-item>

    <ion-note
      *ngIf="
        EstatusSeccion === 1 &&
        registroForm.get('email')?.invalid &&
        registroForm.get('email')?.touched
      "
    >
      <ng-container *ngIf="registroForm.get('email')?.errors?.['required']">
        El correo es obligatorio.
      </ng-container>
      <ng-container *ngIf="registroForm.get('email')?.errors?.['email']">
        Correo no válido.
      </ng-container>
      <ng-container *ngIf="registroForm.get('email')?.errors?.['maxlength']">
        Máximo 30 caracteres.
      </ng-container>
    </ion-note>

    <button
      type="button"
      class="btn-login"
      [disabled]="registroForm.get('email')?.invalid"
      (click)="validarSeccion1()"
      *ngIf="EstatusSeccion === 1"
    >
      Siguiente
    </button>

    <br *ngIf="EstatusSeccion === 1" />

    <!-- ============= SECCIÓN 2: CÓDIGO ============= -->
    <p class="instrucciones" *ngIf="EstatusSeccion === 2">
      Te enviamos un código de verificación a tu correo electrónico.
      Escríbelo para continuar con el proceso.
    </p>

    <ion-item
      *ngIf="EstatusSeccion === 2"
      lines="none"
      class="input-wrapper"
    >
      <ion-input
        formControlName="numeroConfirm"
        type="number"
        inputmode="numeric"
        maxlength="6"
        placeholder="Código de verificación"
        required
      >
      </ion-input>
    </ion-item>

    <ion-note
      *ngIf="
        EstatusSeccion === 2 &&
        registroForm.get('numeroConfirm')?.invalid &&
        registroForm.get('numeroConfirm')?.touched
      "
    >
      <ng-container
        *ngIf="registroForm.get('numeroConfirm')?.errors?.['required']"
      >
        El código es obligatorio.
      </ng-container>
      <ng-container
        *ngIf="registroForm.get('numeroConfirm')?.errors?.['maxlength']"
      >
        Máximo 6 números.
      </ng-container>
      <ng-container
        *ngIf="registroForm.get('numeroConfirm')?.errors?.['pattern']"
      >
        Máximo 6 números.
      </ng-container>
    </ion-note>

    <div class="botones-acciones" *ngIf="EstatusSeccion === 2">
      <button
        type="button"
        class="btn-login-dos btn-secundario"
        (click)="regresarASeccion1()"
      >
        ← Regresar
      </button>

      <button
        type="button"
        class="btn-login-dos"
        [disabled]="registroForm.get('numeroConfirm')?.invalid"
        (click)="validarSeccion2()"
      >
        Siguiente →
      </button>
    </div>

    <!-- ============= SECCIÓN 3: NUEVA CONTRASEÑA ============= -->
    <p class="instrucciones" *ngIf="EstatusSeccion === 3">
      Crea una nueva contraseña segura para tu cuenta.
    </p>

    <!-- Contraseña -->
    <ion-item
      *ngIf="EstatusSeccion === 3"
      lines="none"
      class="input-wrapper"
    >
      <ion-input
        formControlName="contrasena"
        [type]="verPassword ? 'text' : 'password'"
        placeholder="Nueva contraseña"
        required
      >
      </ion-input>
    </ion-item>
    <ion-note
      *ngIf="
        EstatusSeccion === 3 &&
        registroForm.get('contrasena')?.touched &&
        registroForm.get('contrasena')?.invalid
      "
    >
      <ng-container
        *ngIf="registroForm.get('contrasena')?.errors?.['minlength']"
      >
        Mínimo 6 caracteres.
      </ng-container>
      <ng-container
        *ngIf="registroForm.get('contrasena')?.errors?.['mayuscula']"
      >
        Debe contener al menos una letra mayúscula.
      </ng-container>
      <ng-container
        *ngIf="registroForm.get('contrasena')?.errors?.['numero']"
      >
        Debe contener al menos un número.
      </ng-container>
      <ng-container
        *ngIf="registroForm.get('contrasena')?.errors?.['especial']"
      >
        Debe contener al menos un carácter especial.
      </ng-container>
    </ion-note>

    <!-- Confirmar Contraseña -->
    <ion-item
      *ngIf="EstatusSeccion === 3"
      lines="none"
      class="input-wrapper"
    >
      <ion-input
        formControlName="confirmarContrasena"
        [type]="verPassword ? 'text' : 'password'"
        placeholder="Confirmar contraseña"
        required
      >
      </ion-input>
    </ion-item>
    <ion-note
      *ngIf="
        EstatusSeccion === 3 &&
        registroForm.get('confirmarContrasena')?.touched &&
        registroForm.get('confirmarContrasena')?.invalid
      "
    >
      <ng-container
        *ngIf="
          registroForm.get('confirmarContrasena')?.errors?.['required']
        "
      >
        La confirmación de la contraseña es obligatoria.
      </ng-container>
      <ng-container
        *ngIf="
          registroForm.get('confirmarContrasena')?.errors?.['noCoincide']
        "
      >
        Las contraseñas no coinciden.
      </ng-container>
    </ion-note>

    <!-- Mostrar contraseñas -->
    <ion-item
      *ngIf="EstatusSeccion === 3"
      class="checkbox-custom"
      lines="none"
    >
      <ion-checkbox
        slot="start"
        (ionChange)="toggleVerPassword()"
        class="check-rojo"
      ></ion-checkbox>
      <ion-label>Mostrar contraseñas</ion-label>
    </ion-item>

    <button
      *ngIf="EstatusSeccion === 3"
      type="submit"
      class="btn-login"
      [disabled]="registroForm.invalid"
    >
      Cambiar contraseña
    </button>

    <br *ngIf="EstatusSeccion === 3" />
  </form>
</div>

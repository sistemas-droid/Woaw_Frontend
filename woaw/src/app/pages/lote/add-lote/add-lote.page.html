<app-navbar></app-navbar>

<ion-content mode="ios" [fullscreen]="true" class="page-lote-content">

  <ion-grid class="grid-container" *ngIf="isLoggedIn">
    <ion-row class="grid-row">

      <!-- üìù CARD FORMULARIO -->
      <ion-col size="12" size-md="8">
        <ion-card class="formulario-lote ios-card">

          <ion-card-header class="card-header-custom ios-card-header">
            <div class="header-content">
              <ion-button fill="clear" class="btn-back ios-back" (click)="regresar()" aria-label="Regresar">
                <ion-icon name="chevron-back" slot="icon-only"></ion-icon>
              </ion-button>

              <div class="logo-title-container">
                <div class="logo-circle">
                  <ion-icon name="car-sport-outline" class="logo-icon"></ion-icon>
                </div>
                <div class="title-container">
                  <ion-card-title class="titulo-principal">
                    Registra tu<br />
                    agencia seminuevos / Lote
                  </ion-card-title>

                  <ion-card-subtitle class="subtitulo" *ngIf="posicion">
                    Completa la informaci√≥n
                  </ion-card-subtitle>
                  <ion-card-subtitle class="subtitulo" *ngIf="!posicion">
                    Agrega tu ubicaci√≥n
                  </ion-card-subtitle>
                </div>
              </div>
            </div>
          </ion-card-header>

          <ion-card-content>
            <form [formGroup]="formLote" (ngSubmit)="registrarLote()">

              <ion-grid>
                <!-- üß© Secci√≥n 1: datos generales -->
                <ion-row *ngIf="posicion" class="seccion-formulario">

                  <ion-col size="12" size-md="6" class="campo-formulario">
                    <label class="etiqueta-campo">
                      Nombre del Lote <strong class="obligatorio">*</strong>
                    </label>

                    <ion-input
                      formControlName="nombre"
                      placeholder="Ej. AUTOS EL R√ÅPIDO"
                      maxlength="25"
                      autocapitalize="characters"
                      inputmode="text"
                      (ionInput)="onNombreInput($event)"
                      class="input-mayusculas ios-input">
                    </ion-input>

                    <ion-note
                      *ngIf="formLote.get('nombre')?.hasError('maxlength') && formLote.get('nombre')?.touched"
                      color="danger"
                      class="mensaje-error">
                      M√°ximo 25 caracteres.
                    </ion-note>
                  </ion-col>

                  <ion-col size="12" size-md="6" class="campo-formulario">
                    <label class="etiqueta-campo">
                      Tel√©fono <strong class="obligatorio">*</strong>
                    </label>
                    <ion-input
                      type="number"
                      formControlName="telefono"
                      placeholder="Ej. 4421234567"
                      class="input-estandar ios-input">
                    </ion-input>
                  </ion-col>

                  <ion-col size="12" size-md="6" class="campo-formulario">
                    <label class="etiqueta-campo">
                      Correo electr√≥nico <strong>(opcional)</strong>
                    </label>
                    <ion-input
                      type="email"
                      formControlName="email"
                      placeholder="Ej. contacto@autosrapido.com"
                      class="input-estandar ios-input">
                    </ion-input>
                  </ion-col>

                  <!-- Imagen principal -->
                  <ion-col size="12" size-md="6" class="campo-formulario">
                    <label class="etiqueta-campo">
                      Imagen principal <strong class="obligatorio">*</strong>
                    </label>

                    <div class="area-subida" (click)="seleccionarImagenPrincipal()">
                      <ion-icon
                        name="camera-outline"
                        class="icono-camara"
                        [class.oculto]="previewImagenPrincipal">
                      </ion-icon>

                      <div *ngIf="previewImagenPrincipal" class="preview-container">
                        <img
                          [src]="previewImagenPrincipal"
                          alt="Imagen principal"
                          class="imagen-preview" />
                        <button
                          type="button"
                          class="btn-eliminar-img"
                          (click)="eliminarImagenPrincipal(); $event.stopPropagation()">
                          ‚úï
                        </button>
                      </div>
                    </div>
                  </ion-col>
                </ion-row>

                <!-- üß≠ Secci√≥n 2: ubicaci√≥n -->
                <ion-row *ngIf="!posicion" class="seccion-formulario">
                  <ion-col size="12" size-md="6" class="campo-formulario">
                    <label class="etiqueta-campo">Ubicaci√≥n del lote <strong class="obligatorio">*</strong></label>
                    <ion-button
                      expand="block"
                      color="light"
                      (click)="seleccionarUbicacion()"
                      class="btn-ubicacion">
                      <ion-icon name="location-outline" slot="start"></ion-icon>
                      Seleccionar ubicaci√≥n(es)
                    </ion-button>
                  </ion-col>

                  <ion-col
                    size="12"
                    *ngIf="ubicacionesSeleccionadas.length > 0"
                    class="lista-ubicaciones">
                    <ion-list>
                      <ion-item
                        *ngFor="let u of ubicacionesSeleccionadas; let i = index"
                        class="item-ubicacion">
                        <ion-label>
                          <p class="direccion">
                            <strong>{{ direccionesTraducidas[i] }}</strong>
                          </p>
                        </ion-label>
                        <ion-button
                          color="danger"
                          fill="clear"
                          slot="end"
                          size="small"
                          (click)="eliminarUbicacion(i)"
                          class="btn-eliminar-ubicacion">
                          <ion-icon name="close-outline" slot="icon-only"></ion-icon>
                        </ion-button>
                      </ion-item>
                    </ion-list>
                  </ion-col>
                </ion-row>
              </ion-grid>

              <!-- üíæ Botones desktop / tablet -->
              <div class="botones-accion" *ngIf="tipoDispocitivo !== 'telefono'">
                <div class="boton-publicar-container" *ngIf="posicion">
                  <ion-button
                    color="danger"
                    expand="block"
                    type="button"
                    (click)="sigiente()"
                    class="btn-continuar ios-primary-btn">
                    Continuar
                    <ion-icon name="arrow-forward-outline" slot="end"></ion-icon>
                  </ion-button>
                </div>

                <div class="boton-publicar-container" *ngIf="!posicion">
                  <div class="botones-fila">
                    <ion-button
                      color="medium"
                      fill="outline"
                      expand="block"
                      type="button"
                      class="btn-crear-lote ios-secondary-btn"
                      (click)="sigiente()">
                      <ion-icon slot="start" name="arrow-back-outline"></ion-icon>
                      Atr√°s
                    </ion-button>

                    <ion-button
                      color="danger"
                      expand="block"
                      type="submit"
                      [disabled]="ubicacionesSeleccionadas.length === 0"
                      class="btn-crear-lote ios-primary-btn">
                      Crear Lote
                      <ion-icon name="save-outline" slot="end"></ion-icon>
                    </ion-button>
                  </div>
                </div>
              </div>

            </form>
          </ion-card-content>
        </ion-card>
      </ion-col>

      <!-- üìã CARD LATERAL INFO -->
      <ion-col size="12" size-md="4">
        <ion-card class="card-informativa ios-side-card">
          <ion-card-content class="contenido-info">
            <div class="pasos-container">
              <div class="paso" [class.activo]="posicion">
                <div class="numero-paso">1</div>
                <div class="texto-paso">
                  <h3>Informaci√≥n General</h3>
                  <p>Completa los datos de contacto e imagen de tu agencia seminuevos / Lote.</p>
                </div>
              </div>

              <div class="separador-pasos"></div>

              <div class="paso" [class.activo]="!posicion">
                <div class="numero-paso">2</div>
                <div class="texto-paso">
                  <h3>Ubicaci√≥n</h3>
                  <p>Selecciona la ubicaci√≥n de tu agencia seminuevos / Lote en el mapa.</p>
                </div>
              </div>
            </div>

            <div class="tips-container">
              <ion-item lines="none" class="tip-item">
                <ion-icon name="checkmark-circle-outline" slot="start" color="success"></ion-icon>
                <ion-label class="tip-text">Puedes agregar m√∫ltiples ubicaciones.</ion-label>
              </ion-item>

              <ion-item lines="none" class="tip-item">
                <ion-icon name="checkmark-circle-outline" slot="start" color="success"></ion-icon>
                <ion-label class="tip-text">
                  La imagen debe mostrar claramente tu agencia seminuevos / Lote.
                </ion-label>
              </ion-item>

              <ion-item lines="none" class="tip-item">
                <ion-icon name="checkmark-circle-outline" slot="start" color="success"></ion-icon>
                <ion-label class="tip-text">Los campos marcados con * son obligatorios.</ion-label>
              </ion-item>
            </div>
          </ion-card-content>
        </ion-card>
      </ion-col>

    </ion-row>
  </ion-grid>

  <!-- üîê No logueado -->
  <div *ngIf="!isLoggedIn" class="mensaje-autenticacion">
    Para publicar un <strong>Lote</strong>, primero debes iniciar sesi√≥n o crear una cuenta.
    <button class="btn-acceso" (click)="irAInicio()">Acceder</button>
  </div>

  <app-footer *ngIf="tipoDispocitivo !== 'telefono'"></app-footer>
</ion-content>

<!-- üì± Footer iOS solo tel√©fono -->
<ion-footer *ngIf="tipoDispocitivo === 'telefono'" class="safe-footer footer_css_seguros ios-footer">
  <ion-toolbar>

    <ion-buttons slot="start">
      <ion-button fill="clear" *ngIf="!posicion" (click)="sigiente()">
        <ion-icon slot="start" name="arrow-back-outline"></ion-icon>
        Atr√°s
      </ion-button>
    </ion-buttons>

    <ion-buttons slot="end">
      <ion-button
        *ngIf="posicion"
        color="danger"
        fill="solid"
        type="button"
        (click)="sigiente()">
        Continuar
        <ion-icon slot="end" name="arrow-forward-outline"></ion-icon>
      </ion-button>

      <ion-button
        *ngIf="!posicion"
        [disabled]="formLote.invalid"
        color="danger"
        fill="solid"
        type="submit"
        (click)="registrarLote()">
        Crear
        <ion-icon name="save-outline" slot="end"></ion-icon>
      </ion-button>
    </ion-buttons>

  </ion-toolbar>
</ion-footer>

<app-navbar></app-navbar>

<ion-content [fullscreen]="true">

  <ion-grid class="grid-container" *ngIf="isLoggedIn">
    <ion-row class="grid-row">


      <ion-col size="12" size-md="8">
        <ion-card class="formulario-lote">

          <ion-card-header class="card-header-custom">
            <div class="header-content">
              <ion-button fill="clear" color="dark" class="btn-back" (click)="regresar()">
                <ion-icon name="arrow-back-outline" slot="icon-only"></ion-icon>
              </ion-button>

              <div class="logo-title-container">
                <div class="logo-circle">
                  <ion-icon name="car-sport-outline" class="logo-icon"></ion-icon>
                </div>
                <div class="title-container">
                  <ion-card-title class="titulo-principal">Registra tu <br> agencia seminuevos / Lote</ion-card-title>
                  <ion-card-subtitle class="subtitulo" *ngIf="posicion">Completa la información</ion-card-subtitle>
                  <ion-card-subtitle class="subtitulo" *ngIf="!posicion">Agrega tu ubicación</ion-card-subtitle>
                </div>
              </div>
            </div>
          </ion-card-header>

          <ion-card-content>
            <form [formGroup]="formLote" (ngSubmit)="registrarLote()">

              <ion-grid>
                <ion-row *ngIf="posicion" class="seccion-formulario">

                  <ion-col size="12" size-md="6" class="campo-formulario">
                    <ion-label position="stacked" class="etiqueta-campo">
                      Nombre del Lote: <strong class="obligatorio">*</strong>
                    </ion-label>

                    <ion-input formControlName="nombre" placeholder="Ej. AUTOS EL RÁPIDO" maxlength="25"
                      autocapitalize="characters" inputmode="text" (ionInput)="onNombreInput($event)"
                      class="input-mayusculas"></ion-input>

                    <ion-note *ngIf="formLote.get('nombre')?.hasError('maxlength') && formLote.get('nombre')?.touched"
                      color="danger" class="mensaje-error">
                      Máximo 25 caracteres.
                    </ion-note>
                  </ion-col>

                  <ion-col size="12" size-md="6" class="campo-formulario">
                    <ion-label position="stacked" class="etiqueta-campo">Teléfono: <strong
                        class="obligatorio">*</strong></ion-label>
                    <ion-input type="number" formControlName="telefono" placeholder="Ej. 4421234567"
                      class="input-estandar"></ion-input>
                  </ion-col>

                  <ion-col size="12" size-md="6" class="campo-formulario">
                    <ion-label position="stacked" class="etiqueta-campo">Correo electrónico:
                      <strong>(opcional)</strong></ion-label>
                    <ion-input type="email" formControlName="email" placeholder="Ej. contacto@autosrapido.com"
                      class="input-estandar"></ion-input>
                  </ion-col>

                  <!-- Imagen principal -->
                  <ion-col size="12" size-md="6" class="campo-formulario">
                    <ion-label position="stacked" class="etiqueta-campo">Imagen principal de : <strong
                        class="obligatorio">*</strong></ion-label>

                    <div class="area-subida" (click)="seleccionarImagenPrincipal()">
                      <ion-icon name="camera-outline" class="icono-camara"
                        [class.oculto]="previewImagenPrincipal"></ion-icon>
                      <div *ngIf="previewImagenPrincipal" class="preview-container">
                        <img [src]="previewImagenPrincipal" alt="Imagen principal" class="imagen-preview" />
                        <button type="button" class="btn-eliminar-img"
                          (click)="eliminarImagenPrincipal(); $event.stopPropagation()">✕</button>
                      </div>
                    </div>
                  </ion-col>
                </ion-row>

                <!-- Segunda sección: ubicación -->
                <ion-row *ngIf="!posicion" class="seccion-formulario">
                  <ion-col size="12" size-md="6" class="campo-formulario">
                    <ion-label position="stacked" class="etiqueta-campo">Ubicación del lote: *</ion-label>
                    <ion-button expand="block" color="light" (click)="seleccionarUbicacion()" class="btn-ubicacion">
                      <ion-icon name="location-outline" slot="start"></ion-icon>
                      Seleccionar ubicación(es)
                    </ion-button>
                  </ion-col>

                  <ion-col size="12" *ngIf="ubicacionesSeleccionadas.length > 0" class="lista-ubicaciones">
                    <ion-list>
                      <ion-item *ngFor="let u of ubicacionesSeleccionadas; let i = index" class="item-ubicacion">
                        <ion-label>
                          <p class="direccion"><strong>{{ direccionesTraducidas[i] }}</strong></p>
                        </ion-label>
                        <ion-button color="danger" fill="clear" slot="end" size="small" (click)="eliminarUbicacion(i)"
                          class="btn-eliminar-ubicacion">
                          <ion-icon name="close-outline" slot="icon-only"></ion-icon>
                        </ion-button>
                      </ion-item>
                    </ion-list>
                  </ion-col>
                </ion-row>
              </ion-grid>

              <div class="botones-accion" *ngIf="tipoDispocitivo !== 'telefono'">
                <div class="boton-publicar-container" *ngIf="posicion">
                  <ion-button color="danger" expand="block" type="button" (click)="sigiente()" class="btn-continuar">
                    <ion-icon name="arrow-forward-outline" slot="end"></ion-icon>
                    Continuar
                  </ion-button>
                </div>

                <div class="boton-publicar-container" *ngIf="!posicion">
                  <div class="botones-fila">
                    <ion-button color="dark" expand="block" type="button" class="btn-crear-lote" (click)="sigiente()">
                      <ion-icon slot="start" name="arrow-back-outline"></ion-icon>
                      Atrás
                    </ion-button>
                    <ion-button color="danger" expand="block" type="submit"
                      [disabled]="ubicacionesSeleccionadas.length === 0" class="btn-crear-lote">
                      <ion-icon name="save-outline" slot="end"></ion-icon>
                      Crear Lote
                    </ion-button>
                  </div>
                </div>
              </div>

            </form>
          </ion-card-content>
        </ion-card>
      </ion-col>

      <ion-col size="12" size-md="4">
        <ion-card class="card-informativa">

          <ion-card-content class="contenido-info">
            <div class="pasos-container">

              <div class="paso" [class.activo]="posicion">
                <div class="numero-paso">1</div>
                <div class="texto-paso">
                  <h3>Información General</h3>
                  <p>Completa los datos de contacto e imagen del agencia seminuevos / Lote</p>
                </div>
              </div>

              <div class="separador-pasos"></div>

              <div class="paso" [class.activo]="!posicion">
                <div class="numero-paso">2</div>
                <div class="texto-paso">
                  <h3>Ubicación</h3>
                  <p>Selecciona la ubicación de tu agencia seminuevos / Lote en el mapa</p>
                </div>
              </div>
            </div>

            <div class="tips-container">
              <ion-item lines="none" class="tip-item">
                <ion-icon name="checkmark-circle-outline" slot="start" color="success"></ion-icon>
                <ion-label class="tip-text">Puedes agregar múltiples ubicaciones</ion-label>
              </ion-item>
              <ion-item lines="none" class="tip-item">
                <ion-icon name="checkmark-circle-outline" slot="start" color="success"></ion-icon>
                <ion-label class="tip-text">La imagen debe mostrar claramente tu agencia seminuevos / Lote</ion-label>
              </ion-item>
              <ion-item lines="none" class="tip-item">
                <ion-icon name="checkmark-circle-outline" slot="start" color="success"></ion-icon>
                <ion-label class="tip-text">Los campos marcados con * son obligatorios</ion-label>
              </ion-item>
            </div>
          </ion-card-content>
        </ion-card>

      </ion-col>

    </ion-row>
  </ion-grid>

  <div *ngIf="!isLoggedIn" class="mensaje-autenticacion">
    Para publicar un <strong>Lote</strong>, primero debes iniciar sesión o crear una cuenta.
    <button class="btn-acceso" (click)="irAInicio()">Acceder</button>
  </div>

  <app-footer *ngIf="tipoDispocitivo !== 'telefono'"></app-footer>
</ion-content>

<ion-footer *ngIf="tipoDispocitivo === 'telefono'" class="safe-footer footer_css_seguros">
  <ion-toolbar>

    <ion-buttons slot="start">
      <ion-button fill="clear" *ngIf="!posicion" (click)="sigiente()">
        <ion-icon slot="start" name="arrow-back-outline"></ion-icon>
        Atrás
      </ion-button>
    </ion-buttons>

    <ion-buttons slot="end">
      <ion-button *ngIf="posicion" color="danger" fill="solid" type="button" (click)="sigiente()">
        Continuar
        <ion-icon slot="end" name="arrow-forward-outline"></ion-icon>
      </ion-button>
      <ion-button *ngIf="!posicion" [disabled]="formLote.invalid" color="danger" fill="solid" type="submit"
        (click)="registrarLote()">
        Crear
        <ion-icon name="save-outline" slot="end"></ion-icon>
      </ion-button>
    </ion-buttons>

  </ion-toolbar>
</ion-footer>
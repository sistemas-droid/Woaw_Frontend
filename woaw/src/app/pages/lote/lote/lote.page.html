<ion-header mode="ios" translucent="true">
  <ion-toolbar class="ios-toolbar">
    <div class="perfil-header-ios">
      <ion-buttons slot="start">
        <ion-button fill="clear" class="ios-back-btn" (click)="volver()" aria-label="Regresar">
          <ion-icon name="chevron-back" slot="icon-only"></ion-icon>
        </ion-button>
      </ion-buttons>

      <img src="/assets/icon/logo4.png" alt="Go Autos" class="logo-ios" />

      <span *ngIf="lote" class="titulo-perfil-ios">
        {{ lote.nombre }}
      </span>
    </div>
  </ion-toolbar>
</ion-header>

<app-acomodo
  [totalAutos]="totalAutos"
  (ordenCambio)="ordenarAutos($event)"
  [titulo]="'Lote'">
</app-acomodo>

<ion-content mode="ios" [fullscreen]="true" class="page-lote-content">

  <div class="contenedor_css">
    <!-- FICHA DEL LOTE -->
    <div class="ficha-lote ios-card" *ngIf="lote">

      <!-- Título mobile -->
      <h2 class="ficha-lote__titulo titulo-mobile">
        <ion-icon name="business-outline" class="titulo-icon"></ion-icon>
        {{ lote.nombre }}
      </h2>

      <div class="ficha-lote__head">

        <div class="ficha-lote__img">
          <img
            class="ficha-lote__imagen"
            [src]="previewImagenPrincipal || ''"
            alt="Imagen de {{ lote.nombre }}"
            (click)="abrirImagen(previewImagenPrincipal || lote?.imagenPrincipal)" />
        </div>

        <div class="ficha-lote__texto">

          <!-- Título desktop -->
          <h2 class="ficha-lote__titulo titulo-desktop">
            <ion-icon name="business-outline" class="titulo-icon"></ion-icon>
            {{ lote.nombre }}
          </h2>

          <p class="ficha-lote__campo">
            <ion-icon name="call-outline"></ion-icon>
            <span (click)="copiarTelefono()">(+52){{ lote.telefonoContacto }}</span>
          </p>

          <p class="ficha-lote__campo">
            <ion-icon name="location-outline"></ion-icon>
            {{ direccionCompleta }}
          </p>

          <div class="ficha-lote__actions" *ngIf="isOwner">

            <ion-button color="dark" size="small" (click)="irADocumentos()">
              <ion-icon name="document-text-outline" slot="start"></ion-icon>
              Documentos
            </ion-button>

            <ion-button color="danger" size="small" fill="solid" class="ios-edit-btn" (click)="editarLote()">
              <ion-icon name="create-outline" slot="start"></ion-icon>
              Editar
            </ion-button>

          </div>

        </div>
      </div>
    </div>

    <!-- GRID / CATÁLOGO + PAGINACIÓN ESTILO FAVORITOS -->
    <ion-grid class="contenedor-catalogo">
      <ion-row>
        <!-- MENÚ FILTROS -->
        <ion-col size="12" size-md="3">
          <app-menu
            [filtros]="filtros"
            [filtrosAplicados]="filtrosAplicados"
            (mostrarOpciones)="mostrarOpciones($event.event, $event.tipo)"
            (limpiarFiltros)="resetearFiltros()">
          </app-menu>
        </ion-col>

        <!-- CATÁLOGO + PAGINACIÓN -->
        <ion-col size="12" size-md="9">

          <!-- Catálogo de autos, MISMO GRID que Favoritos -->
          <div class="catalogo-autos">
            <ng-container *ngFor="let auto of autosPaginados">
              <app-cartas [auto]="auto"></app-cartas>
            </ng-container>
          </div>

          <!-- Paginación iOS ROJA igual a Favoritos -->
          <div class="contenedor-paginacion-ios" *ngIf="totalPaginas > 1 && autosPaginados.length > 0">
            <p class="titulo-paginacion">más</p>
            <div class="paginacion-scroll-ios">
              <div class="paginacion-ios">

                <!-- Flecha anterior -->
                <button
                  class="pagina-ios"
                  (click)="setPagina(paginaActual - 1)"
                  [disabled]="paginaActual === 1">
                  ‹
                </button>

                <!-- Botones dinámicos -->
                <ng-container *ngFor="let i of paginasReducidas">
                  <button
                    *ngIf="esNumero(i)"
                    class="pagina-ios"
                    [class.activa]="paginaActual === i"
                    (click)="setPagina(i)">
                    {{ i }}
                  </button>
                  <span
                    *ngIf="!esNumero(i)"
                    class="ellipsis-ios">
                    ...
                  </span>
                </ng-container>

                <!-- Flecha siguiente -->
                <button
                  class="pagina-ios"
                  (click)="setPagina(paginaActual + 1)"
                  [disabled]="paginaActual === totalPaginas">
                  ›
                </button>

              </div>
            </div>
          </div>

        </ion-col>
      </ion-row>
    </ion-grid>
  </div>

  <!-- EMPTY STATE IGUAL ESTILO, PERO CON CARRO -->
  <div class="mensaje-vacio" *ngIf="autosPaginados.length === 0">
    <ion-icon name="car-sport-outline" size="large" color="medium"></ion-icon>
    <p>No se encontraron vehículos en este lote todavía.</p>
  </div>


  <!-- MODAL IMAGEN -->
  <ion-modal
    [isOpen]="modalAbierto"
    (didDismiss)="cerrarModal()"
    cssClass="modal-imagen-transparente"
    [backdropDismiss]="true">
    <ng-template>
      <ion-content class="modal-imagen-content">
        <ion-button
          fill="clear"
          class="modal-imagen__close ios-close-btn"
          (click)="cerrarModal()">
          <ion-icon name="close-outline" slot="icon-only"></ion-icon>
        </ion-button>

        <div class="modal-imagen__wrapper">
          <img *ngIf="imagenModal" [src]="imagenModal" alt="Lote imagen" />
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>

</ion-content>

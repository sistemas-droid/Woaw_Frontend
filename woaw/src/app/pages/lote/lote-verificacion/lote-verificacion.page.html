<app-navbar></app-navbar>

<ion-content [fullscreen]="true">

  <div class="verificacion-container">

    <h1 class="titulo">Verificaci√≥n de Documentos</h1>
    <p class="subtitulo">Lotes con documentaci√≥n para revisar</p>

    <!-- üîπ SI NO HAY LOTES -->
    <p *ngIf="lotesVerificacion.length === 0" class="sin-lotes">
      No hay lotes con documentos para verificar por ahora.
    </p>

    <!-- üîπ LISTA DE LOTES -->
    <div *ngFor="let lote of lotesVerificacion" class="lote-wrapper">

      <!-- ================= HEADER DEL LOTE ================= -->
      <div class="lote-header">

        <div class="lote-header-main">
          <h2 class="lote-nombre">
            {{ lote.nombre }}
          </h2>

          <p class="tipo-persona" *ngIf="lote.tipoPersona" [ngClass]="lote.tipoPersona">
            <ion-icon name="person-circle-outline" *ngIf="lote.tipoPersona === 'fisica'">
            </ion-icon>

            <ion-icon name="business-outline" *ngIf="lote.tipoPersona === 'moral'">
            </ion-icon>

            {{ lote.tipoPersona === 'fisica' ? 'Persona F√≠sica' : 'Persona Moral' }}
          </p>
        </div>

        <!-- BOT√ìN EXPANDIR -->
        <button class="btn-hamburguesa" (click)="toggleLote(lote.id)" [ngClass]="{ 'open': expandedState[lote.id] }">

          <ion-icon [name]="expandedState[lote.id]
              ? 'chevron-up-outline'
              : 'chevron-down-outline'">
          </ion-icon>
        </button>

      </div>

      <!-- ================= DOCUMENTOS ================= -->
      <div class="lote-panel" *ngIf="expandedState[lote.id]">

        <ion-card class="doc-card" *ngFor="let doc of lote.documentos">

          <ion-card-header>
            <ion-card-title class="doc-title">
              {{ doc.nombre }}
            </ion-card-title>
          </ion-card-header>

          <ion-card-content>

            <!-- Estado -->
            <div class="barra-estado" [ngClass]="colorEstado(doc.estado)">
              {{ doc.estado | uppercase }}
            </div>

            <!-- Acciones -->
            <div class="acciones">

              <ion-button color="success" size="small" [disabled]="doc.estado === 'aprobado'"
                (click)="aprobar(lote.id, doc)">
                APROBAR
              </ion-button>

              <ion-button color="danger" size="small" fill="outline" [disabled]="doc.estado === 'aprobado'"
                (click)="rechazar(lote.id, doc)">
                RECHAZAR
              </ion-button>

              <ion-button fill="clear" size="small" (click)="abrir(doc)" [disabled]="!doc.url">
                VER DOCUMENTO
              </ion-button>

            </div>

          </ion-card-content>

        </ion-card>

      </div>

    </div>

  </div>

  <!-- MODAL RECHAZO -->
  <ion-modal [isOpen]="modalRechazoOpen" (didDismiss)="cerrarModalRechazo()">

    <ng-template>
      <div class="modal-box">
        <h2>Motivo de rechazo</h2>

        <ion-textarea placeholder="Describe el motivo..." [(ngModel)]="comentarioRechazo">
        </ion-textarea>

        <ion-button expand="block" color="danger" (click)="confirmarRechazo()">
          Enviar Rechazo
        </ion-button>

        <ion-button expand="block" fill="clear" (click)="cerrarModalRechazo()">
          Cancelar
        </ion-button>
      </div>
    </ng-template>

  </ion-modal>

  <app-footer></app-footer>

</ion-content>
<app-navbar></app-navbar>

<ion-content [fullscreen]="true">

  <div class="verificacion-container">
    <h1 class="titulo titulo-woaw">
      Verificación de Documentos
    </h1>
    <p class="subtitulo">
      Lotes con documentación para revisar
    </p>

    <p *ngIf="lotesVerificacion.length === 0" class="sin-lotes">
      No hay lotes con documentos para verificar por ahora.
    </p>

    <div *ngFor="let lote of lotesVerificacion" class="lote-wrapper">

      <!-- HEADER DEL LOTE -->
      <div class="lote-header">

        <div class="lote-header-main">
          <h2 class="lote-nombre">{{ lote.nombre }}</h2>

          <p class="tipo-persona" *ngIf="lote.tipoPersona" [ngClass]="lote.tipoPersona">
            <ion-icon [name]="lote.tipoPersona === 'fisica'
                ? 'person-circle-outline'
                : 'business-outline'">
            </ion-icon>

            {{ lote.tipoPersona === 'fisica' ? 'Persona Física' : 'Persona Moral' }}
          </p>
        </div>

        <!-- BOTÓN EXPANDIR -->
        <button class="btn-hamburguesa" (click)="toggleLote(lote.id)" [ngClass]="{ open: expandedState[lote.id] }">
          <ion-icon [name]="expandedState[lote.id]
              ? 'chevron-up-outline'
              : 'chevron-down-outline'">
          </ion-icon>
        </button>

      </div>

      <!-- DOCUMENTOS -->
      <div class="lote-panel" *ngIf="expandedState[lote.id]">

        <ion-card class="doc-card" *ngFor="let doc of lote.documentos" [ngClass]="{ 'doc-sin-documento': !doc.url }">

          <ion-card-header>
            <ion-card-title class="doc-title">
              {{ doc.nombre }}
            </ion-card-title>
          </ion-card-header>

          <ion-card-content>

            <!-- BARRA DE ESTADO -->
            <div class="barra-estado" [ngClass]="!doc.url ? 'sin-doc' : colorEstado(doc.estado)">
              {{ !doc.url ? 'SIN DOCUMENTO' : (doc.estado | uppercase) }}
            </div>

            <!-- ACCIONES -->
            <div class="acciones">

              <ion-button color="success" size="small" [disabled]="!doc.url || doc.estado === 'aprobado'"
                (click)="aprobar(lote.id, doc)">
                APROBAR
              </ion-button>

              <ion-button color="danger" size="small" fill="outline" [disabled]="!doc.url || doc.estado === 'aprobado'"
                (click)="rechazar(lote.id, doc)">
                RECHAZAR
              </ion-button>

              <ion-button fill="clear" size="small" [disabled]="!doc.url" (click)="abrir(doc)">
                VER DOCUMENTO
              </ion-button>

            </div>

          </ion-card-content>

        </ion-card>

      </div>

    </div>
  </div>

  <!-- MODAL RECHAZO -->
  <ion-modal [isOpen]="modalRechazoOpen" (didDismiss)="cerrarModalRechazo()">
    <ng-template>
      <div class="modal-box">
        <h2>Motivo de rechazo</h2>

        <ion-textarea placeholder="Describe el motivo..." [(ngModel)]="comentarioRechazo">
        </ion-textarea>

        <ion-button expand="block" color="danger" (click)="confirmarRechazo()">
          Enviar Rechazo
        </ion-button>

        <ion-button expand="block" fill="clear" (click)="cerrarModalRechazo()">
          Cancelar
        </ion-button>
      </div>
    </ng-template>
  </ion-modal>

  <app-footer></app-footer>

</ion-content>
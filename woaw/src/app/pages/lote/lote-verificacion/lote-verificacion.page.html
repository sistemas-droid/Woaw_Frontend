<app-navbar></app-navbar>

<ion-content [fullscreen]="true" class="ios-verif">

  <div class="verif-wrap">

    <!-- HEADER -->
    <header class="verif-hero">
      <div class="hero-text">
        <h1 class="titulo">Verificaci√≥n de Documentos</h1>
        <p class="subtitulo">Lotes con documentaci√≥n para revisar</p>
      </div>

      <div class="hero-chip">
        <ion-icon name="shield-checkmark-outline"></ion-icon>
        <span>{{ lotesVerificacion?.length || 0 }}</span>
      </div>
    </header>

    <!-- üîπ SI NO HAY LOTES -->
    <section *ngIf="lotesVerificacion.length === 0" class="empty-state">
      <div class="empty-card">
        <ion-icon name="file-tray-outline"></ion-icon>
        <h2>No hay lotes por ahora</h2>
        <p>No hay documentos pendientes de verificaci√≥n en este momento.</p>
      </div>
    </section>

    <!-- üîπ LISTA DE LOTES -->
    <section *ngFor="let lote of lotesVerificacion" class="lote-ios">

      <!-- ================= HEADER DEL LOTE ================= -->
      <button class="lote-head" type="button" (click)="toggleLote(lote.id)">
        <div class="head-left">
          <h2 class="lote-nombre">{{ lote.nombre }}</h2>

          <p class="tipo-persona" *ngIf="lote.tipoPersona" [ngClass]="lote.tipoPersona">
            <ion-icon
              name="person-circle-outline"
              *ngIf="lote.tipoPersona === 'fisica'">
            </ion-icon>

            <ion-icon
              name="business-outline"
              *ngIf="lote.tipoPersona === 'moral'">
            </ion-icon>

            {{ lote.tipoPersona === 'fisica' ? 'Persona F√≠sica' : 'Persona Moral' }}
          </p>
        </div>

        <div class="head-right">
          <span class="docs-count">
            {{ lote.documentos?.length || 0 }} docs
          </span>

          <span class="chev" [ngClass]="{ 'open': expandedState[lote.id] }">
            <ion-icon
              [name]="expandedState[lote.id] ? 'chevron-up-outline' : 'chevron-down-outline'">
            </ion-icon>
          </span>
        </div>
      </button>

      <!-- ================= DOCUMENTOS ================= -->
      <div class="lote-panel" *ngIf="expandedState[lote.id]">

        <ion-card class="doc-card-ios" *ngFor="let doc of lote.documentos">

          <ion-card-header class="doc-head">
            <ion-card-title class="doc-title">
              {{ doc.nombre }}
            </ion-card-title>

            <div class="estado-pill" [ngClass]="colorEstado(doc.estado)">
              <span class="dot"></span>
              {{ doc.estado | uppercase }}
            </div>
          </ion-card-header>

          <ion-card-content class="doc-body">

            <div class="acciones">

              <ion-button
                color="success"
                size="small"
                class="btn-aprobar"
                [disabled]="doc.estado === 'aprobado'"
                (click)="aprobar(lote.id, doc)">
                Aprobar
              </ion-button>

              <ion-button
                color="danger"
                size="small"
                fill="outline"
                class="btn-rechazar"
                [disabled]="doc.estado === 'aprobado'"
                (click)="rechazar(lote.id, doc)">
                Rechazar
              </ion-button>

              <ion-button
                fill="clear"
                size="small"
                class="btn-ver"
                (click)="abrir(doc)"
                [disabled]="!doc.url">
                Ver documento
                <ion-icon slot="end" name="chevron-forward-outline"></ion-icon>
              </ion-button>

            </div>

          </ion-card-content>

        </ion-card>

      </div>

    </section>

  </div>

  <!-- MODAL RECHAZO -->
  <ion-modal
    [isOpen]="modalRechazoOpen"
    (didDismiss)="cerrarModalRechazo()"
    class="modal-ios"
  >
    <ng-template>
      <div class="modal-box-ios">
        <div class="modal-title">
          <ion-icon name="alert-circle-outline"></ion-icon>
          <h2>Motivo de rechazo</h2>
        </div>

        <p class="modal-sub">
          Describe brevemente por qu√© se rechaza el documento.
        </p>

        <ion-item lines="none" class="modal-textarea">
          <ion-textarea
            placeholder="Ej. Documento borroso / No coincide el RFC / Falta firma..."
            [(ngModel)]="comentarioRechazo"
            autoGrow="true"
          ></ion-textarea>
        </ion-item>

        <ion-button expand="block" color="danger" class="modal-btn" (click)="confirmarRechazo()">
          Enviar rechazo
        </ion-button>

        <ion-button expand="block" fill="clear" class="modal-cancel" (click)="cerrarModalRechazo()">
          Cancelar
        </ion-button>
      </div>
    </ng-template>
  </ion-modal>

  <app-footer></app-footer>

</ion-content>
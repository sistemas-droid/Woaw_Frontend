<app-navbar></app-navbar>

<ion-content [fullscreen]="true" class="bg-asesores">

  <div class="contenedor-asesores">
    <!-- ENCABEZADO -->
    <div class="encabezado-asesores">
      <div class="heading-left">
        <h1>Nuestros asesores</h1>
        <p>Selecciona al asesor que se encargará de brindarte la mejor atención.</p>
      </div>
    </div>

    <!-- LOADING -->
    <div class="loading" *ngIf="cargando">
      <ion-spinner name="crescent"></ion-spinner>
      <p>Cargando asesores…</p>
    </div>

    <!-- ERROR -->
    <div class="error" *ngIf="error">
      <p>No se pudieron cargar los asesores.</p>
      <ion-button size="small" (click)="cargarAsesores()">Reintentar</ion-button>
    </div>

    <!-- GRID DE ASESORES -->
    <ion-grid class="grid-asesores">
      <ion-row>
        <ion-col size="12" sizeMd="10" sizeLg="8" sizeXl="6" class="col-asesor" *ngFor="let asesor of asesores">

          <div class="tarjeta-asesor">

            <div class="asesor-avatar">
              <img *ngIf="asesor?.foto" [src]="asesor.foto" alt="Foto asesor" class="avatar-img" />
              <span *ngIf="!asesor?.foto">{{ getIniciales(nombreCompleto(asesor)) }}</span>
            </div>

            <div class="asesor-info">
              <h2>{{ nombreCompleto(asesor) }}</h2>
              <p class="rol">{{ asesor.rol || 'Asesor Comercial' }}</p>

              <p class="dato" *ngIf="asesor.telefono">
                <ion-icon name="call-outline"></ion-icon>
                {{ asesor.telefono }}
              </p>

              <p class="dato" *ngIf="asesor.email">
                <ion-icon name="mail-outline"></ion-icon>
                {{ asesor.email }}
              </p>
            </div>

            <!-- SOLO QR aquí -->
            <div class="asesor-qr">
              <div class="qr-wrapper">
                <img src="/assets/autos/QR.png" [alt]="'Código QR de ' + nombreCompleto(asesor)" />
              </div>
            </div>

            <!-- BOTONES abajo -->
            <div class="acciones-asesor">
              <button type="button" class="btn-link-qr" (click)="abrirLink(asesor.telefono)"
                [disabled]="!asesor.telefono">
                <ion-icon name="link-outline"></ion-icon>
                <span>Ver enlace</span>
              </button>

              <button type="button" class="btn-editar-asesor" (click)="editarAsesor(asesor)" [disabled]="!asesor._id">
                <ion-icon name="create-outline"></ion-icon>
                <span>Editar</span>
              </button>

              <button *ngIf="isAdmin" type="button" class="btn-eliminar-asesor" (click)="confirmarEliminar(asesor)"
                [disabled]="!asesor._id || eliminandoId === asesor._id" aria-label="Eliminar asesor">
                <ion-icon name="trash-outline"></ion-icon>
                <span *ngIf="eliminandoId !== asesor._id">Eliminar</span>
                <span *ngIf="eliminandoId === asesor._id">Eliminando…</span>
              </button>
            </div>

          </div>


        </ion-col>
      </ion-row>
    </ion-grid>

  </div>

  <ion-modal [isOpen]="modalEliminarOpen" (didDismiss)="cerrarModalEliminar()" cssClass="woaw-modal-eliminar">
    <ng-template>
      <div class="woaw-modal-center">
        <div class="modal-card">
          <div class="modal-head">
            <div class="title-wrap">
              <h3>Eliminar asesor</h3>
              <span class="badge-danger">Acción crítica</span>
            </div>

            <button type="button" class="x-btn" (click)="cerrarModalEliminar()" aria-label="Cerrar">
              <ion-icon name="close-outline"></ion-icon>
            </button>
          </div>

          <div class="modal-body">
            <p>
              Vas a eliminar a
              <strong>{{ asesorAEliminar ? nombreCompleto(asesorAEliminar) : 'este asesor' }}</strong>.
            </p>
            <p class="warn">Esta acción no se puede deshacer.</p>
          </div>

          <div class="modal-actions">
            <button type="button" class="btn-modal btn-cancel" (click)="cerrarModalEliminar()">
              Cancelar
            </button>

            <button type="button" class="btn-modal btn-danger" (click)="confirmarEliminarModal()"
              [disabled]="!asesorAEliminar?._id || eliminandoId === asesorAEliminar?._id">
              <ion-icon name="trash-outline"></ion-icon>
              <span *ngIf="eliminandoId !== asesorAEliminar?._id">Eliminar</span>
              <span *ngIf="eliminandoId === asesorAEliminar?._id">Eliminando…</span>
            </button>
          </div>
        </div>
      </div>
    </ng-template>
  </ion-modal>

  <app-footer></app-footer>
</ion-content>
<app-navbar></app-navbar>

<ion-content [fullscreen]="true" class="arrendamiento-ios" #contenidoScroll>

  <!--  Hero de arrendamiento en mood iOS -->
  <div class="hero-arr-ios">
    <img
      src="/assets/autos/publicidad/arrendamiento.webp"
      alt="Fondo arrendamiento"
      class="hero-img-ios"
    />

    <div class="hero-overlay-ios">
      <h1>Arrendamiento Puro</h1>
      <p>
        Elige la opci贸n que m谩s se adapte a tu negocio o estilo de vida. Con Wo-Aw
        puedes arrendar f谩cilmente un coche o un cami贸n, sin complicaciones.
      </p>
    </div>
  </div>

  <!-- PRIMER BLOQUE (COCHES / CAMIONES) -->
  <section class="contenedor_primero_ios" *ngIf="!selecionaVehiculo">
    <div class="columna-izquierda">
      <h2>Arrendamiento Puro</h2>
      <p>
        Elige la opci贸n que m谩s se adapte a tu negocio o estilo de vida. Con
        Wo-Aw puedes arrendar f谩cilmente un coche o un cami贸n, sin
        complicaciones.
      </p>
    </div>

    <div class="columna-derecha">
      <div class="card-opcion-ios" (click)="cambiarTipo('coches')">
        <img class="img_coche" src="/assets/autos/arre1.webp" alt="Coche" />
        <h3>COCHES</h3>
        <p>Veh铆culos ideales para uso personal o corporativo.</p>
        <button class="btn-card-ios">
          Arrendar Coche
        </button>
      </div>

      <div class="card-opcion-ios" (click)="cambiarTipo('camiones')">
        <img class="img_camion" src="/assets/autos/arre2.png" alt="Cami贸n" />
        <h3>CAMIONES</h3>
        <p>Soluciones de transporte para empresas y log铆stica.</p>
        <button class="btn-card-ios">
          Arrendar Cami贸n
        </button>
      </div>
    </div>


  </section>

  <!-- BLOQUE DE MARCAS + FORM -->
  <section class="contenedor_arrendamiento" *ngIf="selecionaVehiculo">
    <div id="top-seccion-arrendamiento-marcas" class="contenedor-arrendamiento-ios">
      <p class="titulo_seccion_ios">{{ tipoSeleccionado }}</p>

      <div class="encabezado-arrendamiento-ios">
        <!-- Botones regresar -->
        <button class="btn-regresar-ios" *ngIf="!mostrarModelos" (click)="regresarAntes()">
          <ion-icon name="arrow-back-outline"></ion-icon>
          Regresar
        </button>
        <button class="btn-regresar-ios" *ngIf="mostrarModelos" (click)="regresar()">
          <ion-icon name="arrow-back-outline"></ion-icon>
          Regresar
        </button>

        <img
          *ngIf="mostrarModelos"
          class="img_logo_ios"
          [src]="marcaSeleccionada?.imageUrl"
          [alt]="marcaSeleccionada?.nombre"
          loading="lazy"
        />

        <!-- Buscador -->
        <div class="buscador-ios" *ngIf="!mostrarModelos">
          <ion-icon name="search-outline"></ion-icon>
          <input
            type="text"
            placeholder="Buscar marca..."
            [(ngModel)]="terminoBusqueda"
            (ngModelChange)="onBuscar($event)"
          />
        </div>
      </div>

      <!-- LISTA DE MARCAS -->
      <ng-container *ngIf="!mostrarModelos">
        <div class="contenedor-marcas-ios">
          <!-- Coches -->
          <ng-container *ngIf="tipoSeleccionado === 'coches'">
            <ng-container *ngFor="let marca of filteredOpciones">
              <div
                class="marca-card-ios"
                *ngIf="marca.imagenValida"
                [class.seleccionado]="marca.key === marcaSeleccionada?.key"
                (click)="seleccionarMarca(marca)"
              >
                <img
                  [src]="marca.imageUrl"
                  [alt]="marca.nombre"
                  (error)="marca.imagenValida = false"
                />
                <span class="marca-nombre-grid" [title]="marca.nombre">
                  {{ marca.nombre }}
                </span>
              </div>
            </ng-container>
          </ng-container>

          <!-- Camiones -->
          <ng-container *ngIf="tipoSeleccionado === 'camiones'">
            <ng-container *ngFor="let marca of filteredOpcionesCamiones">
              <div
                class="marca-card-ios"
                *ngIf="marca.imagenValida"
                [class.seleccionado]="marca._id === marcaSeleccionada?._id"
                (click)="seleccionarMarca(marca)"
              >
                <img
                  [src]="marca.imageUrl"
                  [alt]="marca.nombre"
                  (error)="marca.imagenValida = false"
                />
                <span class="marca-nombre-grid" [title]="marca.nombre">
                  {{ marca.nombre }}
                </span>
              </div>
            </ng-container>
          </ng-container>
        </div>

        <!-- CTA SELECCIONAR MARCA / MODELO -->
        <div class="contenedor-arrendar-grid-ios">
          <div class="info-coche" *ngIf="marcaSeleccionada">
            <img
              [src]="marcaSeleccionada.imageUrl"
              [alt]="marcaSeleccionada.nombre"
              class="logo-marca"
            />
            <h4 class="nombre-marca">{{ marcaSeleccionada.nombre }}</h4>
          </div>

          <div
            class="cta-arrendar-ios"
            *ngIf="marcaSeleccionada"
            (click)="confirmarArrendamiento()"
          >
            <span class="texto-arrendar">
              Selecciona <strong>Modelo</strong>
            </span>
            <ion-icon name="chevron-forward-outline" class="icono-flecha"></ion-icon>
          </div>

          <div
            class="cta-arrendar-ios cta-muted"
            *ngIf="!marcaSeleccionada"
            (click)="selecionaMarca()"
          >
            <span class="texto-arrendar">
              Selecciona <strong>Marca</strong>
            </span>
            <ion-icon name="arrow-up-circle-outline" class="icono-flecha-arriba"></ion-icon>
          </div>
        </div>
      </ng-container>

      <!-- FORMULARIO (MODELOS + DATOS) -->
      <ng-container *ngIf="mostrarModelos">
        <div class="contenedor-modelos-ios">
          <form [formGroup]="formArrendamiento" (ngSubmit)="enviarSolicitud('Email')">
            <ion-grid>
              <!-- DATOS GENERALES -->
              <ion-row>
                <ion-col size="12" size-md="4">
                  <label class="wo-label">Nombre completo: <strong>*</strong></label>
                  <div class="wo-control">
                    <ion-input
                      formControlName="nombre"
                      placeholder="Ej. Juan P茅rez"
                    ></ion-input>
                  </div>
                </ion-col>

                <ion-col size="12" size-md="4">
                  <label class="wo-label">Tipo de persona: <strong>*</strong></label>
                  <div class="wo-control">
                    <ion-select
                      class="wo-select"
                      formControlName="tipoPersona"
                      mode="ios"
                      interface="alert"
                      placeholder="Selecciona"
                    >
                      <ion-select-option value="Persona F铆sica Actividad Empresarial">
                        Persona F铆sica Actividad Empresarial
                      </ion-select-option>
                      <ion-select-option value="Moral">
                        Persona Moral
                      </ion-select-option>
                    </ion-select>
                  </div>
                </ion-col>

                <ion-col size="12" size-md="4">
                  <label class="wo-label">C贸digo Postal: <strong>*</strong></label>
                  <div class="wo-control">
                    <ion-input
                      type="number"
                      formControlName="cp"
                      placeholder="-----"
                    ></ion-input>
                  </div>
                </ion-col>

                <ion-col size="12" size-md="4">
                  <label class="wo-label">RFC: <strong>*</strong></label>
                  <div class="wo-control">
                    <ion-input
                      type="text"
                      formControlName="rfc"
                      placeholder="*********"
                    ></ion-input>
                  </div>
                </ion-col>

                <ion-col size="12" size-md="4">
                  <label class="wo-label">Correo electr贸nico: <strong>*</strong></label>
                  <div class="wo-control">
                    <ion-input
                      type="email"
                      formControlName="correo"
                      placeholder="Ej. juan@mail.com"
                    ></ion-input>
                  </div>
                </ion-col>

                <ion-col size="12" size-md="4">
                  <label class="wo-label">Plazo: <strong>*</strong></label>
                  <div class="wo-control">
                    <ion-select
                      class="wo-select"
                      formControlName="plazo"
                      mode="ios"
                      interface="alert"
                      placeholder="Selecciona plazo"
                    >
                      <ion-select-option value="12">12 meses</ion-select-option>
                      <ion-select-option value="24">24 meses</ion-select-option>
                      <ion-select-option value="36">36 meses</ion-select-option>
                      <ion-select-option value="48">48 meses</ion-select-option>
                    </ion-select>
                  </div>
                </ion-col>
              </ion-row>

              <!-- SELECT DE MODELOS -->
              <ion-row>
                <ion-col size="12" size-md="6">
                  <ion-label class="wo-label">Modelos: <strong>*</strong></ion-label>
                  <div class="wo-control">
                    <ion-select
                      class="wo-select"
                      placeholder="Selecciona modelos"
                      multiple="true"
                      interface="alert"
                      mode="ios"
                      [value]="modelosSeleccionados"
                      (ionChange)="onModelosChange($event)"
                    >
                      <ion-select-option
                        *ngFor="let modelo of modelos"
                        [value]="modelo"
                      >
                        {{ modelo.modelo }}
                      </ion-select-option>
                    </ion-select>
                  </div>
                </ion-col>
              </ion-row>

              <!-- TABLA VERSIONES (SOLO COCHES) -->
              <ng-container *ngIf="tipoSeleccionado !== 'camiones'">
                <ion-row *ngIf="modelosConVersiones.length > 0">
                  <ion-col size="12">
                    <ion-card class="tabla-versiones">
                      <ion-card-header>
                        <ion-card-title>Modelos seleccionados y versiones</ion-card-title>
                      </ion-card-header>
                      <ion-card-content>
                        <ion-grid class="grid-compacta">
                          <ion-row class="ion-text-center encabezado-tabla">
                            <ion-col size="4"><strong>Modelo</strong></ion-col>
                            <ion-col size="8"><strong>Versi贸n</strong></ion-col>
                          </ion-row>

                          <ion-row
                            *ngFor="let item of modelosConVersiones; let i = index"
                            class="fila-version"
                          >
                            <!-- Modelo -->
                            <ion-col size="4" class="ellipsis">
                              {{ item.modelo.modelo }}
                            </ion-col>

                            <!-- Select versiones -->
                            <ion-col size="8">
                              <div class="wo-control wo-compact">
                                <ion-select
                                  class="wo-select"
                                  [name]="'version-' + i"
                                  multiple="true"
                                  interface="alert"
                                  mode="ios"
                                  placeholder="Selecciona versi贸n"
                                  [(ngModel)]="modelosConVersiones[i].versionSeleccionada"
                                  [ngModelOptions]="{ standalone: true }"
                                >
                                  <ion-select-option
                                    *ngFor="let version of item.versiones"
                                    [value]="version"
                                  >
                                    {{ version }}
                                  </ion-select-option>
                                </ion-select>
                              </div>
                            </ion-col>
                          </ion-row>
                        </ion-grid>
                      </ion-card-content>
                    </ion-card>
                  </ion-col>
                </ion-row>
              </ng-container>

              <!-- BOTONES DE ENVO -->
              <ion-row class="ion-justify-content-center" style="gap: 12px;">
                <!-- Bot贸n rojo -->
                <button type="submit" class="button-native custom-btn danger">
                  <ion-icon name="mail-open-outline"></ion-icon>
                  Enviar Gmail
                </button>

                <!-- Bot贸n verde (WhatsApp) -->
                <button
                  type="button"
                  class="button-native custom-btn success"
                  (click)="enviarSolicitud('Wh')"
                >
                  <ion-icon name="logo-whatsapp" slot="start"></ion-icon>
                  WhatsApp
                </button>
              </ion-row>
            </ion-grid>
          </form>
        </div>
      </ng-container>
    </div>

    <div #infoArrendamiento></div>
  </section>

  <!-- SECCIN ABAJO (GRID INFO) -->
  <section class="grid-arrendamiento-ios despues_de_imagen">
    <ion-grid>
      <ion-row>
        <ion-col size="12" size-md="4">
          <div class="tarjeta-arr-ios">
            <h5><ion-icon name="car-sport-outline"></ion-icon> 驴QU ES?</h5>
            <p>
              El arrendamiento puro te permite utilizar un auto nuevo pagando
              una renta mensual, sin adquirir deuda ni comprometer tu flujo de
              efectivo. Ideal para empresas y profesionistas con beneficios
              fiscales.
            </p>
          </div>
        </ion-col>

        <ion-col size="12" size-md="4">
          <div class="tarjeta-arr-ios">
            <h5><ion-icon name="thumbs-up-outline"></ion-icon> BENEFICIOS</h5>
            <ul>
              <li><ion-icon name="checkmark-circle-outline"></ion-icon> 100% deducible en impuestos</li>
              <li><ion-icon name="cash-outline"></ion-icon> Inversi贸n inicial baja</li>
              <li><ion-icon name="wallet-outline"></ion-icon> Financiaci贸n completa del veh铆culo</li>
              <li><ion-icon name="close-circle-outline"></ion-icon> No se registra como deuda</li>
              <li><ion-icon name="locate-outline"></ion-icon> Incluye GPS de monitoreo</li>
              <li><ion-icon name="calendar-outline"></ion-icon> Plazos de 12 a 60 meses</li>
            </ul>
          </div>
        </ion-col>

        <ion-col size="12" size-md="4">
          <div class="tarjeta-arr-ios">
            <h5><ion-icon name="document-text-outline"></ion-icon> REQUISITOS</h5>
            <ul>
              <li><ion-icon name="document-outline"></ion-icon> Llenar solicitud</li>
              <li><ion-icon name="business-outline"></ion-icon> RFC y constancia de situaci贸n fiscal</li>
              <li><ion-icon name="card-outline"></ion-icon> Identificaci贸n oficial</li>
              <li><ion-icon name="home-outline"></ion-icon> Comprobante de domicilio</li>
              <li><ion-icon name="bar-chart-outline"></ion-icon> Opini贸n positiva del SAT</li>
            </ul>
          </div>
        </ion-col>
      </ion-row>
    </ion-grid>
  </section>

  <app-footer></app-footer>
</ion-content>

<app-navbar></app-navbar>


<ion-content [fullscreen]="true" class="ios-poliza">

  <app-spinner *ngIf="mostrar_spinnet"></app-spinner>
  <app-otros-seguros [refreshKey]="islandKey" *ngIf="tipoDispocitivo === 'telefono'"></app-otros-seguros>


  <div class="fondo-seguros">
    <img src="/assets/autos/seguro_fondo.webp" alt="">
    <span class="fondo-seguros__overlay"></span>
  </div>

  <div class="split-woaw-seguros" style="--left: 80%; --right: 20%; --gap: 1px;">

    <div class="divicion1">
      <div class="poliza">
        <section class="poliza__card">

          <!-- Bloques de progreso -->
          <div class="carta__steps" *ngIf="!statusUserDtos && !statusBuscar" role="group"
            aria-label="Progreso de cotización">
            <div class="carta__step" [class.is-active]="currentStepform >= 1" aria-hidden="true"></div>
            <div class="carta__step" [class.is-active]="currentStepform >= 2" aria-hidden="true"></div>
            <div class="carta__step" [class.is-active]="currentStepform >= 3" aria-hidden="true"></div>
            <div class="carta__step" [class.is-active]="currentStepform >= 4" aria-hidden="true"></div>
          </div>

          <div class="header-row">
            <h1 *ngIf="!statusBuscar">Mis datos</h1>
            <h1 *ngIf="statusBuscar">Ingresa RFC o Email</h1>
            <div class="search-box">
              <button *ngIf="!statusBuscar" (click)="buscarSeccion()">Buscar por RFC o Email<ion-icon
                  name="search-outline"></ion-icon></button>
              <button *ngIf="statusBuscar" (click)="buscarSeccion()">Cancelar &#x274C;</button>
            </div>
          </div>

          <div class="buscar_persona" *ngIf="statusBuscar">
            <form [formGroup]="buscarForm" (ngSubmit)="onBuscar()">
              <input type="text" formControlName="valuebuscar" placeholder="Ingresa RFC Gmail" />
              <button type="submit" [disabled]="buscarForm.invalid">Buscar</button>
            </form>
          </div>

          <div class="contenedos_info" *ngIf="UsuarioRespuesta && statusUserDtos && !statusBuscar">
            <div class="info-card">
              <div class="botones-acciones">
                <button type="button" class="edit-btn btn-add" (click)="editarUser()">Nuevo &#43;</button>
                <button type="button" class="edit-btn btn-delete" (click)="olvidarUser()">
                  Olvidar usuario &#10005;
                </button>
              </div>

              <div class="row">
                <div class="label">Nombre</div>
                <div class="value">
                  {{ UsuarioRespuesta.response.first_name }} {{ UsuarioRespuesta.response.first_last_name }} {{
                  UsuarioRespuesta.response.second_last_name }}
                </div>
              </div>
              <div class="row">
                <div class="label">Cumpleaños</div>
                <div class="value">
                  {{ UsuarioRespuesta.response.birthdate | date:'dd/MM/yyyy' }}
                </div>
              </div>
              <div class="row">
                <div class="label">Dirección</div>
                <div class="value">
                  {{ UsuarioRespuesta.response.address?.street }} {{ UsuarioRespuesta.response.address?.external_number
                  }}
                  <span *ngIf="UsuarioRespuesta.response.address?.internal_number">Int. {{
                    UsuarioRespuesta.response.address?.internal_number }}</span>,
                  {{ UsuarioRespuesta.response.address?.neighborhood }}, C.P. {{
                  UsuarioRespuesta.response.address?.postal_code }}
                </div>
              </div>
              <div class="row">
                <div class="label">Estado</div>
                <div class="value">{{ UsuarioRespuesta.response.address?.state_code }}</div>
              </div>
              <div class="row">
                <div class="label">Teléfono</div>
                <div class="value">{{ UsuarioRespuesta.response.phone }}</div>
              </div>
              <div class="row">
                <div class="label">Sexo</div>
                <div class="value">
                  <span class="badge">{{ UsuarioRespuesta.response.gender_code === 1 ? 'Hombre' :
                    UsuarioRespuesta.response.gender_code
                    === 2 ? 'Mujer' : '—' }}</span>
                </div>
              </div>
              <div class="row">
                <div class="label">email</div>
                <div class="value mono">{{ UsuarioRespuesta.response.email }}</div>
              </div>
              <div class="row">
                <div class="label">RFC</div>
                <div class="value mono">{{ UsuarioRespuesta.response.rfc }}</div>
              </div>
            </div>
            <div *ngIf="tipoDispocitivo !== 'telefono'" class="paybox__cta">
              <button type="button" class="btn-secondary" (click)="regresarInicio()">&#x2B05;
                Regresar
              </button>
              <button type="button" class="btn-primary" (click)="nuevosDatos()">
                Continuar &#x27A1;
              </button>
            </div>
          </div>

          <form *ngIf="!statusUserDtos && !statusBuscar" [formGroup]="form_poliza" (ngSubmit)="siguiente()">

            <!-- SECCION FORMULARIO 1  -->
            <div class="field_persona" *ngIf="currentStepform === 1">
              <!-- <p class="header">Crear persona</p> -->
              <h1 class="pregunta">¿Qué tipo de persona eres?</h1>
              <div class="persona-radio">
                <label class="radio-card">
                  <input type="radio" formControlName="tipoPersona" value="fisica" />
                  <span>Física</span>
                </label>

                <label class="radio-card">
                  <input type="radio" formControlName="tipoPersona" value="moral" />
                  <span>Moral</span>
                </label>
              </div>
            </div>

            <!-- <h1 *ngIf="currentStepform !== 1" class="header">Ingresa tus datos</h1> -->

            <!-- ESTO VA A ESTAR SIEMPRE  -->
            <ng-container *ngIf="datosCoche && currentStepform !== 1">
              <table class="tabla-resumen-horizontal">
                <thead>
                  <tr>
                    <th>Marca</th>
                    <th>Modelo</th>
                    <th>Año</th>
                    <th>Nacimiento</th>
                    <th>C.P.</th>
                    <th *ngIf="tipoPersonaSeleccionada === 'fisica'">Género</th>
                    <th *ngIf="tipoPersonaSeleccionada === 'fisica'">Estado civil</th>
                    <th>Versión</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>{{ datosCoche.marca }}</td>
                    <td>{{ datosCoche.modelo }}</td>
                    <td>{{ datosCoche.anio }}</td>
                    <td>{{ datosCoche.nacimiento.dia }}/{{ datosCoche.nacimiento.mes }}/{{ datosCoche.nacimiento.anio }}
                    </td>
                    <td>{{ datosCoche.cp }}</td>
                    <td *ngIf="tipoPersonaSeleccionada === 'fisica'">{{ datosCoche.genero }}</td>
                    <td *ngIf="tipoPersonaSeleccionada === 'fisica'">{{ datosCoche.estadoCivil }}</td>
                    <td>{{ datosCoche.version }}</td>
                  </tr>
                </tbody>
              </table>
            </ng-container>


            <!-- SECCION FORMULARIO 2  -->
            <div class="field field-grid" *ngIf="currentStepform === 2">
              <div>
                <label for="telefono">Teléfono<span>*</span></label>
                <div class="control">
                  <input id="telefono" type="number" class="form-input" placeholder="Ej. 4412654387"
                    formControlName="telefono" />
                </div>
                <p *ngIf="analizaForm('telefono')" class="error">Ingresa tu número</p>
              </div>
              <div>
                <label for="calle">calle<span>*</span></label>
                <div class="control">
                  <input id="calle" type="text" class="form-input" placeholder="Av. bulevares"
                    formControlName="calle" />
                </div>
                <p *ngIf="analizaForm('calle')" class="error">Ingresa tu calle</p>
              </div>
              <div>
                <label for="ext">Num. Exterior<span>*</span></label>
                <div class="control">
                  <input id="ext" type="text" class="form-input" placeholder="Ext" formControlName="ext" />
                </div>
                <p *ngIf="analizaForm('ext')" class="error">Ingresa tu número exterior</p>
              </div>
              <div>
                <label for="int" style="margin-top: 4px;">Num. Interior (opcional)</label>
                <div class="control">
                  <input id="int" type="text" class="form-input" placeholder="Int" formControlName="int" />
                </div>
              </div>
              <div>
                <label for="col">Colonia<span>*</span></label>
                <div class="control">
                  <input id="col" type="text" class="form-input" placeholder="Colonia" formControlName="col" />
                </div>
                <p *ngIf="analizaForm('col')" class="error">Ingresa tu Colonia</p>
              </div>
            </div>
            <!-- SECCION FORMULARIO 3  -->
            <div class="field field-grid" *ngIf="currentStepform === 3">

              <div>
                <label *ngIf="tipoPersonaSeleccionada === 'fisica'" for="nombre">Nombre(s)<span>*</span></label>
                <label *ngIf="tipoPersonaSeleccionada === 'moral'" for="nombre">Nombre de la
                  empresa<span>*</span></label>
                <div class="control">
                  <input id="nombre" type="text" class="form-input" placeholder="NOMBRE" formControlName="nombre"
                    (input)="toUpper('nombre')" />
                </div>
                <p *ngIf="analizaForm('nombre')" class="error">El nombre es obligatorio</p>
              </div>
              <div *ngIf="tipoPersonaSeleccionada === 'fisica'">
                <label for="apellidoP">Apellido paterno<span>*</span></label>
                <div class="control">
                  <input id="apellidoP" type="text" class="form-input" placeholder="Ej. PÉREZ"
                    formControlName="apellidoP" (input)="toUpper('apellidoP')" />
                </div>
                <p *ngIf="analizaForm('apellidoP')" class="error">Ingresa tu primer apellido.</p>
              </div>
              <div *ngIf="tipoPersonaSeleccionada === 'fisica'">
                <label for="apellidoM">Apellido materno<span>*</span></label>
                <div class="control">
                  <input id="apellidoM" type="text" class="form-input" placeholder="Ej. LÓPEZ"
                    formControlName="apellidoM" (input)="toUpper('apellidoM')" />
                </div>
                <p *ngIf="analizaForm('apellidoM')" class="error">Ingresa tu segundo apellido.</p>
              </div>
              <div>
                <label for="email">Correo electrónico<span>*</span></label>
                <div class="control">
                  <input id="email" type="email" class="form-input" placeholder="tucorreo@dominio.com"
                    formControlName="email" />
                </div>
                <p *ngIf="analizaForm('email')" class="error">Ingresa tu correo</p>
              </div>
              <div *ngIf="tipoPersonaSeleccionada === 'fisica'">
                <label for="curp">CURP<span>*</span></label>
                <div class="control">
                  <input id="curp" type="text" class="form-input" placeholder="Ej. ABCD001122HDFRRN09"
                    formControlName="curp" (input)="toUpper('curp')" />
                </div>
                <p *ngIf="analizaForm('curp')" class="error">Ingresa tu CURP</p>
              </div>
              <div>
                <label for="rfc">RFC<span>*</span></label>
                <div class="control">
                  <input id="rfc" type="text" class="form-input" placeholder="Ej. ABCD001122XXX" formControlName="rfc"
                    (input)="toUpper('rfc')" />
                </div>
                <p *ngIf="analizaForm('rfc')" class="error">Ingresa tu RFC</p>
              </div>
              <div *ngIf="tipoPersonaSeleccionada === 'moral'">
                <label for="folio">Folio mercantil<span>*</span></label>
                <div class="control">
                  <input id="folio" type="text" class="form-input" placeholder="Folio" formControlName="folio"
                    (input)="toUpper('folio')" />
                </div>
                <p *ngIf="analizaForm('folio')" class="error">Ingresa tu folio mercantil</p>
              </div>
              <div *ngIf="tipoPersonaSeleccionada === 'moral'">
                <label for="nmRepLegal">Nombre representante legal<span>*</span></label>
                <div class="control">
                  <input id="nmRepLegal" type="text" class="form-input" placeholder="Reprecentante Legal"
                    formControlName="nmRepLegal" (input)="toUpper('nmRepLegal')" />
                </div>
                <p *ngIf="analizaForm('nmRepLegal')" class="error">Ingresa tu folio mercantil</p>
              </div>

            </div>

            <!-- SECCION FORMULARIO 4  -->
            <!-- SECCION FORMULARIO 4  -->
            <div class="field field-grid" *ngIf="currentStepform === 4">

              <div>
                <label for="pais">País<span>*</span></label>
                <div class="control">
                  <select id="pais" class="form-input" formControlName="pais">
                    <option value="" disabled>Selecciona un país...</option>
                    <option *ngFor="let p of paises" [value]="p._id">{{ p.name }}</option>
                  </select>
                </div>
                <p *ngIf="analizaForm('pais')" class="error">Selecciona un país válido</p>
              </div>
              <div>
                <label for="estado">Estado<span>*</span></label>
                <div class="control">
                  <select id="estado" class="form-input" formControlName="estado">
                    <option value="" disabled>Selecciona un estado...</option>
                    <option *ngFor="let e of estados" [value]="e._id">{{ e.name }}</option>
                  </select>
                </div>
                <p *ngIf="analizaForm('estado')" class="error">Selecciona un estado</p>
              </div>

              <div>
                <label for="actE">Actividad Económica<span>*</span></label>
                <div class="control">
                  <select id="actE" class="form-input" formControlName="actE" (change)="onActividadChange($event)">
                    <option value="" disabled>Selecciona una actividad...</option>
                    <option *ngFor="let a of getActividadesPrincipales()" [value]="a._id">
                      {{ a.description }}
                    </option>
                  </select>
                </div>
                <p *ngIf="analizaForm('actE')" class="error">Selecciona una actividad</p>
              </div>
              <div *ngIf="mostrarMasOpciones">
                <label for="actEextra">Selecciona otra actividad<span>*</span></label>
                <div class="control">
                  <select id="actEextra" class="form-input" formControlName="actEextra">
                    <option value="" disabled>Selecciona una actividad...</option>
                    <option *ngFor="let a of getActividadesSecundarias()" [value]="a._id">
                      {{ a.description }}
                    </option>
                  </select>
                </div>
                <p *ngIf="analizaForm('actEextra')" class="error">Selecciona una actividad válida</p>
              </div>

            </div>

            <div class="paybox__cta" *ngIf="tipoDispocitivo !== 'telefono'">
              <button type="button" *ngIf="datosCoche" class="btn-secondary" (click)="regresar()">
                &#x2B05; Regresar
              </button>
              <button type="submit" class="btn-primary" *ngIf="datosCoche">
                Siguiente &#x27A1;
              </button>
              <button type="button" class="btn-primary" (click)="regresar()" *ngIf="!datosCoche">
                &#x2B05; Cotiza un coche
              </button>
            </div>

            <div class="carta_msj">
              <div class="carta__body">
                <p>
                  Para continuar y emitir tu póliza de manera segura y personalizada, es necesario que
                  realices tu registro.
                  Por favor, proporciona tus datos básicos para crear tu cuenta y completar el proceso de emisión de tu
                  póliza en Woaw.
                </p>
              </div>
            </div>

          </form>

        </section>
      </div>

    </div>

    <div class="divicion2">
      <app-otros-seguros *ngIf="tipoDispocitivo !== 'telefono'" [refreshKey]="islandKey"></app-otros-seguros>
    </div>
  </div>

  <app-footer *ngIf="tipoDispocitivo !== 'telefono'"></app-footer>
</ion-content>

<ion-footer *ngIf="tipoDispocitivo === 'telefono'" class="safe-footer footer_css_seguros">
  <ion-toolbar>

    <ion-buttons slot="start">
      <ion-button fill="clear" *ngIf="statusUserDtos" (click)="regresarInicio()">
        <ion-icon slot="start" name="arrow-back-outline"></ion-icon>
        Atrás
      </ion-button>
      <ion-button fill="clear" *ngIf="!statusUserDtos && !statusBuscar" (click)="regresar()">
        <ion-icon slot="start" name="arrow-back-outline"></ion-icon>
        Atrás
      </ion-button>
    </ion-buttons>

    <ion-buttons slot="end">
      <ion-button *ngIf="statusUserDtos" color="danger" fill="solid" type="button" (click)="nuevosDatos()">
        Poliza
        <ion-icon slot="end" name="arrow-forward-outline"></ion-icon>
      </ion-button>
      <ion-button *ngIf="!statusUserDtos" [disabled]="form_poliza.invalid" color="danger" fill="solid" type="submit"
        (click)="siguiente()">
        Continuar
        <ion-icon slot="end" name="arrow-forward-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
    
  </ion-toolbar>
</ion-footer>
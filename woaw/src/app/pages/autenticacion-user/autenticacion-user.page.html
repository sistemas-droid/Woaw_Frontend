<app-navbar></app-navbar>

<ion-content [fullscreen]="true" class="telefono-ios">

  <!-- Fondo suave con la imagen -->
  <img [src]="imgenPrincipal" alt="Fondo" class="bg-img2" />

  <div class="page-telefono">
    <div class="form-wrapper">
      <!-- Logo arriba tipo app de banco -->
      <img
        src="assets/icon/logo2.png"
        loading="lazy"
        alt="Go Autos"
        class="logo"
      />

      <!-- Bienvenida con avatar -->
      <div class="bienvenida" *ngIf="user as u">
        <div class="avatar">
          <img
            *ngIf="fotoPerfil; else inicialesTpl"
            [src]="fotoPerfil"
            alt="Foto de perfil"
          />
          <ng-template #inicialesTpl>
            <span>{{ iniciales }}</span>
          </ng-template>
        </div>
        <div class="texto">
          <p class="saludo">Bienvenido</p>
          <h3 class="nombre">{{ displayName }}</h3>
        </div>
      </div>

      <h2>Ingresa tu número</h2>
      <p>
        Necesitamos tu número para proteger tu cuenta y completar tu perfil.
      </p>

      <form [formGroup]="form" (ngSubmit)="submit()">
        <div class="telefono-input-wrapper">
          <!-- LADA / PAÍS -->
          <ion-item
            lines="none"
            class="lada-box"
            (click)="abrirModalLadas()"
          >
            <img
              [src]="ladaSeleccionada.banderaUrl"
              class="flag-img"
              alt="flag"
            />
            <p class="lada-text">{{ ladaSeleccionada.codigo }}</p>
          </ion-item>

          <!-- TELÉFONO -->
          <ion-item lines="none" class="telefono-input">
            <ion-input
              formControlName="numero"
              type="tel"
              inputmode="numeric"
              maxlength="15"
              placeholder="Teléfono"
            >
            </ion-input>
          </ion-item>
        </div>

        <ion-note
          *ngIf="form.get('numero')?.touched && form.get('numero')?.invalid"
        >
          Ingresa un número válido 10 dígitos.
        </ion-note>

        <button class="btn-guardar" type="submit" [disabled]="form.invalid">
          Guardar teléfono
        </button>
      </form>
    </div>
  </div>

  <app-footer></app-footer>
</ion-content>

<!-- MODAL LADAS ESTILO iOS -->
<ion-modal
  [isOpen]="mostrarModal"
  cssClass="modal-ladas-ios"
  (didDismiss)="cerrarModal()"
>
  <ng-template>
    <ion-header translucent>
      <ion-toolbar>
        <ion-title>Selecciona tu país</ion-title>
        <ion-buttons slot="end">
          <ion-button fill="clear" (click)="cerrarModal()">
            Cerrar
          </ion-button>
        </ion-buttons>
      </ion-toolbar>

      <ion-toolbar class="toolbar-busqueda-ios">
        <ion-searchbar
          placeholder="Buscar país o código..."
          [(ngModel)]="filtroPais"
          [debounce]="200"
          showCancelButton="never"
          mode="ios"
        >
        </ion-searchbar>
      </ion-toolbar>
    </ion-header>

    <ion-content class="contenido-ladas-ios">
      <ion-list>
        <ion-item
          button
          *ngFor="let p of paisesFiltrados()"
          (click)="seleccionarLada(p)"
        >
          <img [src]="p.banderaUrl" class="flag-img" alt="flag" />
          <ion-label>
            <h3>{{ p.nombre }}</h3>
            <p>{{ p.codigo }}</p>
          </ion-label>
        </ion-item>
      </ion-list>
    </ion-content>
  </ng-template>
</ion-modal>

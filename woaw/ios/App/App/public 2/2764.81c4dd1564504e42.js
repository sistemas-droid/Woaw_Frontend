"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2764],{2764:(S,b,g)=>{g.d(b,{B:()=>L});var m=g(467),_=g(9417),f=g(2881),s=g(7343),x=g(3943),v=g(6967),n=g(1360),h=g(6171),C=g(5806),P=g(2381);function k(r,l){if(1&r){const e=n.RV6();n.j41(0,"ion-button",10),n.bIt("click",function(){n.eBV(e);const i=n.XpG(3);return n.Njj(i.sigiente())}),n.EFF(1," Continuar "),n.nrm(2,"ion-icon",11),n.k0s()}}function O(r,l){if(1&r){const e=n.RV6();n.j41(0,"ion-button",10),n.bIt("click",function(){n.eBV(e);const i=n.XpG(3);return n.Njj(i.sigiente())}),n.nrm(1,"ion-icon",12),n.EFF(2," Regresar "),n.k0s()}}function E(r,l){if(1&r&&(n.j41(0,"div",8),n.DNE(1,k,3,0,"ion-button",9)(2,O,3,0,"ion-button",9),n.k0s()),2&r){const e=n.XpG(2);n.R7$(),n.Y8G("ngIf",e.pocicion),n.R7$(),n.Y8G("ngIf",!e.pocicion)}}function M(r,l){1&r&&(n.j41(0,"ion-note",23),n.EFF(1," M\xe1ximo 25 caracteres. "),n.k0s())}function I(r,l){if(1&r){const e=n.RV6();n.j41(0,"div",24),n.nrm(1,"img",25),n.j41(2,"button",26),n.bIt("click",function(i){return n.eBV(e),n.XpG(3).eliminarImagenPrincipal(),n.Njj(i.stopPropagation())}),n.EFF(3," \u2715 "),n.k0s()()}if(2&r){const e=n.XpG(3);n.R7$(),n.Y8G("src",e.previewImagenPrincipal,n.B4B)}}function F(r,l){if(1&r){const e=n.RV6();n.j41(0,"ion-row")(1,"ion-col",13)(2,"div",14)(3,"ion-label",15),n.EFF(4," Nombre del Lote "),n.j41(5,"strong"),n.EFF(6,"*"),n.k0s()(),n.j41(7,"ion-input",16),n.bIt("ionInput",function(i){n.eBV(e);const t=n.XpG(2);return n.Njj(t.onNombreInput(i))}),n.k0s(),n.DNE(8,M,2,0,"ion-note",17),n.k0s()(),n.j41(9,"ion-col",13)(10,"div",14)(11,"ion-label",15),n.EFF(12," Tel\xe9fono "),n.j41(13,"strong"),n.EFF(14,"*"),n.k0s()(),n.nrm(15,"ion-input",18),n.k0s()(),n.j41(16,"ion-col",13)(17,"div",14)(18,"ion-label",15),n.EFF(19," Correo electr\xf3nico "),n.j41(20,"strong"),n.EFF(21,"(opcional)"),n.k0s()(),n.nrm(22,"ion-input",19),n.k0s()(),n.j41(23,"ion-col",13)(24,"div",14)(25,"ion-label",15),n.EFF(26," Imagen principal del lote "),n.j41(27,"strong"),n.EFF(28,"*"),n.k0s()(),n.j41(29,"div",20),n.bIt("click",function(){n.eBV(e);const i=n.XpG(2);return n.Njj(i.seleccionarImagenPrincipal())}),n.nrm(30,"ion-icon",21),n.DNE(31,I,4,1,"div",22),n.k0s()()()()}if(2&r){let e;const o=n.XpG(2);n.R7$(8),n.Y8G("ngIf",(null==(e=o.formLote.get("nombre"))?null:e.hasError("maxlength"))&&(null==(e=o.formLote.get("nombre"))?null:e.touched)),n.R7$(22),n.AVh("oculto",o.previewImagenPrincipal),n.R7$(),n.Y8G("ngIf",o.previewImagenPrincipal)}}function j(r,l){if(1&r){const e=n.RV6();n.j41(0,"ion-item")(1,"ion-label")(2,"p")(3,"strong"),n.EFF(4),n.k0s()()(),n.j41(5,"ion-button",33),n.bIt("click",function(){const i=n.eBV(e).index,t=n.XpG(4);return n.Njj(t.eliminarUbicacion(i))}),n.nrm(6,"ion-icon",34),n.k0s()()}if(2&r){const e=l.index,o=n.XpG(4);n.R7$(4),n.JRh(o.direccionesTraducidas[e])}}function w(r,l){if(1&r&&(n.j41(0,"ion-col",30)(1,"ion-list",31),n.DNE(2,j,7,1,"ion-item",32),n.k0s()()),2&r){const e=n.XpG(3);n.R7$(2),n.Y8G("ngForOf",e.ubicacionesSeleccionadas)}}function A(r,l){if(1&r){const e=n.RV6();n.j41(0,"ion-row")(1,"ion-col",13)(2,"div",14)(3,"ion-label",15),n.EFF(4," Ubicaci\xf3n del lote "),n.j41(5,"strong"),n.EFF(6,"*"),n.k0s()(),n.j41(7,"ion-button",27),n.bIt("click",function(){n.eBV(e);const i=n.XpG(2);return n.Njj(i.seleccionarUbicacion())}),n.nrm(8,"ion-icon",28),n.EFF(9," Seleccionar ubicaci\xf3n "),n.k0s()()(),n.DNE(10,w,3,1,"ion-col",29),n.k0s()}if(2&r){const e=n.XpG(2);n.R7$(10),n.Y8G("ngIf",e.ubicacionesSeleccionadas.length>0)}}function D(r,l){if(1&r){const e=n.RV6();n.j41(0,"div",35)(1,"ion-button",36),n.bIt("click",function(){n.eBV(e);const i=n.XpG(2);return n.Njj(i.sigiente())}),n.EFF(2," Continuar "),n.nrm(3,"ion-icon",11),n.k0s()()}}function T(r,l){if(1&r&&(n.j41(0,"div",35)(1,"ion-button",37),n.EFF(2," Crear Lote "),n.nrm(3,"ion-icon",38),n.k0s()()),2&r){const e=n.XpG(2);n.R7$(),n.Y8G("disabled",0===e.ubicacionesSeleccionadas.length)}}function y(r,l){if(1&r){const e=n.RV6();n.j41(0,"ion-card",2)(1,"ion-card-header",3)(2,"ion-card-title"),n.EFF(3,"Registra tu lote de coches"),n.k0s(),n.j41(4,"ion-card-subtitle"),n.EFF(5,"Completa la informaci\xf3n del lote"),n.k0s()(),n.j41(6,"ion-card-content"),n.DNE(7,E,3,2,"div",4),n.j41(8,"form",5),n.bIt("ngSubmit",function(){n.eBV(e);const i=n.XpG();return n.Njj(i.registrarLote())}),n.j41(9,"ion-grid"),n.DNE(10,F,32,4,"ion-row",6)(11,A,11,1,"ion-row",6),n.k0s(),n.DNE(12,D,4,0,"div",7)(13,T,4,1,"div",7),n.k0s()()()}if(2&r){const e=n.XpG();n.R7$(7),n.Y8G("ngIf","telefono"===e.tipoDispocitivo),n.R7$(),n.Y8G("formGroup",e.formLote),n.R7$(2),n.Y8G("ngIf",e.pocicion),n.R7$(),n.Y8G("ngIf",!e.pocicion),n.R7$(),n.Y8G("ngIf",e.pocicion),n.R7$(),n.Y8G("ngIf",!e.pocicion)}}function R(r,l){if(1&r){const e=n.RV6();n.j41(0,"div",39)(1,"p"),n.EFF(2," Para publicar un "),n.j41(3,"strong"),n.EFF(4,"Lote"),n.k0s(),n.EFF(5,", primero debes iniciar sesi\xf3n o crear una cuenta. "),n.k0s(),n.j41(6,"button",40),n.bIt("click",function(){n.eBV(e);const i=n.XpG();return n.Njj(i.irAInicio())}),n.EFF(7,"Acceder"),n.k0s()()}}let L=(()=>{var r;class l{constructor(o,i,t,c,d,a){this.fb=o,this.registroService=i,this.toastCtrl=t,this.modalController=c,this.generalService=d,this.router=a,this.ubicacionesSeleccionadas=[],this.direccionesTraducidas=[],this.previewImagenPrincipal=null,this.tipoDispocitivo="",this.pocicion=!0,this.isLoggedIn=!1}ngOnInit(){this.formLote=this.fb.group({nombre:["",_.k0.required],telefono:["",[_.k0.required,_.k0.pattern("[0-9]{10}"),_.k0.maxLength(25)]],email:["",_.k0.email],imagenPrincipal:[null,_.k0.required],constancia:[null]}),this.generalService.dispositivo$.subscribe(o=>{this.tipoDispocitivo=o}),this.generalService.tokenExistente$.subscribe(o=>{this.isLoggedIn=o})}seleccionarConstancia(){const o=document.createElement("input");o.type="file",o.accept="application/pdf",o.onchange=()=>{var i;const t=(null===(i=o.files)||void 0===i?void 0:i[0])||null;var c;t&&(this.constanciaPDF=t,null===(c=this.formLote.get("constancia"))||void 0===c||c.setValue(t))},o.click()}registrarLote(){var o=this;return(0,m.A)(function*(){var i,t;const c=o.obtenerCamposInvalidos(1);if(c.length>0){const p="Faltan por llenar: "+c.join(", ");return void(yield o.generalService.alert("Formulario incorrecto",p,"warning"))}const d=(null!==(i=null===(t=o.formLote)||void 0===t||null===(t=t.value)||void 0===t?void 0:t.nombre)&&void 0!==i?i:"").toString().toLocaleUpperCase("es-MX").slice(0,25).trim(),a=new FormData;if(a.append("nombre",d),a.append("telefonoContacto",o.formLote.value.telefono),a.append("correoContacto",o.formLote.value.email),o.ubicacionesSeleccionadas.length>0){const p=o.ubicacionesSeleccionadas.map(u=>({ciudad:u[0],estado:u[1],lat:u[2],lng:u[3]}));a.append("direcciones",JSON.stringify(p))}o.imagenPrincipal&&a.append("imagenPrincipal",o.imagenPrincipal),o.constanciaPDF&&a.append("constancia",o.constanciaPDF),o.generalService.loading("Creando Lote...");try{o.registroService.registroLote(a).subscribe({next:(p=(0,m.A)(function*(u){o.generalService.loadingDismiss(),o.cambioRol(u),o.formLote.reset(),o.previewImagenPrincipal=null,o.imagenPrincipal=null,o.constanciaPDF=null,o.ubicacionesSeleccionadas=[],o.router.navigateByUrl("/lotes"),yield o.generalService.alert("Lote creado","\xa1Listo! Su lote fue creado correctamente","success")}),function(G){return p.apply(this,arguments)}),error:function(){var p=(0,m.A)(function*(){o.generalService.loadingDismiss(),yield o.generalService.alert("Error al registrar Lote","Error de red. Intenta m\xe1s tarde.","danger")});return function(){return p.apply(this,arguments)}}()})}catch(p){o.generalService.loadingDismiss(),console.error("\u274c Error al registrar lote:",p),o.mostrarToast("Error al registrar el lote","danger")}var p})()}onNombreInput(o){var i,t;const c=(null!==(i=null==o||null===(t=o.detail)||void 0===t?void 0:t.value)&&void 0!==i?i:"").toString(),d=c.toLocaleUpperCase("es-MX").slice(0,25);var a;d!==c&&(null===(a=this.formLote.get("nombre"))||void 0===a||a.setValue(d,{emitEvent:!1}))}obtenerCamposInvalidos(o){const i={nombre:"Nombre del lote",telefono:"Tel\xe9fono",email:"Correo electr\xf3nico",imagenPrincipal:"Imagen principal"},t=[];for(const d in this.formLote.controls){var c;null!==(c=this.formLote.get(d))&&void 0!==c&&c.invalid&&t.push(i[d]||d)}return 1==o&&0===this.ubicacionesSeleccionadas.length&&t.push("Ubicaci\xf3n"),t}mostrarToast(o,i){var t=this;return(0,m.A)(function*(){yield(yield t.toastCtrl.create({message:o,duration:2500,color:i,position:"bottom"})).present()})()}seleccionarImagenPrincipal(){var o=this;return(0,m.A)(function*(){const i=document.createElement("input");i.type="file",i.accept="image/*",i.onchange=(0,m.A)(function*(){var t;const c=(null===(t=i.files)||void 0===t?void 0:t[0])||null;if(c)try{var d;const a=yield(0,v.A)(c,{maxSizeMB:2,maxWidthOrHeight:1600,useWebWorker:!0});o.imagenPrincipal=a,null===(d=o.formLote.get("imagenPrincipal"))||void 0===d||d.setValue(a);const p=new FileReader;p.onload=()=>{o.previewImagenPrincipal=p.result},p.readAsDataURL(a)}catch(a){console.error("\u274c Error al comprimir imagen principal:",a),o.mostrarToast("Error al comprimir la imagen","danger")}}),i.click()})()}seleccionarUbicacion(){var o=this;return(0,m.A)(function*(){if(o.ubicacionesSeleccionadas.length>=5)return void o.mostrarToast("M\xe1ximo 5 ubicaciones permitidas","warning");const i=yield o.modalController.create({component:x.D});yield i.present();const{data:t}=yield i.onDidDismiss();if(t){o.ubicacionesSeleccionadas.push(t);const[c,d,a,p]=t;try{const u=yield o.generalService.obtenerDireccionDesdeCoordenadas(a,p);o.direccionesTraducidas.push(u)}catch(u){console.warn("\u274c Error obteniendo direcci\xf3n:",u),o.direccionesTraducidas.push("No se pudo obtener la direcci\xf3n.")}}})()}eliminarImagenPrincipal(){var o;this.previewImagenPrincipal=null,this.imagenPrincipal=null,null===(o=this.formLote.get("imagenPrincipal"))||void 0===o||o.reset()}eliminarUbicacion(o){this.ubicacionesSeleccionadas.splice(o,1)}cambioRol(o){try{if(!o.token||!o.rol)return;const i=localStorage.getItem("user");if(!i)return;const t=JSON.parse(i);t.rol=o.rol,this.generalService.guardarCredenciales(o.token,t)}catch(i){console.error("\u274c Error actualizando rol:",i)}}sigiente(){var o=this;return(0,m.A)(function*(){if(o.formLote.invalid){o.formLote.markAllAsTouched();const t="Faltan por llenar: "+o.obtenerCamposInvalidos(0).join(", ");return o.generalService.loadingDismiss(),void(yield o.generalService.alert("Formulario incorrecto",t,"warning"))}o.pocicion=!o.pocicion})()}irAInicio(){this.router.navigateByUrl("/inicio")}}return(r=l).\u0275fac=function(o){return new(o||r)(n.rXU(_.ok),n.rXU(h.f),n.rXU(s.K_),n.rXU(s.W3),n.rXU(C.O),n.rXU(P.Ix))},r.\u0275cmp=n.VBU({type:r,selectors:[["app-add"]],decls:2,vars:2,consts:[["class","formulario-lote form-lote-ios",4,"ngIf"],["class","mensaje-autenticacion-ios",4,"ngIf"],[1,"formulario-lote","form-lote-ios"],[1,"lote-header-ios"],["class","top-actions-ios",4,"ngIf"],[3,"ngSubmit","formGroup"],[4,"ngIf"],["class","boton-publicar-container-ios",4,"ngIf"],[1,"top-actions-ios"],["fill","outline","size","small","class","btn-outline-ios","type","button",3,"click",4,"ngIf"],["fill","outline","size","small","type","button",1,"btn-outline-ios",3,"click"],["name","arrow-forward-outline","slot","end"],["name","arrow-back-outline","slot","start"],["size","12","size-md","6"],[1,"field-ios"],["position","stacked"],["formControlName","nombre","placeholder","Ej. AUTOS EL R\xc1PIDO","maxlength","25","autocapitalize","characters","inputmode","text",2,"text-transform","uppercase",3,"ionInput"],["color","danger",4,"ngIf"],["type","tel","formControlName","telefono","placeholder","Ej. 4421234567"],["type","email","formControlName","email","placeholder","Ej. contacto@autosrapido.com"],[1,"area-subida-ios",3,"click"],["name","camera-outline"],["class","preview-container-ios",4,"ngIf"],["color","danger"],[1,"preview-container-ios"],["alt","Imagen principal",3,"src"],["type","button",1,"btn-eliminar-img-ios",3,"click"],["expand","block","fill","solid",1,"btn-ubicacion-ios",3,"click"],["name","location-outline","slot","start"],["size","12",4,"ngIf"],["size","12"],[1,"lista-ubicaciones-ios"],[4,"ngFor","ngForOf"],["fill","clear","size","small","slot","end",1,"btn-remove-ios",3,"click"],["name","close-outline","slot","icon-only"],[1,"boton-publicar-container-ios"],["expand","block","type","button",1,"btn-primary-ios",3,"click"],["expand","block","type","submit",1,"btn-primary-ios",3,"disabled"],["name","save-outline","slot","end"],[1,"mensaje-autenticacion-ios"],[1,"btn-acceso-ios",3,"click"]],template:function(o,i){1&o&&n.DNE(0,y,14,6,"ion-card",0)(1,R,8,0,"div",1),2&o&&(n.Y8G("ngIf",i.isLoggedIn),n.R7$(),n.Y8G("ngIf",!i.isLoggedIn))},dependencies:[s.bv,s.Jm,s.b_,s.I9,s.ME,s.HW,s.tN,s.hU,s.lO,s.iq,s.$w,s.uz,s.he,s.nf,s.JI,s.ln,s.Gw,f.MD,f.Sq,f.bT,_.X1,_.qT,_.BC,_.cb,_.tU,_.j4,_.JD],styles:['@charset "UTF-8";.form-lote-ios[_ngcontent-%COMP%]{max-width:900px;margin:12px auto 24px;border-radius:22px;overflow:hidden;--background: #ffffff;box-shadow:0 22px 40px #0f172a24,0 0 0 .5px #ffffffe6;border:1px solid rgba(148,163,184,.35)}.lote-header-ios[_ngcontent-%COMP%]{padding:16px 18px 10px}.lote-header-ios[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:18px;font-weight:800;letter-spacing:-.01em;color:#111827}.lote-header-ios[_ngcontent-%COMP%]   ion-card-subtitle[_ngcontent-%COMP%]{margin-top:2px;font-size:13px;color:#6b7280;font-weight:500}.top-actions-ios[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;margin:4px 4px 8px}.btn-outline-ios[_ngcontent-%COMP%]{--border-radius: 999px;--border-color: rgba(148, 163, 184, .8);--color: #111827;--background: #f3f4f6;--padding-start: 14px;--padding-end: 14px;--box-shadow: 0 4px 12px rgba(15, 23, 42, .12);font-weight:600;font-size:12px}.field-ios[_ngcontent-%COMP%]{margin-bottom:14px}.field-ios[_ngcontent-%COMP%]   ion-label[position=stacked][_ngcontent-%COMP%]{margin-bottom:4px;font-size:12px;font-weight:600;color:#6b7280}.field-ios[_ngcontent-%COMP%]   ion-label[position=stacked][_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#ef4444;font-weight:700}.field-ios[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]{--padding-start: 12px;--padding-end: 12px;--padding-top: 10px;--padding-bottom: 10px;--background: #f3f4f6;--border-radius: 12px;--color: #111827;--placeholder-color: #9ca3af;--highlight-color-focused: #ef4444;border:1px solid rgba(148,163,184,.7);transition:border-color .18s ease,box-shadow .18s ease}.field-ios[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]:focus-within{border-color:#ef4444;box-shadow:0 0 0 1px #f8717159}.field-ios[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{margin-top:4px;font-size:11px}.area-subida-ios[_ngcontent-%COMP%]{width:100%;min-height:110px;border-radius:14px;border:1.6px dashed rgba(148,163,184,.9);background:#f9fafb;display:flex;justify-content:center;align-items:center;cursor:pointer;position:relative;transition:background .18s ease,border-color .18s ease,box-shadow .18s ease}.area-subida-ios[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:34px;color:#9ca3af}.area-subida-ios[_ngcontent-%COMP%]   .oculto[_ngcontent-%COMP%]{opacity:0;pointer-events:none}.area-subida-ios[_ngcontent-%COMP%]:hover{background:#f3f4f6;border-color:#ef4444;box-shadow:0 10px 22px #0f172a1f}.preview-container-ios[_ngcontent-%COMP%]{position:relative;display:inline-block}.preview-container-ios[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:96px;height:96px;border-radius:16px;object-fit:cover;border:1px solid rgba(148,163,184,.9);box-shadow:0 10px 24px #0f172a38;display:block}.preview-container-ios[_ngcontent-%COMP%]   .btn-eliminar-img-ios[_ngcontent-%COMP%]{position:absolute;top:-6px;right:-6px;width:22px;height:22px;border-radius:999px;border:none;background:#ef4444;color:#fff;font-size:13px;display:grid;place-items:center;cursor:pointer;box-shadow:0 6px 16px #ef444480}.btn-ubicacion-ios[_ngcontent-%COMP%]{--border-radius: 14px;--background: #111827;--background-activated: #0f172a;--color: #f9fafb;--padding-start: 14px;--padding-end: 14px;--box-shadow: 0 10px 20px rgba(15, 23, 42, .35);font-weight:600;font-size:13px}.btn-ubicacion-ios[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#f97373}.lista-ubicaciones-ios[_ngcontent-%COMP%]{margin-top:8px;border-radius:14px;overflow:hidden;background:#f9fafb}.lista-ubicaciones-ios[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--background: transparent;--min-height: 46px;--padding-start: 12px;--inner-padding-end: 8px;border-bottom:1px solid rgba(148,163,184,.25)}.lista-ubicaciones-ios[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.lista-ubicaciones-ios[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:13px;color:#111827}.btn-remove-ios[_ngcontent-%COMP%]{--padding-start: 6px;--padding-end: 6px;--color: #ef4444}.boton-publicar-container-ios[_ngcontent-%COMP%]{margin-top:10px}.btn-primary-ios[_ngcontent-%COMP%]{--border-radius: 16px;--background: linear-gradient(135deg, #ef4444, #b91c1c);--background-activated: linear-gradient(135deg, #dc2626, #991b1b);--padding-start: 16px;--padding-end: 16px;--box-shadow: 0 16px 32px rgba(239, 68, 68, .45);font-weight:700;font-size:14px;letter-spacing:.02em;color:#fff}.mensaje-autenticacion-ios[_ngcontent-%COMP%]{max-width:900px;margin:16px auto 0;padding:14px 14px 12px;background:#fef2f2;border-radius:16px;border:1px solid rgba(248,113,113,.6);box-shadow:0 12px 26px #f8717147;font-size:13px;color:#7f1d1d}.mensaje-autenticacion-ios[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;line-height:1.4}.btn-acceso-ios[_ngcontent-%COMP%]{margin-top:10px;padding:8px 18px;border-radius:999px;border:none;background:#111827;color:#f9fafb;font-size:13px;font-weight:600;cursor:pointer;box-shadow:0 10px 22px #0f172a66}@media (max-width: 640px){.form-lote-ios[_ngcontent-%COMP%]{border-radius:18px}.lote-header-ios[_ngcontent-%COMP%]{padding:14px 14px 8px}.lote-header-ios[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:17px}}']}),l})()}}]);
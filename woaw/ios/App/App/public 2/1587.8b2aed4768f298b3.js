"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1587],{1587:(U,f,c)=>{c.r(f),c.d(f,{TodosPageModule:()=>X});var u=c(2881),F=c(9417),g=c(7343),v=c(9870),P=c(467),M=c(7051),o=c(1360),A=c(5806),j=c(4277),b=c(2381),y=c(9557),_=c(7677),x=c(1969),C=c(4371),T=c(9847);const O=["pageContent"];function I(a,d){1&a&&(o.j41(0,"div",13),o.nrm(1,"ion-icon",14),o.j41(2,"p"),o.EFF(3,"No se encontraron camiones para esta secci\xf3n."),o.k0s()())}function R(a,d){if(1&a){const r=o.RV6();o.qex(0),o.j41(1,"app-cartas",15),o.bIt("refrescarAutos",function(t){o.eBV(r);const e=o.XpG();return o.Njj(e.handleRefrescarCamiones(t))}),o.k0s(),o.bVm()}if(2&a){const r=d.$implicit,i=o.XpG();o.R7$(),o.Y8G("auto",r)("autosFavoritosIds",i.camionesFavoritosIds)("ubicacion","camiones")("esMio",i.idsMisCamiones.includes(r._id))}}function $(a,d){if(1&a){const r=o.RV6();o.j41(0,"button",23),o.bIt("click",function(){o.eBV(r);const t=o.XpG().$implicit,e=o.XpG(2);return o.Njj(e.cambiarPagina(t))}),o.EFF(1),o.k0s()}if(2&a){const r=o.XpG().$implicit,i=o.XpG(2);o.AVh("activa",i.paginaActual===r),o.R7$(),o.SpI(" ",r," ")}}function w(a,d){1&a&&(o.j41(0,"span",24),o.EFF(1,"..."),o.k0s())}function G(a,d){if(1&a&&(o.qex(0),o.DNE(1,$,2,3,"button",21)(2,w,2,0,"span",22),o.bVm()),2&a){const r=d.$implicit,i=o.XpG(2);o.R7$(),o.Y8G("ngIf",i.esNumero(r)),o.R7$(),o.Y8G("ngIf",!i.esNumero(r))}}function S(a,d){if(1&a){const r=o.RV6();o.j41(0,"div",16)(1,"p",17),o.EFF(2,"M\xe1s"),o.k0s(),o.j41(3,"div",18)(4,"div",19)(5,"button",20),o.bIt("click",function(){o.eBV(r);const t=o.XpG();return o.Njj(t.cambiarPagina(t.paginaActual-1))}),o.EFF(6," \u2039 "),o.k0s(),o.DNE(7,G,3,2,"ng-container",11),o.j41(8,"button",20),o.bIt("click",function(){o.eBV(r);const t=o.XpG();return o.Njj(t.cambiarPagina(t.paginaActual+1))}),o.EFF(9," \u203a "),o.k0s()()()()}if(2&a){const r=o.XpG();o.R7$(5),o.Y8G("disabled",1===r.paginaActual),o.R7$(2),o.Y8G("ngForOf",r.paginasReducidas),o.R7$(),o.Y8G("disabled",r.paginaActual===r.totalPaginas)}}const k=[{path:"",component:(()=>{var a;class d{constructor(i,t,e,n,s,m,l,p){this.generalService=i,this.popoverCtrl=t,this.camionesService=e,this.modalCtrl=n,this.router=s,this.route=m,this.menuCtrl=l,this.carsService=p,this.esDispositivoMovil=!1,this.camionesStorage=[],this.camionesFiltrados=[],this.camionesPaginados=[],this.totalCamiones=0,this.filtros=[{label:"$",tipo:"precio"}],this.filtrosAplicados={precio:null},this.terminoBusqueda="",this.isLoggedIn=!1,this.MyRole=null,this.camionesFavoritosIds=new Set,this.idsMisCamiones=[],this.paginaActual=1,this.totalPaginas=1,this.paginas=[],this.ordenActivo=null,this.mostrar_spinner=!1,this.tipo_spinner=0,this.texto_spinner="Cargando...",this.textoSub_spinner="Espere un momento"}ngOnInit(){this.menuCtrl.close("menuLateral"),this.generalService.dispositivo$.subscribe(i=>{this.esDispositivoMovil="telefono"===i||"tablet"===i}),this.generalService.tokenExistente$.subscribe(i=>{this.isLoggedIn=i}),this.generalService.tipoRol$.subscribe(i=>{this.MyRole=i}),this.generalService.valorGlobal$.subscribe(i=>{this.itemsPorPagina=i||12}),this.getCamionesAll(),this.misCamiones()}misCamiones(){var i=this;return(0,P.A)(function*(){i.isLoggedIn&&i.camionesService.misCamionesId().subscribe({next:t=>{i.idsMisCamiones=t&&Array.isArray(t.vehicleIds)?t.vehicleIds:[]},error:t=>{var e;const n=(null==t||null===(e=t.error)||void 0===e?void 0:e.message)||"Error al obtener tus veh\xedculos.";"No se encontraron veh\xedculos para este usuario"===n?i.idsMisCamiones=[]:console.warn(n)}})})()}getCamionesAll(){this.mostrar_spinner=!0,this.camionesService.getAllCamiones().subscribe({next:i=>{this.camionesStorage=i.camiones.map(t=>{let e=0;if(t.version&&Array.isArray(t.version)&&t.version.length>0){const n=t.version.map(s=>parseFloat(s.Precio||s.precio||0)).filter(s=>!isNaN(s)&&s>0);n.length>0&&(e=Math.min(...n))}return 0===e&&t.precio&&(e=parseFloat(t.precio)),{...t,_id:String(t._id),precioDesde:e}}),this.totalCamiones=this.camionesStorage.length,this.getCamionesFavoritos(),this.calcularPaginacion(),this.mostrar_spinner=!1},error:i=>{var t;this.mostrar_spinner=!1;const e=(null==i||null===(t=i.error)||void 0===t?void 0:t.message)||"Ocurri\xf3 un error inesperado";console.error("Error al cargar camiones:",e)}})}getCamionesFavoritos(){this.carsService.getCarsFavoritos().subscribe({next:i=>{const t=((null==i?void 0:i.vehicles)||[]).map(e=>String(e.vehicleId));this.camionesFavoritosIds=new Set(t),this.aplicarFiltros()},error:i=>{var t;console.error("Error al cargar favoritos:",(null==i||null===(t=i.error)||void 0===t?void 0:t.message)||"Ocurri\xf3 un error inesperado")}})}doRefresh(i){this.getCamionesAll(),this.filtrosAplicados={precio:null},setTimeout(()=>i.target.complete(),1500)}mostrarOpciones(i,t){var e=this;return(0,P.A)(function*(){const n=yield e.popoverCtrl.create({component:M.s,event:i,translucent:!0,componentProps:{tipo:t}});yield n.present();const{data:s}=yield n.onDidDismiss();e.filtrosAplicados[t]=null===s?null:s,e.aplicarFiltros()})()}aplicarFiltros(){let i=[...this.camionesStorage];const{precio:t,anio:e,color:n,marca:s,tipoCamion:m}=this.filtrosAplicados;t&&(i=i.filter(l=>l.precioDesde>=t.rango[0]&&l.precioDesde<=t.rango[1])),e&&(2024===e.anio?i=i.filter(l=>l.anio>=2024):2020===e.anio?i=i.filter(l=>l.anio>=2020&&l.anio<=2023):2010===e.anio&&(i=i.filter(l=>l.anio<2020))),n&&(i=i.filter(l=>{var p;return(null===(p=l.color)||void 0===p?void 0:p.toLowerCase())===n.label.toLowerCase()})),s&&(i=i.filter(l=>l.marca.toLowerCase()===s.label.toLowerCase())),m&&(i=i.filter(l=>{var p;return(null===(p=l.tipoCamion)||void 0===p?void 0:p.toLowerCase())===m.label.toLowerCase()})),t&&(i=i.filter(l=>l.precioDesde>=t.rango[0]&&l.precioDesde<=t.rango[1])),this.camionesFiltrados=i,this.totalPaginas=Math.ceil(i.length/this.itemsPorPagina),this.paginas=Array.from({length:this.totalPaginas},(l,p)=>p+1),this.paginaActual=1,this.mostrarPagina(1)}calcularPaginacion(){this.totalPaginas=Math.ceil(this.camionesStorage.length/this.itemsPorPagina),this.paginas=Array.from({length:this.totalPaginas},(i,t)=>t+1),this.mostrarPagina(this.paginaActual)}mostrarPagina(i){this.paginaActual=i;const t=(i-1)*this.itemsPorPagina;this.camionesPaginados=(this.camionesFiltrados.length>0?this.camionesFiltrados:this.camionesStorage).slice(t,t+this.itemsPorPagina)}ordenarCamiones(i){this.ordenActivo=i;const t=this.camionesFiltrados.length?[...this.camionesFiltrados]:[...this.camionesStorage];switch(i){case"precioAsc":t.sort((e,n)=>e.precioDesde-n.precioDesde);break;case"precioDesc":t.sort((e,n)=>n.precioDesde-e.precioDesde);break;default:t.sort((e,n)=>n.anio-e.anio)}this.camionesFiltrados=t,this.totalPaginas=Math.ceil(t.length/this.itemsPorPagina),this.paginas=Array.from({length:this.totalPaginas},(e,n)=>n+1),this.camionesPaginados=t.slice(0,this.itemsPorPagina)}resetearFiltros(){this.filtrosAplicados={precio:null,anio:null,color:null,marca:null,tipoCamion:null},this.camionesFiltrados=[],this.calcularPaginacion()}cambiarPagina(i){i<1||i>this.totalPaginas||(this.mostrarPagina(i),setTimeout(()=>{this.content.scrollToTop(400)},100))}regresar(){this.router.navigate(["/home"])}handleRefrescarCamiones(i){"camiones"===i&&this.getCamionesFavoritos()}esNumero(i){return"number"==typeof i}get paginasReducidas(){const i=this.totalPaginas,t=this.paginaActual;if(i<=2)return this.paginas;const n=[];n.push(1),t-1>2&&n.push("...");for(let s=Math.max(2,t-1);s<=Math.min(i-1,t+1);s++)n.push(s);return t+1<i-1&&n.push("..."),i>1&&n.push(i),n}filtrarPorBusqueda(){const i=this.terminoBusqueda.trim().toLowerCase();if(!i)return void this.aplicarFiltros();const e=(this.camionesFiltrados.length?this.camionesFiltrados:this.camionesStorage).filter(n=>{var s,m,l;const p=(null===(s=n.marca)||void 0===s?void 0:s.toLowerCase())||"",L=(null===(m=n.modelo)||void 0===m?void 0:m.toLowerCase())||"",B=String(n.anio||""),V=(null===(l=n.tipoCamion)||void 0===l?void 0:l.toLowerCase())||"",Y=(n.version||[]).map(z=>{var h;return(null===(h=z.Name)||void 0===h?void 0:h.toLowerCase())||""}).join(" ");return p.includes(i)||L.includes(i)||B.includes(i)||V.includes(i)||Y.includes(i)});this.camionesFiltrados=e,this.totalPaginas=Math.ceil(e.length/this.itemsPorPagina),this.paginas=Array.from({length:this.totalPaginas},(n,s)=>s+1),this.paginaActual=1,this.mostrarPagina(1)}}return(a=d).\u0275fac=function(i){return new(i||a)(o.rXU(A.O),o.rXU(g.IE),o.rXU(j.L),o.rXU(g.W3),o.rXU(b.Ix),o.rXU(b.nX),o.rXU(g._t),o.rXU(y.R))},a.\u0275cmp=o.VBU({type:a,selectors:[["app-todos"]],viewQuery:function(i,t){if(1&i&&o.GBs(O,5),2&i){let e;o.mGM(e=o.lsd())&&(t.content=e.first)}},standalone:!1,decls:18,vars:8,consts:[["pageContent",""],[1,"contenido-ios",3,"fullscreen"],["slot","fixed","pullFactor","0.4","pullMin","120","pullMax","200",3,"ionRefresh"],["pullingIcon","chevron-down-outline","refreshingSpinner","lines","pullingText","Desliza para actualizar","refreshingText","Actualizando..."],[3,"ordenCambio","totalAutos","titulo"],[1,"contenedor-catalogo-ios"],["size","12","size-md","3"],[3,"mostrarOpciones","limpiarFiltros","filtros","filtrosAplicados"],["size","12","size-md","9"],[1,"catalogo-autos-ios"],["class","mensaje-vacio-ios",4,"ngIf"],[4,"ngFor","ngForOf"],["class","contenedor-paginacion-ios",4,"ngIf"],[1,"mensaje-vacio-ios"],["name","trail-sign-outline"],[3,"refrescarAutos","auto","autosFavoritosIds","ubicacion","esMio"],[1,"contenedor-paginacion-ios"],[1,"titulo-paginacion-ios"],[1,"paginacion-scroll-ios"],[1,"paginacion-ios"],[1,"pagina-ios",3,"click","disabled"],["class","pagina-ios",3,"activa","click",4,"ngIf"],["class","ellipsis-ios",4,"ngIf"],[1,"pagina-ios",3,"click"],[1,"ellipsis-ios"]],template:function(i,t){if(1&i){const e=o.RV6();o.nrm(0,"app-navbar"),o.j41(1,"ion-content",1,0)(3,"ion-refresher",2),o.bIt("ionRefresh",function(s){return o.eBV(e),o.Njj(t.doRefresh(s))}),o.nrm(4,"ion-refresher-content",3),o.k0s(),o.j41(5,"app-acomodo",4),o.bIt("ordenCambio",function(s){return o.eBV(e),o.Njj(t.ordenarCamiones(s))}),o.k0s(),o.j41(6,"ion-grid",5)(7,"ion-row")(8,"ion-col",6)(9,"app-menu",7),o.bIt("mostrarOpciones",function(s){return o.eBV(e),o.Njj(t.mostrarOpciones(s.event,s.tipo))})("limpiarFiltros",function(){return o.eBV(e),o.Njj(t.resetearFiltros())}),o.k0s()(),o.j41(10,"ion-col",8)(11,"div",9),o.DNE(12,I,4,0,"div",10)(13,R,2,4,"ng-container",11),o.k0s(),o.DNE(14,S,10,3,"div",12),o.k0s()()(),o.nrm(15,"br")(16,"br")(17,"br"),o.k0s()}2&i&&(o.R7$(),o.Y8G("fullscreen",!0),o.R7$(4),o.Y8G("totalAutos",t.totalCamiones)("titulo","Camiones"),o.R7$(4),o.Y8G("filtros",t.filtros)("filtrosAplicados",t.filtrosAplicados),o.R7$(3),o.Y8G("ngIf",0===(null==t.camionesPaginados?null:t.camionesPaginados.length)),o.R7$(),o.Y8G("ngForOf",t.camionesPaginados),o.R7$(),o.Y8G("ngIf",t.totalPaginas>1))},dependencies:[u.Sq,u.bT,g.hU,g.W9,g.lO,g.iq,g.To,g.Ki,g.ln,_.E,x.Z,C.a,T._],styles:['@charset "UTF-8";.contenido-ios[_ngcontent-%COMP%]{--background: #f2f2f7;font-family:-apple-system,BlinkMacSystemFont,SF Pro Text,sans-serif}.contenedor-catalogo-ios[_ngcontent-%COMP%]{max-width:1100px;width:100%;margin:0 auto;padding:0 12px 20px}.catalogo-autos-ios[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:14px;margin-top:14px;margin-bottom:20px}@media (max-width: 768px){.catalogo-autos-ios[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fill,minmax(155px,1fr));gap:10px}}@media (max-width: 540px){.catalogo-autos-ios[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr);gap:8px}}.mensaje-vacio-ios[_ngcontent-%COMP%]{width:100%;min-height:55vh;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;color:#8e8e93}.mensaje-vacio-ios[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:64px;margin-bottom:10px;color:#b3b3b9}.mensaje-vacio-ios[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:15px;max-width:320px;line-height:1.45;font-weight:500}.contenedor-paginacion-ios[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;margin-top:18px;padding-bottom:10px}.titulo-paginacion-ios[_ngcontent-%COMP%]{margin:0 0 6px;font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:.12em;color:#6b7280}.paginacion-scroll-ios[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center;overflow-x:auto;padding-bottom:4px;scrollbar-width:thin;scrollbar-color:rgba(148,163,184,.9) transparent}.paginacion-scroll-ios[_ngcontent-%COMP%]::-webkit-scrollbar{height:5px}.paginacion-scroll-ios[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#94a3b8e6;border-radius:999px}.paginacion-ios[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;padding:5px 6px;border-radius:999px;background:#fffffff5;backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);box-shadow:0 10px 22px #0f172a29,0 0 0 .5px #ffffffe6}.pagina-ios[_ngcontent-%COMP%]{min-width:32px;height:32px;padding:0 10px;border-radius:999px;border:none;outline:none;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:600;color:#111827;background:transparent;transition:background .18s ease,color .18s ease,transform .16s ease,box-shadow .16s ease}.pagina-ios[_ngcontent-%COMP%]:disabled{opacity:.35;cursor:default}.pagina-ios[_ngcontent-%COMP%]:not(.activa):not(:disabled):hover{background:#94a3b82e;transform:translateY(-1px)}.pagina-ios.activa[_ngcontent-%COMP%]{background:#ff3b30;color:#fff;box-shadow:0 8px 18px #ff3b308c;transform:translateY(-1px)}.ellipsis-ios[_ngcontent-%COMP%]{padding:0 6px;font-size:14px;color:#9ca3af;font-weight:500}.buscador-escritorio[_ngcontent-%COMP%]{width:100%;max-width:520px;margin-left:auto;--border-radius: 12px;--background: #ffffff;--color: #111827;--placeholder-color: #9ca3af;--icon-color: #9ca3af}.buscador-movil[_ngcontent-%COMP%]{--border-radius: 12px}.perfil-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}']}),d})()}];let D=(()=>{var a;class d{}return(a=d).\u0275fac=function(i){return new(i||a)},a.\u0275mod=o.$C({type:a}),a.\u0275inj=o.G2t({imports:[v.iI.forChild(k),v.iI]}),d})();var N=c(5473),E=c(8857);let X=(()=>{var a;class d{}return(a=d).\u0275fac=function(i){return new(i||a)},a.\u0275mod=o.$C({type:a}),a.\u0275inj=o.G2t({imports:[u.MD,F.YN,g.bv,D,_.E,x.Z,C.a,N.n,T._,E.t]}),d})()}}]);
"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5696],{1125:($,B,f)=>{f.d(B,{o:()=>p});var E=f(7643),g=f(5312),A=f(6648),_=f(8810),O=f(6354),v=f(9437),u=f(5558),b=f(1360),m=f(9564),a=f(5806);let p=(()=>{var o;class s{get baseUrl(){return this._baseUrl}constructor(t,i,e){this.http=t,this.headersService=i,this.general=e,this._baseUrl=this.normalizeBaseUrl(g.c.api_key),this.BOOKING_BASE="/booking/bookings"}normalizeBaseUrl(t){return(t||"").replace(/\/+$/,"")}toParams(t){let i=new E.Nl;return Object.entries(t||{}).forEach(([e,r])=>{null==r||""===r||(Array.isArray(r)?r.forEach(n=>{i=i.append(e,String(n))}):i=i.set(e,String(r)))}),i}authJsonHeaders$(){return(0,A.H)(this.headersService.obtenerToken()).pipe((0,O.T)(t=>this.headersService.getJsonHeaders(t)))}authMultipartHeaders$(){return(0,A.H)(this.headersService.obtenerToken()).pipe((0,O.T)(t=>this.headersService.getJsonHeaders(t).delete("Content-Type")))}buildApiCandidates(t){const i=this.baseUrl.replace(/\/+$/,""),e=t.startsWith("/")?t:`/${t}`,r=`${i}${e}`,h=`${/\/api$/.test(i)?i.replace(/\/api$/,""):`${i}/api`}${e}`,c=new Set([r.replace(/\/+$/,""),h.replace(/\/+$/,"")]);return Array.from(c)}withNoCache(t){return t.set("Cache-Control","no-cache").set("Pragma","no-cache").set("If-Modified-Since","0")}withNoCacheHeaders(t){return t instanceof E.Lr?this.withNoCache(t):{...t,"Cache-Control":"no-cache",Pragma:"no-cache","If-Modified-Since":"0"}}addCacheBuster(t){const i=Date.now().toString();return(null!=t?t:new E.Nl).set("_ts",i)}formatHttpErrorMessage(t){const i="Ocurri\xf3 un error al procesar la solicitud.";if(!t)return i;const e=[],r=t.error;if(r)if("string"==typeof r)e.push(r);else{var n;"string"==typeof r.message&&e.push(r.message),"string"==typeof r.error?e.push(r.error):null!==(n=r.error)&&void 0!==n&&n.message&&e.push(String(r.error.message)),Array.isArray(r.errors)&&r.errors.length>0&&e.push(...r.errors.map(h=>(null==h?void 0:h.msg)||(null==h?void 0:h.message)||h).filter(Boolean).map(String))}0===e.length&&t.message&&e.push(String(t.message));const d=Array.from(new Set(e.map(h=>h.trim()).filter(Boolean)));return d.length?d.join("\n"):i}handleHttpErrorWithContext(t,i){return e=>{var r;const n=null==e?void 0:e.error,d="string"==typeof(null==n?void 0:n.message)&&n.message.trim()||"string"==typeof(null==e?void 0:e.message)&&e.message.trim()||"No se pudo completar la acci\xf3n";let h="";return"string"==typeof(null==n?void 0:n.error)&&n.error.trim()?h=n.error.trim():null!=n&&null!==(r=n.error)&&void 0!==r&&r.message?h=String(n.error.message):Array.isArray(null==n?void 0:n.errors)&&n.errors.length&&(h=n.errors.map(c=>(null==c?void 0:c.msg)||(null==c?void 0:c.message)||String(c)).filter(Boolean).join("\n")),h||(h=this.formatHttpErrorMessage(e)),this.general.alert(d,h,"danger"),(0,_.$)(()=>e)}}getWithApiFallback(t,i,e){const[r,n]=this.buildApiCandidates(t),d=this.withNoCacheHeaders(i),h=this.handleHttpErrorWithContext("GET",t);return this.http.get(r,{headers:d,params:e}).pipe((0,v.W)(c=>404===(null==c?void 0:c.status)&&n?this.http.get(n,{headers:d,params:e}).pipe((0,v.W)(this.handleHttpErrorWithContext("GET",t))):h(c)))}postWithApiFallback(t,i,e,r){const[n,d]=this.buildApiCandidates(t),h=this.handleHttpErrorWithContext("POST",t);return this.http.post(n,i,{headers:e,params:r}).pipe((0,v.W)(c=>404===(null==c?void 0:c.status)&&d?this.http.post(d,i,{headers:e,params:r}).pipe((0,v.W)(this.handleHttpErrorWithContext("POST",t))):h(c)))}putWithApiFallback(t,i,e,r){const[n,d]=this.buildApiCandidates(t),h=this.handleHttpErrorWithContext("PUT",t);return this.http.put(n,i,{headers:e,params:r}).pipe((0,v.W)(c=>404===(null==c?void 0:c.status)&&d?this.http.put(d,i,{headers:e,params:r}).pipe((0,v.W)(this.handleHttpErrorWithContext("PUT",t))):h(c)))}deleteWithApiFallback(t,i,e,r){const[n,d]=this.buildApiCandidates(t),h=this.handleHttpErrorWithContext("DELETE",t);return this.http.request("DELETE",n,{headers:i,params:e,body:r}).pipe((0,v.W)(c=>404===(null==c?void 0:c.status)&&d?this.http.request("DELETE",d,{headers:i,params:e,body:r}).pipe((0,v.W)(this.handleHttpErrorWithContext("DELETE",t))):h(c)))}listarBookings(t={}){const i=this.addCacheBuster(this.toParams(t));return this.authJsonHeaders$().pipe((0,u.n)(e=>this.getWithApiFallback(`${this.BOOKING_BASE}`,e,i)))}getBookingById(t){return this.authJsonHeaders$().pipe((0,u.n)(i=>this.getWithApiFallback(`${this.BOOKING_BASE}/${t}`,i,this.addCacheBuster())))}getMyBookings(){return this.authJsonHeaders$().pipe((0,u.n)(t=>this.getWithApiFallback(`${this.BOOKING_BASE}/mine`,t,this.addCacheBuster())))}getBookingsByCar(t,i={}){const e=this.addCacheBuster(this.toParams(i));return this.authJsonHeaders$().pipe((0,u.n)(r=>this.getWithApiFallback(`${this.BOOKING_BASE}/car/${t}`,r,e)))}createBookingV2(t){const i={...t};if(i.fechaInicio=new Date(t.fechaInicio).toISOString(),i.fechaFin=new Date(t.fechaFin).toISOString(),"string"==typeof i.items)try{i.items=JSON.parse(i.items)}catch{return this.general.alert("Datos inv\xe1lidos","Formato inv\xe1lido de items (JSON).","danger"),(0,_.$)(()=>new Error("Formato inv\xe1lido de items (JSON)"))}return i.rentalCar&&i.fechaInicio&&i.fechaFin?new Date(i.fechaFin)<=new Date(i.fechaInicio)?(this.general.alert("Rango inv\xe1lido","fechaFin debe ser mayor a fechaInicio.","danger"),(0,_.$)(()=>new Error("Rango de fechas inv\xe1lido: fechaFin debe ser > fechaInicio."))):!0!==i.aceptoTerminos?(this.general.alert("T\xe9rminos","Debes aceptar los t\xe9rminos para continuar.","danger"),(0,_.$)(()=>new Error("Debes aceptar los t\xe9rminos para continuar."))):this.authJsonHeaders$().pipe((0,u.n)(e=>this.postWithApiFallback(`${this.BOOKING_BASE}`,i,e))):(this.general.alert("Campos faltantes","Faltan campos: rentalCar, fechaInicio, fechaFin","danger"),(0,_.$)(()=>new Error("Faltan campos: rentalCar, fechaInicio, fechaFin")))}acceptBooking(t,i={}){const e={};return!0===i.force&&(e.force=!0),!0===i.ignoreTraslape&&(e.ignoreTraslape=!0),!0===i.ignoreOverlap&&(e.ignoreOverlap=!0),this.authJsonHeaders$().pipe((0,u.n)(r=>this.postWithApiFallback(`${this.BOOKING_BASE}/${t}/accept`,e,r)))}startBooking(t){return this.authJsonHeaders$().pipe((0,u.n)(i=>this.postWithApiFallback(`${this.BOOKING_BASE}/${t}/start`,{},i)))}finishBooking(t){return this.authJsonHeaders$().pipe((0,u.n)(i=>this.postWithApiFallback(`${this.BOOKING_BASE}/${t}/finish`,{},i)))}cancelBooking(t,i){const e=i?{motivo:i}:{};return this.authJsonHeaders$().pipe((0,u.n)(r=>this.postWithApiFallback(`${this.BOOKING_BASE}/${t}/cancel`,e,r)))}setCheckIn(t,i=[],e){const r=new FormData;return(i||[]).forEach(n=>r.append("checkInFotos",n)),null!=e&&e.fecha&&r.append("fecha",e.fecha),null!=(null==e?void 0:e.combustible)&&r.append("combustible",String(e.combustible)),null!=(null==e?void 0:e.notas)&&r.append("notas",e.notas),null!=e&&e.existentes&&r.append("checkInFotosExistentes",JSON.stringify(e.existentes)),this.authMultipartHeaders$().pipe((0,u.n)(n=>this.putWithApiFallback(`${this.BOOKING_BASE}/${t}/checkin`,r,n)))}setCheckOut(t,i=[],e){const r=new FormData;return(i||[]).forEach(n=>r.append("checkOutFotos",n)),null!=e&&e.fecha&&r.append("fecha",e.fecha),null!=(null==e?void 0:e.combustible)&&r.append("combustible",String(e.combustible)),null!=(null==e?void 0:e.notas)&&r.append("notas",e.notas),this.authMultipartHeaders$().pipe((0,u.n)(n=>this.putWithApiFallback(`${this.BOOKING_BASE}/${t}/checkout`,r,n)))}updatePayment(t,i){return this.authJsonHeaders$().pipe((0,u.n)(e=>this.putWithApiFallback(`${this.BOOKING_BASE}/${t}/payment`,i,e)))}updateDeposit(t,i){return this.authJsonHeaders$().pipe((0,u.n)(e=>this.putWithApiFallback(`${this.BOOKING_BASE}/${t}/deposit`,i,e)))}setContractUrl(t,i){return this.authJsonHeaders$().pipe((0,u.n)(e=>this.putWithApiFallback(`${this.BOOKING_BASE}/${t}/contract`,{url:i},e)))}replaceItems(t,i){return this.authJsonHeaders$().pipe((0,u.n)(e=>this.putWithApiFallback(`${this.BOOKING_BASE}/${t}/items`,{items:i},e)))}addLineItem(t,i){return this.authJsonHeaders$().pipe((0,u.n)(e=>this.postWithApiFallback(`${this.BOOKING_BASE}/${t}/items`,i,e)))}updateBookingPartial(t,i){return this.authJsonHeaders$().pipe((0,u.n)(e=>this.putWithApiFallback(`${this.BOOKING_BASE}/${t}`,i,e)))}removeLineItem(t,i){return this.authJsonHeaders$().pipe((0,u.n)(e=>this.deleteWithApiFallback(`${this.BOOKING_BASE}/${t}/items`,e,void 0,{index:i})))}deleteBooking(t){return this.authJsonHeaders$().pipe((0,u.n)(i=>this.deleteWithApiFallback(`${this.BOOKING_BASE}/${t}`,i)))}saveCheckInData(t,i){return this.authJsonHeaders$().pipe((0,u.n)(e=>this.putWithApiFallback(`${this.BOOKING_BASE}/${t}/checkin`,i,e)))}}return(o=s).\u0275fac=function(t){return new(t||o)(b.KVO(E.Qq),b.KVO(m.m),b.KVO(a.O))},o.\u0275prov=b.jDH({token:o,factory:o.\u0275fac,providedIn:"root"}),s})()},7691:($,B,f)=>{f.d(B,{i7:()=>b,LK:()=>O,ru:()=>A});var E=f(5083),g=f(467),A=function(m){return m.Prompt="PROMPT",m.Camera="CAMERA",m.Photos="PHOTOS",m}(A||{}),_=function(m){return m.Rear="REAR",m.Front="FRONT",m}(_||{}),O=function(m){return m.Uri="uri",m.Base64="base64",m.DataUrl="dataUrl",m}(O||{});class v extends E.E_{getPhoto(a){var p=this;return(0,g.A)(function*(){return new Promise(function(){var o=(0,g.A)(function*(s,l){if(a.webUseInput||a.source===A.Photos)p.fileInputExperience(a,s,l);else if(a.source===A.Prompt){let t=document.querySelector("pwa-action-sheet");t||(t=document.createElement("pwa-action-sheet"),document.body.appendChild(t)),t.header=a.promptLabelHeader||"Photo",t.cancelable=!1,t.options=[{title:a.promptLabelPhoto||"From Photos"},{title:a.promptLabelPicture||"Take Picture"}],t.addEventListener("onSelection",function(){var i=(0,g.A)(function*(e){0===e.detail?p.fileInputExperience(a,s,l):p.cameraExperience(a,s,l)});return function(e){return i.apply(this,arguments)}}())}else p.cameraExperience(a,s,l)});return function(s,l){return o.apply(this,arguments)}}())})()}pickImages(a){var p=this;return(0,g.A)(function*(){return new Promise(function(){var o=(0,g.A)(function*(s,l){p.multipleFileInputExperience(s,l)});return function(s,l){return o.apply(this,arguments)}}())})()}cameraExperience(a,p,o){var s=this;return(0,g.A)(function*(){if(customElements.get("pwa-camera-modal")){const l=document.createElement("pwa-camera-modal");l.facingMode=a.direction===_.Front?"user":"environment",document.body.appendChild(l);try{yield l.componentOnReady(),l.addEventListener("onPhoto",function(){var t=(0,g.A)(function*(i){const e=i.detail;null===e?o(new E.I9("User cancelled photos app")):e instanceof Error?o(e):p(yield s._getCameraPhoto(e,a)),l.dismiss(),document.body.removeChild(l)});return function(i){return t.apply(this,arguments)}}()),l.present()}catch{s.fileInputExperience(a,p,o)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),s.fileInputExperience(a,p,o)})()}fileInputExperience(a,p,o){let s=document.querySelector("#_capacitor-camera-input");const l=()=>{var t;null===(t=s.parentNode)||void 0===t||t.removeChild(s)};s||(s=document.createElement("input"),s.id="_capacitor-camera-input",s.type="file",s.hidden=!0,document.body.appendChild(s),s.addEventListener("change",t=>{const i=s.files[0];let e="jpeg";if("image/png"===i.type?e="png":"image/gif"===i.type&&(e="gif"),"dataUrl"===a.resultType||"base64"===a.resultType){const r=new FileReader;r.addEventListener("load",()=>{if("dataUrl"===a.resultType)p({dataUrl:r.result,format:e});else if("base64"===a.resultType){const n=r.result.split(",")[1];p({base64String:n,format:e})}l()}),r.readAsDataURL(i)}else p({webPath:URL.createObjectURL(i),format:e}),l()}),s.addEventListener("cancel",t=>{o(new E.I9("User cancelled photos app")),l()})),s.accept="image/*",s.capture=!0,a.source===A.Photos||a.source===A.Prompt?s.removeAttribute("capture"):a.direction===_.Front?s.capture="user":a.direction===_.Rear&&(s.capture="environment"),s.click()}multipleFileInputExperience(a,p){let o=document.querySelector("#_capacitor-camera-input-multiple");const s=()=>{var l;null===(l=o.parentNode)||void 0===l||l.removeChild(o)};o||(o=document.createElement("input"),o.id="_capacitor-camera-input-multiple",o.type="file",o.hidden=!0,o.multiple=!0,document.body.appendChild(o),o.addEventListener("change",l=>{const t=[];for(let i=0;i<o.files.length;i++){const e=o.files[i];let r="jpeg";"image/png"===e.type?r="png":"image/gif"===e.type&&(r="gif"),t.push({webPath:URL.createObjectURL(e),format:r})}a({photos:t}),s()}),o.addEventListener("cancel",l=>{p(new E.I9("User cancelled photos app")),s()})),o.accept="image/*",o.click()}_getCameraPhoto(a,p){return new Promise((o,s)=>{const l=new FileReader,t=a.type.split("/")[1];"uri"===p.resultType?o({webPath:URL.createObjectURL(a),format:t,saved:!1}):(l.readAsDataURL(a),l.onloadend=()=>{const i=l.result;o("dataUrl"===p.resultType?{dataUrl:i,format:t,saved:!1}:{base64String:i.split(",")[1],format:t,saved:!1})},l.onerror=i=>{s(i)})})}checkPermissions(){var a=this;return(0,g.A)(function*(){if(typeof navigator>"u"||!navigator.permissions)throw a.unavailable("Permissions API not available in this browser");try{return{camera:(yield window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch{throw a.unavailable("Camera permissions are not available in this browser")}})()}requestPermissions(){var a=this;return(0,g.A)(function*(){throw a.unimplemented("Not implemented on web.")})()}pickLimitedLibraryPhotos(){var a=this;return(0,g.A)(function*(){throw a.unavailable("Not implemented on web.")})()}getLimitedLibraryPhotos(){var a=this;return(0,g.A)(function*(){throw a.unavailable("Not implemented on web.")})()}}new v;const b=(0,E.F3)("Camera",{web:()=>new v})}}]);
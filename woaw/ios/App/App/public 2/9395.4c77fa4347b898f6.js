"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9395],{9395:(Y,m,c)=>{c.r(m),c.d(m,{UsadosPageModule:()=>V});var h=c(2881),C=c(9417),p=c(7343),v=c(9870),f=c(467),A=c(7051),t=c(1360),O=c(5806),F=c(9557),U=c(2381),b=c(9847),_=c(1969),P=c(4371),x=c(7677),M=c(8857);const y=["pageContent"];function I(n,l){if(1&n&&t.nrm(0,"app-spinner",14),2&n){const s=t.XpG();t.Y8G("tipo",s.tipo_spinner)("text",s.texto_spinner)("sub_text",s.textoSub_spinner)}}function j(n,l){1&n&&(t.j41(0,"div",15),t.nrm(1,"ion-icon",16),t.j41(2,"p"),t.EFF(3,"No se encontraron autos para esta secci\xf3n."),t.k0s()())}function k(n,l){if(1&n){const s=t.RV6();t.qex(0),t.j41(1,"app-cartas",18),t.bIt("refrescarAutos",function(o){t.eBV(s);const a=t.XpG(2);return t.Njj(a.handleRefrescarAutos(o))}),t.k0s(),t.bVm()}if(2&n){const s=l.$implicit,i=t.XpG(2);t.R7$(),t.Y8G("auto",s)("autosFavoritosIds",i.autosFavoritosIds)("ubicacion","usados")("esMio",i.idsMisAutos.includes(s._id))}}function R(n,l){if(1&n&&(t.qex(0),t.DNE(1,k,2,4,"ng-container",17),t.bVm()),2&n){const s=t.XpG();t.R7$(),t.Y8G("ngForOf",s.autosPaginados)}}function S(n,l){if(1&n){const s=t.RV6();t.j41(0,"button",25),t.bIt("click",function(){t.eBV(s);const o=t.XpG().$implicit,a=t.XpG(2);return t.Njj(a.cambiarPagina(o))}),t.EFF(1),t.k0s()}if(2&n){const s=t.XpG().$implicit,i=t.XpG(2);t.AVh("activa",i.paginaActual===s),t.R7$(),t.SpI(" ",s," ")}}function w(n,l){1&n&&(t.j41(0,"span",26),t.EFF(1,"..."),t.k0s())}function G(n,l){if(1&n&&(t.qex(0),t.DNE(1,S,2,3,"button",23)(2,w,2,0,"span",24),t.bVm()),2&n){const s=l.$implicit,i=t.XpG(2);t.R7$(),t.Y8G("ngIf",i.esNumero(s)),t.R7$(),t.Y8G("ngIf",!i.esNumero(s))}}function $(n,l){if(1&n){const s=t.RV6();t.j41(0,"div",19)(1,"div",20)(2,"div",21)(3,"button",22),t.bIt("click",function(){t.eBV(s);const o=t.XpG();return t.Njj(o.cambiarPagina(o.paginaActual-1))}),t.EFF(4," \u2039 "),t.k0s(),t.DNE(5,G,3,2,"ng-container",17),t.j41(6,"button",22),t.bIt("click",function(){t.eBV(s);const o=t.XpG();return t.Njj(o.cambiarPagina(o.paginaActual+1))}),t.EFF(7," \u203a "),t.k0s()()()()}if(2&n){const s=t.XpG();t.R7$(3),t.Y8G("disabled",1===s.paginaActual),t.R7$(2),t.Y8G("ngForOf",s.paginasReducidas),t.R7$(),t.Y8G("disabled",s.paginaActual===s.totalPaginas)}}const T=[{path:"",component:(()=>{var n;class l{constructor(i,o,a,e,r,u){this.menu=i,this.generalService=o,this.popoverCtrl=a,this.carsService=e,this.modalCtrl=r,this.router=u,this.esDispositivoMovil=!1,this.autosStorage=[],this.filtros=[{label:"Marca",tipo:"marca"},{label:"Precio",tipo:"precio"},{label:"Tipo",tipo:"tipo"},{label:"A\xf1o",tipo:"anio"}],this.filtrosAplicados={precio:null,anio:null,color:null,marca:null},this.autosFiltrados=[],this.mostrarPendientes=!1,this.paginaActual=1,this.totalPaginas=1,this.paginas=[],this.autosPaginados=[],this.showSplash=!0,this.autosFavoritosIds=new Set,this.idsMisAutos=[],this.isLoggedIn=!1,this.MyRole=null,this.totalAutos=0,this.ordenActivo=null,this.mostrar_spinner=!1,this.tipo_spinner=0,this.texto_spinner="Cargando...",this.textoSub_spinner="Espere un momento"}ngOnInit(){const i=localStorage.getItem("user");if(i){const o=JSON.parse(i);this.mostrarPendientes="glenditaa.003@gmail.com"===o.email}this.generalService.dispositivo$.subscribe(o=>{this.esDispositivoMovil="telefono"===o||"tablet"===o}),this.getCarsUsados(),this.generalService.tokenExistente$.subscribe(o=>{this.isLoggedIn=o}),this.generalService.tipoRol$.subscribe(o=>{this.MyRole=o}),this.generalService.valorGlobal$.subscribe(o=>{this.itemsPorPagina=o}),this.misAutos()}misAutos(){var i=this;return(0,f.A)(function*(){i.isLoggedIn?(i.mostrar_spinner=!0,i.carsService.misAutosId().subscribe({next:o=>{i.idsMisAutos=o&&Array.isArray(o.vehicleIds)&&o.vehicleIds.length>0?o.vehicleIds:[],i.mostrar_spinner=!1},error:o=>{var a;i.mostrar_spinner=!1;const e=(null==o||null===(a=o.error)||void 0===a?void 0:a.message)||"Error al obtener tus veh\xedculos.";"No se encontraron veh\xedculos para este usuario"===e?i.idsMisAutos=[]:console.warn(e)}})):i.idsMisAutos=[]})()}getCarsUsados(){this.mostrar_spinner=!0,this.carsService.getCarsUsados().subscribe({next:i=>{const o=(null==i?void 0:i.coches)||[];this.mostrarPendientes||o.filter(e=>"pendiente"!==e.estadoPublicacion),this.autosStorage=o.map(e=>{var r;const u=(null===(r=e.version)||void 0===r?void 0:r.map(E=>E.Precio))||[],g=Math.min(...u),d=Math.max(...u);return{...e,estadoVehiculo:e.estadoVehiculo||"disponible",imagen:e.imagenPrincipal||"/assets/default-car.webp",precioDesde:g,precioHasta:d}}),this.totalAutos=this.autosStorage.length,this.getCarsFavoritos(),this.calcularPaginacion(),this.mostrar_spinner=!1},error:i=>{var o;this.mostrar_spinner=!1;const a=(null==i||null===(o=i.error)||void 0===o?void 0:o.message)||"Ocurri\xf3 un error inesperado";this.generalService.alert("Error al guardar los datos",a)}})}ficha(i){var o=this;return(0,f.A)(function*(){localStorage.setItem("autoFicha",JSON.stringify(i)),o.router.navigate(["/ficha",i._id])})()}calcularPaginacion(){this.totalPaginas=Math.ceil(this.autosStorage.length/this.itemsPorPagina),this.paginas=Array.from({length:this.totalPaginas},(i,o)=>o+1),this.mostrarPagina(this.paginaActual)}mostrarPagina(i){this.paginaActual=i;const o=this.autosFiltrados.length?this.autosFiltrados:[...this.autosStorage],a=(i-1)*this.itemsPorPagina;this.autosPaginados=o.slice(a,a+this.itemsPorPagina)}cambiarPagina(i){this.mostrarPagina(i),setTimeout(()=>{this.content.scrollToTop(400)},100)}doRefresh(i){this.getCarsUsados(),this.filtrosAplicados={},setTimeout(()=>{i.target.complete()},1500)}mostrarOpciones(i,o){var a=this;return(0,f.A)(function*(){const e=yield a.popoverCtrl.create({component:A.s,event:i,translucent:!0,componentProps:{tipo:o}});yield e.present();const{data:r}=yield e.onDidDismiss();a.filtrosAplicados[o]=null===r?null:r,a.aplicarFiltros()})()}aplicarFiltros(){let i=[...this.autosStorage];const{precio:o,anio:a,color:e,marca:r,tipo:u}=this.filtrosAplicados;o&&(i=i.filter(g=>g.precioDesde>=o.rango[0]&&g.precioDesde<=o.rango[1])),null!=a&&a.anio&&(i=i.filter(g=>g.anio===a.anio)),e&&(i=i.filter(g=>{var d;return(null===(d=g.color)||void 0===d?void 0:d.toLowerCase())===e.label.toLowerCase()})),r&&(i=i.filter(g=>g.marca.toLowerCase()===r.label.toLowerCase())),u&&(i=i.filter(g=>{var d;return(null===(d=g.tipoVehiculo)||void 0===d?void 0:d.toLowerCase())===u.label.toLowerCase()})),this.autosFiltrados=i,this.totalPaginas=Math.ceil(i.length/this.itemsPorPagina),this.paginas=Array.from({length:this.totalPaginas},(g,d)=>d+1),this.autosPaginados=i.slice(0,this.itemsPorPagina)}getCarsFavoritos(){this.carsService.getCarsFavoritos().subscribe({next:i=>{const o=i.vehicles.map(a=>a.vehicleId);this.autosFavoritosIds=new Set(o),this.mostrarPagina(this.paginaActual)},error:i=>{}})}agregarAFavoritos(i){var o=this;return(0,f.A)(function*(){if(!o.isLoggedIn)return o.router.navigate(["/inicio"]),void o.generalService.alert("Inicia sesi\xf3n","Debes iniciar sesi\xf3n para poder agregar este veh\xedculo a tus favoritos.","info");var a;yield o.generalService.loading("Agregando a favoritos..."),o.carsService.agregarFavorito(i).subscribe({next:(a=(0,f.A)(function*(){o.getCarsUsados(),yield o.generalService.loadingDismiss()}),function(){return a.apply(this,arguments)}),error:function(){var a=(0,f.A)(function*(e){var r;yield o.generalService.loadingDismiss();const u=(null===(r=e.error)||void 0===r?void 0:r.message)||"No se pudo agregar el auto a favoritos. Intenta m\xe1s tarde.";yield o.generalService.alert("Error",u,"danger")});return function(r){return a.apply(this,arguments)}}()})})()}handleRefrescarAutos(i){"usados"===i&&this.getCarsUsados()}ordenarAutos(i){this.ordenActivo=i;const o=this.autosFiltrados.length?this.autosFiltrados:[...this.autosStorage];switch(i){case"precioAsc":o.sort((a,e)=>a.precioDesde-e.precioDesde);break;case"precioDesc":o.sort((a,e)=>e.precioDesde-a.precioDesde);break;default:o.sort((a,e)=>e.anio-a.anio)}this.autosFiltrados=o,this.totalPaginas=Math.ceil(o.length/this.itemsPorPagina),this.paginas=Array.from({length:this.totalPaginas},(a,e)=>e+1),this.autosPaginados=o.slice(0,this.itemsPorPagina)}resetearFiltros(){this.filtrosAplicados={},this.aplicarFiltros()}esNumero(i){return"number"==typeof i}get paginasReducidas(){const i=this.totalPaginas,o=this.paginaActual;if(i<=2)return this.paginas;const e=[];e.push(1),o-1>2&&e.push("...");for(let r=Math.max(2,o-1);r<=Math.min(i-1,o+1);r++)e.push(r);return o+1<i-1&&e.push("..."),e.push(i),e}}return(n=l).\u0275fac=function(i){return new(i||n)(t.rXU(p._t),t.rXU(O.O),t.rXU(p.IE),t.rXU(F.R),t.rXU(p.W3),t.rXU(U.Ix))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-usados"]],viewQuery:function(i,o){if(1&i&&t.GBs(y,5),2&i){let a;t.mGM(a=t.lsd())&&(o.content=a.first)}},standalone:!1,decls:16,vars:11,consts:[["pageContent",""],[1,"contenido-ios",3,"fullscreen"],["slot","fixed","pullFactor","0.4","pullMin","120","pullMax","200",3,"ionRefresh"],["pullingIcon","arrow-down-outline","refreshingSpinner","crescent","pullingText","Desliza para actualizar","refreshingText","Actualizando..."],[3,"ordenCambio","totalAutos","titulo"],[3,"tipo","text","sub_text",4,"ngIf"],[1,"contenedor-catalogo-ios"],["size","12","size-md","3"],[3,"mostrarOpciones","limpiarFiltros","filtros","filtrosAplicados"],["size","12","size-md","9"],[1,"catalogo-autos-ios"],["class","mensaje-vacio-ios",4,"ngIf"],[4,"ngIf"],["class","contenedor-paginacion-ios",4,"ngIf"],[3,"tipo","text","sub_text"],[1,"mensaje-vacio-ios"],["name","car-sport-outline",1,"icono-mensaje"],[4,"ngFor","ngForOf"],[3,"refrescarAutos","auto","autosFavoritosIds","ubicacion","esMio"],[1,"contenedor-paginacion-ios"],[1,"paginacion-scroll-ios"],[1,"paginacion-ios"],[1,"pagina-ios",3,"click","disabled"],["class","pagina-ios",3,"activa","click",4,"ngIf"],["class","ellipsis-ios",4,"ngIf"],[1,"pagina-ios",3,"click"],[1,"ellipsis-ios"]],template:function(i,o){if(1&i){const a=t.RV6();t.nrm(0,"app-navbar"),t.j41(1,"ion-content",1,0)(3,"ion-refresher",2),t.bIt("ionRefresh",function(r){return t.eBV(a),t.Njj(o.doRefresh(r))}),t.nrm(4,"ion-refresher-content",3),t.k0s(),t.j41(5,"app-acomodo",4),t.bIt("ordenCambio",function(r){return t.eBV(a),t.Njj(o.ordenarAutos(r))}),t.k0s(),t.DNE(6,I,1,3,"app-spinner",5),t.j41(7,"ion-grid",6)(8,"ion-row")(9,"ion-col",7)(10,"app-menu",8),t.bIt("mostrarOpciones",function(r){return t.eBV(a),t.Njj(o.mostrarOpciones(r.event,r.tipo))})("limpiarFiltros",function(){return t.eBV(a),t.Njj(o.resetearFiltros())}),t.k0s()(),t.j41(11,"ion-col",9)(12,"div",10),t.DNE(13,j,4,0,"div",11)(14,R,2,1,"ng-container",12),t.k0s(),t.DNE(15,$,8,3,"div",13),t.k0s()()()()}2&i&&(t.R7$(),t.Y8G("fullscreen",!0),t.R7$(4),t.Y8G("totalAutos",o.totalAutos)("titulo","Usados"),t.R7$(),t.Y8G("ngIf",o.mostrar_spinner),t.R7$(4),t.Y8G("filtros",o.filtros)("filtrosAplicados",o.filtrosAplicados),t.R7$(2),t.AVh("sin-autos",!o.autosPaginados||0===o.autosPaginados.length),t.R7$(),t.Y8G("ngIf",!o.autosPaginados||0===o.autosPaginados.length),t.R7$(),t.Y8G("ngIf",o.autosPaginados&&o.autosPaginados.length>0),t.R7$(),t.Y8G("ngIf",o.totalPaginas>1))},dependencies:[h.Sq,h.bT,b._,p.hU,p.W9,p.lO,p.iq,p.To,p.Ki,p.ln,_.Z,P.a,x.E,M.t],styles:['@charset "UTF-8";.contenido-ios[_ngcontent-%COMP%]{--background: #f2f2f7;font-family:-apple-system,BlinkMacSystemFont,SF Pro Text,sans-serif}.header-ios[_ngcontent-%COMP%]{--background: rgba(249, 249, 249, .94);--border-color: rgba(0, 0, 0, .08);--color: #111827;backdrop-filter:blur(18px);-webkit-backdrop-filter:blur(18px);border-bottom:.33px solid var(--border-color);padding-inline:8px;min-height:52px}.btn-back-ios[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:4px;padding:4px 10px;border-radius:999px;border:none;background:#0000000a;color:#007aff;font-size:14px;font-weight:500;cursor:pointer}.btn-back-ios[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px}.btn-back-ios[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{transform:translateY(-.5px)}.btn-back-ios[_ngcontent-%COMP%]:active{background:#00000014}.logo-ios[_ngcontent-%COMP%]{height:22px;width:auto}.contenedor-catalogo-ios[_ngcontent-%COMP%]{max-width:1100px;width:100%;margin:0 auto;padding:0 12px 20px}.catalogo-autos-ios[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:14px;margin-top:14px;margin-bottom:20px}@media (max-width: 768px){.catalogo-autos-ios[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fill,minmax(155px,1fr));gap:10px}}@media (max-width: 540px){.catalogo-autos-ios[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr);gap:8px}}.catalogo-autos-ios[_ngcontent-%COMP%]   app-cartas[_ngcontent-%COMP%]{display:block}.catalogo-autos-ios.sin-autos[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;margin-top:0;margin-bottom:0;min-height:calc(100vh - 200px)}@media (max-width: 768px){.catalogo-autos-ios.sin-autos[_ngcontent-%COMP%]{min-height:calc(100vh - 180px)}}.mensaje-vacio-ios[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;color:#8e8e93;font-size:15px;margin-top:0}.mensaje-vacio-ios[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:60px;margin-bottom:10px;color:#b3b3b9}.mensaje-vacio-ios[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;max-width:320px;line-height:1.45;font-weight:500}.contenedor-paginacion-ios[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;margin-top:18px;padding-bottom:10px}.titulo-paginacion-ios[_ngcontent-%COMP%]{margin:0 0 6px;font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:.12em;color:#6b7280}.paginacion-scroll-ios[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center;overflow-x:auto;padding-bottom:4px;scrollbar-width:thin;scrollbar-color:rgba(148,163,184,.9) transparent}.paginacion-scroll-ios[_ngcontent-%COMP%]::-webkit-scrollbar{height:5px}.paginacion-scroll-ios[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#94a3b8e6;border-radius:999px}.paginacion-ios[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;padding:5px 6px;border-radius:999px;background:#fffffff5;backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);box-shadow:0 10px 22px #0f172a29,0 0 0 .5px #ffffffe6}.pagina-ios[_ngcontent-%COMP%]{min-width:32px;height:32px;padding:0 10px;border-radius:999px;border:none;outline:none;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:600;color:#111827;background:transparent;transition:background .18s ease,color .18s ease,transform .16s ease,box-shadow .16s ease}.pagina-ios[_ngcontent-%COMP%]:disabled{opacity:.35;cursor:default}.pagina-ios[_ngcontent-%COMP%]:not(.activa):not(:disabled):hover{background:#94a3b82e;transform:translateY(-1px)}.pagina-ios.activa[_ngcontent-%COMP%]{background:#ff3b30;color:#fff;box-shadow:0 8px 18px #ff3b308c;transform:translateY(-1px)}.ellipsis-ios[_ngcontent-%COMP%]{padding:0 6px;font-size:14px;color:#9ca3af;font-weight:500}.btn-fav[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px}.filtros-row[_ngcontent-%COMP%]{--ion-grid-column-padding: 4px;--ion-grid-padding: 0;row-gap:8px;column-gap:8px;gap:.5rem}.btn-filtro[_ngcontent-%COMP%]{font-weight:500;border-radius:18px}.estado-vehiculo[_ngcontent-%COMP%]{display:inline-block;padding:4px 10px;font-size:12px;font-weight:600;border-radius:999px;text-transform:uppercase;margin-bottom:4px;width:-moz-fit-content;width:fit-content}.estado-vehiculo.disponible[_ngcontent-%COMP%]{background-color:#d4edda;color:#155724;border:1px solid #c3e6cb}.estado-vehiculo.vendido[_ngcontent-%COMP%]{background-color:#f8d7da;color:#721c24;border:1px solid #f5c6cb}']}),l})()}];let D=(()=>{var n;class l{}return(n=l).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[v.iI.forChild(T),v.iI]}),l})();var N=c(5473);let V=(()=>{var n;class l{}return(n=l).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[h.MD,b._,C.YN,p.bv,D,_.Z,P.a,x.E,N.n,M.t]}),l})()}}]);
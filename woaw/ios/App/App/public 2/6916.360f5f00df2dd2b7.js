"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6916],{6916:(B,f,c)=>{c.r(f),c.d(f,{MisCamionesPageModule:()=>D});var h=c(2881),x=c(9417),m=c(7343),v=c(9870),u=c(467),F=c(7051),i=c(1360),y=c(5806),A=c(4277),b=c(2381),C=c(9847),P=c(1969),M=c(4371),_=c(7677);const O=["pageContent"];function j(t,g){1&t&&(i.j41(0,"div",13),i.nrm(1,"ion-icon",14),i.j41(2,"p"),i.EFF(3,"No tienes camiones disponibles."),i.k0s()())}function I(t,g){if(1&t&&(i.qex(0),i.nrm(1,"app-cartas",15),i.bVm()),2&t){const r=g.$implicit,o=i.XpG();i.R7$(),i.Y8G("auto",r)("autosFavoritosIds",o.camionesFavoritosIds)("ubicacion","mis_camiones")("esMio",o.idsMisCamiones.includes(r._id))}}function k(t,g){if(1&t){const r=i.RV6();i.j41(0,"button",22),i.bIt("click",function(){i.eBV(r);const e=i.XpG().$implicit,n=i.XpG(2);return i.Njj(n.cambiarPagina(e))}),i.EFF(1),i.k0s()}if(2&t){const r=i.XpG().$implicit,o=i.XpG(2);i.AVh("activa",o.paginaActual===r),i.R7$(),i.JRh(r)}}function S(t,g){1&t&&(i.j41(0,"span",23),i.EFF(1,"..."),i.k0s())}function $(t,g){if(1&t&&(i.qex(0),i.DNE(1,k,2,3,"button",20)(2,S,2,0,"span",21),i.bVm()),2&t){const r=g.$implicit,o=i.XpG(2);i.R7$(),i.Y8G("ngIf",o.esNumero(r)),i.R7$(),i.Y8G("ngIf",!o.esNumero(r))}}function R(t,g){if(1&t){const r=i.RV6();i.j41(0,"div",16)(1,"div",17)(2,"div",18)(3,"button",19),i.bIt("click",function(){i.eBV(r);const e=i.XpG();return i.Njj(e.cambiarPagina(e.paginaActual-1))}),i.EFF(4,"\u2039"),i.k0s(),i.DNE(5,$,3,2,"ng-container",11),i.j41(6,"button",19),i.bIt("click",function(){i.eBV(r);const e=i.XpG();return i.Njj(e.cambiarPagina(e.paginaActual+1))}),i.EFF(7,"\u203a"),i.k0s()()()()}if(2&t){const r=i.XpG();i.R7$(3),i.Y8G("disabled",1===r.paginaActual),i.R7$(2),i.Y8G("ngForOf",r.paginasReducidas),i.R7$(),i.Y8G("disabled",r.paginaActual===r.totalPaginas)}}const w=[{path:"",component:(()=>{var t;class g{constructor(o,e,n,a,s,d,l){this.generalService=o,this.popoverCtrl=e,this.camionesService=n,this.modalCtrl=a,this.router=s,this.route=d,this.menuCtrl=l,this.esDispositivoMovil=!1,this.camionesStorage=[],this.filtros=[{label:"$",tipo:"precio"},{label:"Marca",tipo:"marca"},{label:"Tipo",tipo:"tipoCamion"}],this.ordenActivo=null,this.totalCamiones=0,this.filtrosAplicados={precio:null,anio:null,color:null,marca:null,tipoCamion:null},this.terminoBusqueda="",this.isLoggedIn=!1,this.MyRole=null,this.camionesFavoritosIds=new Set,this.paginaActual=1,this.totalPaginas=1,this.paginas=[],this.camionesPaginados=[],this.showSplash=!0,this.idsMisCamiones=[],this.camionesFiltrados=[]}ngOnInit(){this.menuCtrl.close("menuLateral"),this.generalService.dispositivo$.subscribe(o=>{this.esDispositivoMovil="telefono"===o||"tablet"===o}),this.getCamionesMay(),this.generalService.tokenExistente$.subscribe(o=>{this.isLoggedIn=o}),this.generalService.tipoRol$.subscribe(o=>{this.MyRole=o}),this.generalService.valorGlobal$.subscribe(o=>{this.itemsPorPagina=o}),this.misCamiones()}misCamiones(){var o=this;return(0,u.A)(function*(){o.isLoggedIn&&o.camionesService.misCamionesId().subscribe({next:e=>{o.idsMisCamiones=e&&Array.isArray(e.vehicleIds)&&e.vehicleIds.length>0?e.vehicleIds:[]},error:e=>{var n;const a=(null==e||null===(n=e.error)||void 0===n?void 0:n.message)||"Error al obtener tus veh\xedculos.";"No se encontraron veh\xedculos para este usuario"===a?o.idsMisCamiones=[]:console.warn(a)}})})()}getCamionesMay(){console.log("estoy aqui"),this.camionesService.getMyCamiones().subscribe({next:o=>{this.camionesStorage=o.map(e=>{let n=0;if(e.version&&Array.isArray(e.version)&&e.version.length>0){const a=e.version.map(s=>parseFloat(s.Precio||s.precio||0)).filter(s=>!isNaN(s)&&s>0);a.length>0&&(n=Math.min(...a))}return 0===n&&e.precio&&(n=parseFloat(e.precio)),{...e,precioDesde:n}}),console.log(this.camionesStorage),this.totalCamiones=this.camionesStorage.length,this.getCamionesFavoritos(),this.calcularPaginacion()},error:o=>{var e;console.log("revision error");const n=(null==o||null===(e=o.error)||void 0===e?void 0:e.message)||"Ocurri\xf3 un error inesperado";console.error("Error al cargar camiones:",n)}})}getCamionesFavoritos(){this.camionesService.getCamionesFavoritos().subscribe({next:o=>{const e=o.vehicles.filter(n=>"camion"===n.tipo||"camion"===n.categoria).map(n=>n.vehicleId);this.camionesFavoritosIds=new Set(e),this.aplicarFiltros()},error:o=>{var e;const n=(null==o||null===(e=o.error)||void 0===e?void 0:e.message)||"Ocurri\xf3 un error inesperado";console.error("Error al cargar favoritos:",n)}})}ficha(o){var e=this;return(0,u.A)(function*(){e.router.navigate(["/ficha",o._id])})()}doRefresh(o){this.getCamionesMay(),this.filtrosAplicados={},setTimeout(()=>{o.target.complete()},1500)}mostrarOpciones(o,e){var n=this;return(0,u.A)(function*(){const a=yield n.popoverCtrl.create({component:F.s,event:o,translucent:!0,componentProps:{tipo:e}});yield a.present();const{data:s}=yield a.onDidDismiss();n.filtrosAplicados[e]=null===s?null:s,n.aplicarFiltros()})()}aplicarFiltros(){let o=[...this.camionesStorage];const{precio:e,anio:n,color:a,marca:s,tipoCamion:d}=this.filtrosAplicados;e&&(o=o.filter(l=>l.precioDesde>=e.rango[0]&&l.precioDesde<=e.rango[1])),n&&(2024===n.anio?o=o.filter(l=>l.anio>=2024):2020===n.anio?o=o.filter(l=>l.anio>=2020&&l.anio<=2023):2010===n.anio&&(o=o.filter(l=>l.anio<2020))),a&&(o=o.filter(l=>{var p;return(null===(p=l.color)||void 0===p?void 0:p.toLowerCase())===a.label.toLowerCase()})),s&&(o=o.filter(l=>l.marca.toLowerCase()===s.label.toLowerCase())),d&&(o=o.filter(l=>{var p;return(null===(p=l.tipoCamion)||void 0===p?void 0:p.toLowerCase())===d.label.toLowerCase()})),this.camionesFiltrados=o,this.totalPaginas=Math.ceil(o.length/this.itemsPorPagina),this.paginas=Array.from({length:this.totalPaginas},(l,p)=>p+1),this.camionesPaginados=o.slice(0,this.itemsPorPagina)}calcularPaginacion(){this.totalPaginas=Math.ceil(this.camionesStorage.length/this.itemsPorPagina),this.paginas=Array.from({length:this.totalPaginas},(o,e)=>e+1),this.mostrarPagina(this.paginaActual)}mostrarPagina(o){this.paginaActual=o;const e=(o-1)*this.itemsPorPagina;this.camionesPaginados=(this.camionesFiltrados.length>0?this.camionesFiltrados:this.camionesStorage).slice(e,e+this.itemsPorPagina)}agregarAFavoritos(o){var e=this;return(0,u.A)(function*(){if(!e.isLoggedIn)return e.router.navigate(["/inicio"]),void e.generalService.alert("Inicia sesi\xf3n","Por favor, inicia sesi\xf3n para continuar.","warning");var n;yield e.generalService.loading("Agregando a favoritos..."),e.camionesService.agregarFavorito(o).subscribe({next:(n=(0,u.A)(function*(){e.getCamionesMay(),yield e.generalService.loadingDismiss()}),function(){return n.apply(this,arguments)}),error:function(){var n=(0,u.A)(function*(a){var s;yield e.generalService.loadingDismiss();const d=(null===(s=a.error)||void 0===s?void 0:s.message)||"No se pudo agregar el cami\xf3n a favoritos. Intenta m\xe1s tarde.";yield e.generalService.alert("Error",d,"danger")});return function(s){return n.apply(this,arguments)}}()})})()}ordenarCamiones(o){this.ordenActivo=o;const e=this.camionesFiltrados.length?this.camionesFiltrados:[...this.camionesStorage];switch(o){case"precioAsc":e.sort((n,a)=>n.precioDesde-a.precioDesde);break;case"precioDesc":e.sort((n,a)=>a.precioDesde-n.precioDesde);break;default:e.sort((n,a)=>a.anio-n.anio)}this.camionesFiltrados=e,this.totalPaginas=Math.ceil(e.length/this.itemsPorPagina),this.paginas=Array.from({length:this.totalPaginas},(n,a)=>a+1),this.camionesPaginados=e.slice(0,this.itemsPorPagina)}resetearFiltros(){this.filtrosAplicados={},this.aplicarFiltros()}cambiarPagina(o){this.mostrarPagina(o),setTimeout(()=>{this.content.scrollToTop(400)},100)}regresar(){this.router.navigate(["/home"])}esNumero(o){return"number"==typeof o}get paginasReducidas(){const o=this.totalPaginas,e=this.paginaActual;if(o<=2)return this.paginas;const a=[];a.push(1),e-1>2&&a.push("...");for(let s=Math.max(2,e-1);s<=Math.min(o-1,e+1);s++)a.push(s);return e+1<o-1&&a.push("..."),a.push(o),a}filtrarPorBusqueda(){const o=this.terminoBusqueda.trim().toLowerCase();if(!o)return void this.aplicarFiltros();const n=(this.camionesFiltrados.length?this.camionesFiltrados:this.camionesStorage).filter(a=>{var s,d,l;const p=(null===(s=a.marca)||void 0===s?void 0:s.toLowerCase())||"",N=(null===(d=a.modelo)||void 0===d?void 0:d.toLowerCase())||"",L=String(a.anio||""),E=(null===(l=a.tipoCamion)||void 0===l?void 0:l.toLowerCase())||"",X=(a.version||[]).map(Y=>Y.Name.toLowerCase()).join(" ");return p.includes(o)||N.includes(o)||L.includes(o)||E.includes(o)||X.includes(o)});this.totalPaginas=Math.ceil(n.length/this.itemsPorPagina),this.paginas=Array.from({length:this.totalPaginas},(a,s)=>s+1),this.paginaActual=1,this.camionesPaginados=n.slice(0,this.itemsPorPagina)}}return(t=g).\u0275fac=function(o){return new(o||t)(i.rXU(y.O),i.rXU(m.IE),i.rXU(A.L),i.rXU(m.W3),i.rXU(b.Ix),i.rXU(b.nX),i.rXU(m._t))},t.\u0275cmp=i.VBU({type:t,selectors:[["app-mis-camiones"]],viewQuery:function(o,e){if(1&o&&i.GBs(O,5),2&o){let n;i.mGM(n=i.lsd())&&(e.content=n.first)}},standalone:!1,decls:17,vars:8,consts:[["pageContent",""],[1,"contenido-ios",3,"fullscreen"],["slot","fixed","pullFactor","0.4","pullMin","120","pullMax","200",3,"ionRefresh"],["pullingIcon","chevron-down-outline","refreshingSpinner","lines","pullingText","Desliza para actualizar","refreshingText","Actualizando..."],[3,"ordenCambio","totalAutos","titulo"],[1,"contenedor-catalogo-ios"],["size","12","size-md","3"],[3,"mostrarOpciones","limpiarFiltros","filtros","filtrosAplicados"],["size","12","size-md","9"],[1,"catalogo-autos-ios"],["class","mensaje-vacio-ios",4,"ngIf"],[4,"ngFor","ngForOf"],["class","contenedor-paginacion-ios",4,"ngIf"],[1,"mensaje-vacio-ios"],["name","trail-sign-outline"],[3,"auto","autosFavoritosIds","ubicacion","esMio"],[1,"contenedor-paginacion-ios"],[1,"paginacion-scroll-ios"],[1,"paginacion-ios"],[1,"pagina-ios",3,"click","disabled"],["class","pagina-ios",3,"activa","click",4,"ngIf"],["class","ellipsis-ios",4,"ngIf"],[1,"pagina-ios",3,"click"],[1,"ellipsis-ios"]],template:function(o,e){if(1&o){const n=i.RV6();i.nrm(0,"app-navbar"),i.j41(1,"ion-content",1,0)(3,"ion-refresher",2),i.bIt("ionRefresh",function(s){return i.eBV(n),i.Njj(e.doRefresh(s))}),i.nrm(4,"ion-refresher-content",3),i.k0s(),i.j41(5,"app-acomodo",4),i.bIt("ordenCambio",function(s){return i.eBV(n),i.Njj(e.ordenarCamiones(s))}),i.k0s(),i.j41(6,"ion-grid",5)(7,"ion-row")(8,"ion-col",6)(9,"app-menu",7),i.bIt("mostrarOpciones",function(s){return i.eBV(n),i.Njj(e.mostrarOpciones(s.event,s.tipo))})("limpiarFiltros",function(){return i.eBV(n),i.Njj(e.resetearFiltros())}),i.k0s()(),i.j41(10,"ion-col",8)(11,"div",9),i.DNE(12,j,4,0,"div",10)(13,I,2,4,"ng-container",11),i.k0s(),i.DNE(14,R,8,3,"div",12),i.k0s()()(),i.nrm(15,"br")(16,"br"),i.k0s()}2&o&&(i.R7$(),i.Y8G("fullscreen",!0),i.R7$(4),i.Y8G("totalAutos",e.totalCamiones)("titulo","Mis Camiones"),i.R7$(4),i.Y8G("filtros",e.filtros)("filtrosAplicados",e.filtrosAplicados),i.R7$(3),i.Y8G("ngIf",0===(null==e.camionesPaginados?null:e.camionesPaginados.length)),i.R7$(),i.Y8G("ngForOf",e.camionesPaginados),i.R7$(),i.Y8G("ngIf",e.totalPaginas>1))},dependencies:[h.Sq,h.bT,m.hU,m.W9,m.lO,m.iq,m.To,m.Ki,m.ln,C._,P.Z,M.a,_.E],styles:['@charset "UTF-8";.header-ios[_ngcontent-%COMP%]{--background: rgba(249, 249, 249, .94);--border-color: rgba(0, 0, 0, .08);--color: #111827;backdrop-filter:blur(18px);-webkit-backdrop-filter:blur(18px);border-bottom:.33px solid var(--border-color);padding-inline:8px;min-height:52px}.btn-back-ios[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:4px;padding:4px 10px;border-radius:999px;border:none;background:#0000000a;color:#007aff;font-size:14px;font-weight:500}.btn-back-ios[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px;color:#007aff}.btn-back-ios[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{transform:translateY(-.5px)}.btn-back-ios[_ngcontent-%COMP%]:active{background:#00000014}.logo-ios[_ngcontent-%COMP%]{height:24px;width:auto}.contenido-ios[_ngcontent-%COMP%]{--background: #f2f2f7;font-family:-apple-system,BlinkMacSystemFont,SF Pro Text,sans-serif}.mensaje-vacio-ios[_ngcontent-%COMP%]{width:100%;min-height:55vh;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;color:#8e8e93}.mensaje-vacio-ios[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:64px;color:#b3b3b9;margin-bottom:14px}.mensaje-vacio-ios[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:15px;margin:0;max-width:280px}.contenedor-catalogo-ios[_ngcontent-%COMP%]{max-width:1100px;margin:0 auto;padding:12px}.catalogo-autos-ios[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:14px}@media (max-width: 768px){.catalogo-autos-ios[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fill,minmax(155px,1fr));gap:10px}}@media (max-width: 540px){.catalogo-autos-ios[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr);gap:8px}}.contenedor-paginacion-ios[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;margin-top:18px;padding-bottom:10px}.paginacion-scroll-ios[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center;overflow-x:auto;padding-bottom:4px;scrollbar-width:thin;scrollbar-color:rgba(148,163,184,.9) transparent}.paginacion-scroll-ios[_ngcontent-%COMP%]::-webkit-scrollbar{height:5px}.paginacion-scroll-ios[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#94a3b8e6;border-radius:999px}.paginacion-ios[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;padding:5px 6px;border-radius:999px;background:#fffffff5;-webkit-backdrop-filter:blur(12px);backdrop-filter:blur(12px);box-shadow:0 10px 22px #0f172a29,0 0 0 .5px #ffffffe6}.pagina-ios[_ngcontent-%COMP%]{min-width:32px;height:32px;padding:0 10px;border-radius:999px;border:none;cursor:pointer;font-size:13px;font-weight:600;color:#111827;background:transparent;transition:background .18s ease,color .18s ease,transform .16s ease,box-shadow .16s ease}.pagina-ios[_ngcontent-%COMP%]:disabled{opacity:.35}.pagina-ios[_ngcontent-%COMP%]:not(.activa):not(:disabled):hover{background:#94a3b82e;transform:translateY(-1px)}.pagina-ios.activa[_ngcontent-%COMP%]{background:#ff3b30;color:#fff;box-shadow:0 8px 18px #ff3b308c;transform:translateY(-1px)}.ellipsis-ios[_ngcontent-%COMP%]{padding:0 6px;font-size:14px;color:#9ca3af}']}),g})()}];let G=(()=>{var t;class g{}return(t=g).\u0275fac=function(o){return new(o||t)},t.\u0275mod=i.$C({type:t}),t.\u0275inj=i.G2t({imports:[v.iI.forChild(w),v.iI]}),g})();var T=c(5473);let D=(()=>{var t;class g{}return(t=g).\u0275fac=function(o){return new(o||t)},t.\u0275mod=i.$C({type:t}),t.\u0275inj=i.G2t({imports:[h.MD,x.YN,m.bv,C._,G,P.Z,M.a,_.E,T.n]}),g})()}}]);